function notifyEdgeTranslate(e,t){chrome.runtime.sendMessage(JSON.stringify({type:"event",event:"page_translate_event",detail:{event:e,...t}}),(()=>{chrome.runtime.lastError&&console.error(chrome.runtime.lastError)}))}if(this.JSON&&-1!==this.JSON.stringify.toString().indexOf("[native code]")?this.JSONDAO=this.JSON:this.JSONDAO={},function(){function f(e){return e<10?"0"+e:e}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,(function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}))+'"':'"'+e+'"'}function str(e,t){var n,i,a,s,r,o=gap,l=t[e];switch(l&&"object"==typeof l&&"function"==typeof l.toJSON&&(l=l.toJSON(e)),"function"==typeof rep&&(l=rep.call(t,e,l)),typeof l){case"string":return quote(l);case"number":return isFinite(l)?String(l):"null";case"boolean":case"null":return String(l);case"object":if(!l)return"null";if(gap+=indent,r=[],"[object Array]"===Object.prototype.toString.apply(l)){for(s=l.length,n=0;n<s;n+=1)r[n]=str(n,l)||"null";return a=0===r.length?"[]":gap?"[\n"+gap+r.join(",\n"+gap)+"\n"+o+"]":"["+r.join(",")+"]",gap=o,a}if(rep&&"object"==typeof rep)for(s=rep.length,n=0;n<s;n+=1)"string"==typeof(i=rep[n])&&(a=str(i,l))&&r.push(quote(i)+(gap?": ":":")+a);else for(i in l)Object.hasOwnProperty.call(l,i)&&(a=str(i,l))&&r.push(quote(i)+(gap?": ":":")+a);return a=0===r.length?"{}":gap?"{\n"+gap+r.join(",\n"+gap)+"\n"+o+"}":"{"+r.join(",")+"}",gap=o,a}}"function"!=typeof JSONDAO.stringify&&(JSONDAO.stringify=function(e,t,n){var i;if(gap="",indent="","number"==typeof n)for(i=0;i<n;i+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSONDAO.stringify");return str("",{"":e})}),"function"!=typeof JSONDAO.parse&&(JSONDAO.parse=function(text,reviver){var j;function walk(e,t){var n,i,a=e[t];if(a&&"object"==typeof a)for(n in a)Object.hasOwnProperty.call(a,n)&&(void 0!==(i=walk(a,n))?a[n]=i:delete a[n]);return reviver.call(e,t,a)}if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,(function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}))),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSONDAO.parse")})}(),function(){var e,t,n,i={browser:(t={},n=navigator.userAgent.toLowerCase(),(e=n.match(/msie ([\d.]+)/))?t.msie=e[1]:(e=n.match(/firefox\/([\d.]+)/))?t.firefox=e[1]:(e=n.match(/chrome\/([\d.]+)/))?t.chrome=e[1]:(e=n.match(/opera.([\d.]+)/))?t.opera=e[1]:(e=n.match(/version\/([\d.]+).*safari/))&&(t.safari=e[1]),t),isDOM:function(e){return Boolean(e&&1===e.nodeType)},isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)},each:function(e,t,n){if(null!=e){if(void 0===e.length||i.isFunction(e)){for(var a in e)if(e.hasOwnProperty(a)&&!1===t.call(n||e[a],a,e[a]))break}else for(var s=0;s<e.length&&!1!==t.call(n||e[s],s,e[s]);s++);return e}},indexOf:function(e,t){if(e.indexOf)return e.indexOf(t);var n=-1;return i.each(e,(function(e){if(this===t)return n=e,!1})),n},bind:function(e,t,n){if(n)return e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n,this},unbind:function(e,t,n){if(n)return e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent?e.detachEvent("on"+t,n):e["on"+t]=function(){},this},param:function(e){if("string"==typeof e)return e;var t=[];return i.each(e,(function(e,n){n&&(n=encodeURIComponent(n),i.browser.firefox&&(n=encodeURIComponent(unescape(n))),t.push(encodeURIComponent(e)+"="+n))})),t.join("&")},makeArray:function(e){return Array.prototype.slice.call(e,0)},getDocumentCharset:function(){return i.log("document.characterSet || document.charset:::"+document.characterSet||document.charset),document.characterSet||document.charset},log:function(){},css:function(e,t){if("string"==typeof t)return function(e,t){var n="";if("float"==t&&(t=document.defaultView?"float":"styleFloat"),e.style[t])n=e.style[t];else if(e.currentStyle)n=e.currentStyle[t];else if(document.defaultView&&document.defaultView.getComputedStyle){t=t.replace(/([A-Z])/g,"-$1").toLowerCase();var i=document.defaultView.getComputedStyle(e,"");n=i&&i.getPropertyValue(t)}else n=null;if("auto"!=n&&-1===n.indexOf("%")||"width"!==t.toLowerCase()&&"height"!==t.toLowerCase()||"none"==e.style.display||-1===n.indexOf("%")||(n=e["offset"+t.charAt(0).toUpperCase()+t.substring(1).toLowerCase()]+"px"),"opacity"==t)try{n=e.filters["DXImageTransform.Microsoft.Alpha"].opacity,n/=100}catch(t){try{n=e.filters("alpha").opacity}catch(e){}}return n}(e,t);i.each(t,(function(t,n){e.style[t]=n}))},getPageSize:function(){var e,t,n,i;window.innerHeight&&window.scrollMaxY?(e=document.body.scrollWidth,t=window.innerHeight+window.scrollMaxY):(e=Math.max(document.body.scrollWidth,document.body.offsetWidth),t=Math.max(document.body.scrollHeight,document.body.offsetHeight)),n=document.documentElement.clientWidth||document.body.clientWidth,i=document.documentElement.clientHeight||document.body.clientHeight;var a=Math.max(t,i);return{page:{width:Math.max(e,n),height:a},window:{width:n,height:i}}},findPos:function(e){var t={x:0,y:0};if(document.documentElement.getBoundingClientRect())t.x=e.getBoundingClientRect().left+i.scroll().left,t.y=e.getBoundingClientRect().top+i.scroll().top;else for(;e;)t.x+=e.offsetLeft,t.y+=e.offsetTop,e=e.offsetParent;return t},textPos:function(e,t){var n=e||window.event,a={},s={},r=t.h,o=t.v||"bottom";if(window.getSelection?a=window.getSelection().getRangeAt(0):document.selection&&(a=document.selection.createRange()),r?s.x=l[r]+i.scroll().left:n.pageX||n.pageY?s.x=n.pageX:(n.clientX||n.clientY)&&(s.x=n.clientX+i.scroll().left),a.getBoundingClientRect){var l=a.getBoundingClientRect();s.y=l[o]+i.scroll().top}else n.pageX||n.pageY?s.y=n.pageY:(n.clientX||n.clientY)&&(s.y=n.clientY+i.scroll().top);return s},scroll:function(){return{left:document.documentElement.scrollLeft+document.body.scrollLeft,top:document.documentElement.scrollTop+document.body.scrollTop}},walkTheDOM:function(e,t,n){if((!n||n(e))&&(t(e),"NOSCRIPT"!==e.tagName&&"IFRAME"!==e.tagName&&"FRAME"!==e.tagName))for(e=e.firstChild;e;)arguments.callee(e,t,n),e=e.nextSibling},getTextNodes:function(e,t){var n=[];return i.walkTheDOM(e,(function(e){3===e.nodeType&&i.trim(e.nodeValue)&&n.push(e)}),t),n},getElementsByClassName:function(e,t){if(e.getElementsByClassName)return e.getElementsByClassName(t);var n=[];return i.walkTheDOM(e,(function(e){i.hasClass(e,t)&&n.push(e)})),n},query:function(e,t){var n=new RegExp("(?:(?:\\.([^()]+))?)(?:(?:#([^()]+))?)").exec(e),a=t||document;if(!n)return null;if(n[1]){var s=n[1];if(a.getElementsByClassName)return a.getElementsByClassName(s);var r=[];return i.walkTheDOM(a,(function(e){i.hasClass(e,s)&&r.push(e)})),r}return n[2]?a.getElementById(n[2]):void 0},trim:function(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")},formatTemplate:function(e,t){var n=document.createElement("div");for(var i in t)t.hasOwnProperty(i)&&(e=e.replace(new RegExp("{"+i+"}","g"),t[i]));n.innerHTML=e;var a=n.firstChild;return n.removeChild(a),a},hasClass:function(e,t){if(i.isDOM(e)){if(e.className===t)return!0;for(var n=e.className.split(" "),a=0,s=n.length;a<s;a++)if(t===n[a])return!0}return!1},loadCSS:function(e,t){var n=function(t){if(e&&e.createElement){Date.parse(new Date);var n=e.createElement("link"),i=-1===t.indexOf("?")?t+"?572877":t+"&572877";n.setAttribute("rel","stylesheet"),n.setAttribute("href",i),n.setAttribute("type","text/css"),(e.getElementsByTagName("head")[0]||e.body).appendChild(n)}};i.isArray(t)?i.each(t,(function(e,t){n(t)})):"string"==typeof t&&n(t)},addClass:function(e,t){if(i.isDOM(e)){for(var n=e.className.split(" "),a=0,s=n.length;a<s;a++)if(t===n[a])return;n[a]=t,e.className=n.join(" ")}},removeClass:function(e,t){if(i.isDOM(e)){for(var n=e.className.split(" "),a=0,s=n.length,r=[];a<s;a++)t!==n[a]&&r.push(n[a]);e.className=r.join(" ")}},toggleClass:function(e,t){if(i.isDOM(e)){for(var n=e.className.split(" "),a=0,s=n.length,r=[],o="add";a<s;a++)t===n[a]?o="remove":r.push(n[a]);"add"===o?n[a]=t:n=r,e.className=n.join(" ")}},guid:function(){var e=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return function(){return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}}(),protoExtend:function(e,t){var n=i.isFunction(t)?t:function(){};return n.prototype=e,new n},stopPropagation:function(e){var t=e||window.event;return t.stopPropagation&&t.stopPropagation(),t.cancelBubble=!0,t},storage:function(e,t){return window.localStorage?function(e,t){var n=window.localStorage;return void 0===t?n.getItem(e):void 0!==e&&void 0!==t?(n.setItem(e,t),t):void 0}(e,t):document.documentElement.addBehavior?function(e,t){var n=document.documentElement;return n.addBehavior("#default#userData"),void 0===t?(n.load("fanyiweb2"),n.getAttribute(e)):void 0!==e&&void 0!==t?(n.setAttribute(e,t),n.save("fanyiweb2"),t):void 0}(e,t):void 0},cookie:function(e,t){if(!t)return n=e,null!=(i=document.cookie.match(new RegExp("(^| )"+n+"=([^;]*)(;|$)")))?decodeURIComponent(i[2]):null;var n,i;!function(e,t){var n=new Date;n.setTime(n.getTime()+2592e6),document.cookie=e+"="+t+";expire*="+n.toGMTString()}(e,t)},parseData:function(){var e={json:function(e){try{return JSONDAO.parse(e)}catch(t){i.log("[Error]","Invalid JSON data:",e)}},xml:function(e){if(window.DOMParser)return(new DOMParser).parseFromString(e,"text/xml");var t=new ActiveXObject("Microsoft.XMLDOM");return t.async="false",t.loadXML(e),t}};return function(t,n){return void 0===t?n:i.isFunction(t)?t(n):t&&!e[t]?(i.log("[Error]","Function parseData() dosen't support this type:",t),n):e[t](n)}}(),once:function(e){return function(){i.isFunction(e)&&e.apply(this,arguments),e=function(){}}}};window.J=i}(),function(e){var t=function(e,n,i){return new t.prototype.init(e,n,i)};t.prototype={init:function(e,t,n){var i=this,a=[],s=function(e){for(i.ajax=e;a.length>0;)e(a.pop())};return window.postMessage?this.createMessageChannel(e,t,n,s):this.createJTRAssist(e,s),this.ajax=function(e){return a.push(e),this},this},createMessageChannel:function(t,n,i,a){var s,r,o,l=this,d=function(){if(e.isDOM(e.query("#"+t)))throw new Error("Existed CDA iFrame element");if(n&&i){var a=document.createElement("iframe");return a.setAttribute("id",t),a.className="OUTFOX_JTR_CONN",a.style.display="none",a.setAttribute("src",i),document.body.appendChild(a),a.contentWindow}throw new Error("Empty domain is not allowed")}(),c=(s=[],r=0,o={transferStationReady:function(){a((function(t){return t.data=e.param(t.data),t.index=r++,s[t.index]={dataType:t.dataType,callback:t.callback},delete t.callback,d.postMessage(JSONDAO.stringify(t),"*"),l}))},dataBack:function(t){if(t&&s[t.index]){var n=s[t.index];e.isFunction(n.callback)&&n.callback(e.parseData(n.dataType,t.response)),delete s[t.index]}}},function(e){let t=JSONDAO.parse(e.data);if(!t.type||"edge_translate_page_translate_event"!==t.type){var n=JSONDAO.parse(e.data);o[n.handler](JSONDAO.parse(e.data))}});e.bind(window,"message",(function(e){c.call(l,e)}))},createJTRAssist:function(t,n){var i=this,a="https://fanyi.youdao.com/web2/JTRAssist.swf?"+ +new Date,s=0;!function(){if(!e.query("#"+t)){var n=document.createElement("div");"6.0"===e.browser.msie||"7.0"===e.browser.msie?n.innerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="1" height="1" id="'+t+'"><param name="allowScriptAccess" value="always" /><param name="movie" value="'+a+'" /></object>':n.innerHTML='<object height="1" width="1" id="'+t+'" data="'+a+'"><param name="allowScriptAccess" value="always"></object>',document.body.appendChild(n)}}(),window.JTRAssistIsReady=function(){n((function(n){switch(n.handler){case"translate":n.data=e.param(n.data),function(n){var a="outfox_jtr_fproxy_callback_"+s++;window[a]=function(t){n.callback.call(i,e.parseData(n.dataType,decodeURI(t)))},e.query("#"+t).load(n.url,n.data,n.type||"POST",'window["'+a+'"]')}(n);break;case"localStorage":!function(n){var i=n.data.key,a=n.data.value;void 0===a?e.isFunction(n.callback)&&n.callback(e.parseData(n.dataType,e.query("#"+t).getItem(i))):e.query("#"+t).setItem(i,a)}(n);break;default:throw new Error("Unsupported request type :"+n.handler)}return i}))}}},t.prototype.init.prototype=t.prototype,e.CDA=t}(J),function(e){TR=function(t,n,i,a){this._manager=a,this._reqSize=n.reqSize,this._onStatusChange=n.onStatusChange||function(){},this._url=n.url,this.conn=i,this._context=t,this._request=function(e,t,n){i.ajax({url:e,handler:"translate",type:"POST",data:t,callback:n,dataType:"json"})};var s=[],r=new e.Page(t).getMainArticle();r&&(s=e.getTextNodes(r.elem,TR.isInclude)),this.mainNodeLength=s.length||null,this._nodeIndex=[],s=s.concat(e.getTextNodes(t,(function(e){return e!==(r&&r.elem)&&TR.isInclude(e)}))),e.each(s,(function(e,t){this._nodeIndex.push(this._manager.addNode(t))}),this),this.workingThread=0,this.guid=n.guid||e.guid()},TR.prototype={doTrans:function(){for(var t=++this.workingThread,n={ue:e.getDocumentCharset()||null,data:null,relatedUrl:document.location.href,guid:this.guid,mainLength:this.mainNodeLength,requestId:e.guid()},i=[],a=0,s=0;s<this._nodeIndex.length;s++)if(this._manager.transResults[s])t===this.workingThread&&this._manager.replaceTrans(s);else{var r=null;r=i[parseInt(a/this._reqSize,10)]?i[parseInt(a++/this._reqSize,10)]:i[parseInt(a++/this._reqSize,10)]={};var o=null;try{o=this._manager.nodes[s].parentNode&&this._manager.nodes[s].parentNode.tagName||null}catch(e){}r[s]={src:this._manager.originals[s],tag:o}}if(0!==i.length){var l=this,d=function(e){l._onStatusChange({id:t,action:"TRANS",level:"0",status:"busy",data:[e,i.length]}),n.data=JSONDAO.stringify(i[e]),l._request(l._url.textTrans,n,(function(n){l._updateTrans(n,t),++e<i.length?d(e):l._onStatusChange({id:t,action:"TRANS",level:"0",status:"finish"})}))};d(0)}else this._onStatusChange({id:t,action:"TRANS",level:"0",status:"finish"})},revertTrans:function(){for(var e=++this.workingThread,t=0;t<this._nodeIndex.length;t++)e===this.workingThread&&this._manager.revertTrans(this._nodeIndex[t])},_updateTrans:function(t,n){t&&(40!==t.errorCode||30!==t.errorCode?e.each(t.data,(function(e,t){this._manager.transResults[e]=t.tst,n===this.workingThread&&this._manager.replaceTrans(e)}),this):e.log("Get Error Code:",t.errorCode))},doTips:function(t){for(var n=++this.workingThread,i={type:"X",ue:e.getDocumentCharset()||null,data:null,relatedUrl:document.location.href,mainLength:this.mainNodeLength,guid:this.guid},a=[],s=0,r=0;r<this._nodeIndex.length;r++)if(this._manager.tipsResults[r])n===this.workingThread&&this._manager.replaceTips(r,t);else{var o=null;o=a[parseInt(s/this._reqSize,10)]?a[parseInt(s++/this._reqSize,10)]:a[parseInt(s++/this._reqSize,10)]={};var l=null;try{l=this._manager.nodes[r].parentNode&&this._manager.nodes[r].parentNode.tagName||null}catch(e){}o[r]={src:this._manager.originals[r],tag:l}}if(0!==a.length){var d=this,c=function(s){e.log("Send:",a[s]),d._onStatusChange({id:n,action:"TIPS",level:t,data:[s,a.length],status:"busy"}),i.data=JSONDAO.stringify(a[s]),d._request(d._url.tips,i,(function(e){d._updateTips(e,n,t),++s<a.length?c(s):d._onStatusChange({id:n,action:"TIPS",level:t,status:"finish"})}))};c(0)}else this._onStatusChange({id:n,action:"TIPS",level:t,status:"finish"})},revertTips:function(){for(var e=++this.workingThread,t=0;t<this._nodeIndex.length;t++)e===this.workingThread&&this._manager.revertTips(this._nodeIndex[t])},_updateTips:function(t,n,i){if(t)if(40!==t.errorCode||30!==t.errorCode){var a=function(e,t){return e.start>t.start};e.each(t.data,(function(e,t){t.length>0?(this._bubbleSort(t,a),this._manager.tipsResults[e]=t,n===this.workingThread&&this._manager.replaceTips(e,i)):this._manager.tipsResults[e]=[]}),this)}else e.log("Get Error Code:",t.errorCode)},_bubbleSort:function(e,t){for(var n=e.length-2;n>=0;n--)for(var i=0;i<=n;i++)if(t(e[i+1],e[i])){var a=e[i];e[i]=e[i+1],e[i+1]=a}return e}},TR.isInclude=function(e){return!("SCRIPT"===e.tagName||"STYLE"===e.tagName||"PRE"===e.tagName||e.className&&/OUTFOX_JTR_/.test(e.className))},e.TR=TR}(J),!J||!J.bind)throw new Error("swipe extension need J.bind support");!function(e){var t="https://fanyi.youdao.com",n={isJapanese:function(e){return!Boolean(/[^\u0800-\u4e00]/.test(e))},isContainJapanese:function(e){for(var t=0,n=0;n<e.length;n++)this.isJapanese(e.charAt(n))&&t++;return t>2},isKoera:function(e){for(i=0;i<e.length;i++)if(e.charCodeAt(i)>12592&&e.charCodeAt(i)<12687||e.charCodeAt(i)>=44032&&e.charCodeAt(i)<=55203)return!0;return!1},isContainKoera:function(e){for(var t=0,n=0;n<e.length;n++)this.isKoera(e.charAt(n))&&t++;return t>0},isChinese:function(e){return!Boolean(/[^\u4e00-\u9fa5]/.test(e))},isContainChinese:function(e){for(var t=0,n=0;n<e.length;n++)this.isChinese(e.charAt(n))&&t++;return t>5}},a=function(e,t){return new a.fn.init(e,t)};a.fn=a.prototype={init:function(t,n){var i=this;this.wrapper=a.createFrameWrapper(),this.conn=a.initConnection(n),this.context=t,e.bind(document.body,"click",(function(e){e||window.event;i.wrapper.style.display="none",i.wrapper.style.position="absolute",i.wrapper.innerHTML=""}))},enableSwipe:function(){if(!this._swipeListener){var t=this;this._swipeListener=function(e){t._onSwipe.call(t,e)},e.bind(this.context,"mouseup",this._swipeListener)}},disableSwipe:function(){this._swipeListener&&(e.unbind(this.context,"mouseup",this._swipeListener),delete this._swipeListener)},_onSwipe:function(t){var n="",i="";window.getSelection?n=window.getSelection():document.selection&&(n=document.selection.createRange()),n.toString?i=n.toString():n.text&&(i=n.text.toString());var s=e.textPos(t,{});i=e.trim(i),a.validateSwipeWord(i)&&(this.swipeWord(i,s.x,s.y),this.onSwipeCallback&&this.onSwipeCallback(i))},swipeWord:function(e,t,i,s,r){var o=this,l=null;this.wrapper.innerHTML="",l=!n.isContainChinese(e)&&function(e){return e.split&&e.split(" ").length||0}(e)>=3||n.isContainChinese(e)||n.isContainJapanese(e)&&e.length>4?"translate":"dict",this.conn.request({action:l,word:e},(function(e){o.wrapper.innerHTML="",o._onResponse.call(o,e),a.initWrapper(o.wrapper,t,i,s,r)}))},_onResponse:function(e){var t=e.firstChild,n=null;if(t){switch(t.baseName&&"xml"==t.baseName&&(t=t.nextSibling),t.tagName){case"response":n=a.processXmlTransData(e);break;case"yodaodict":n=a.processXmlDictData(e);break;default:throw new Error("Incorrect xml data")}n&&(this.wrapper.appendChild(n),this.wrapper.style.display="block")}}},a.createFrameWrapper=function(){var t=document.createElement("div");return t.id="yddWrapper",e.bind(t,"click",(function(t){e.stopPropagation(t)})),e.bind(t,"mouseup",(function(t){e.stopPropagation(t)})),document.body.appendChild(t),t},a.validateSwipeWord=function(e){return!(""===e||e.length>2e3)},a.initConnection=function(n){var i=function(e){var t=null,n=null;return"dict"==e.action?(n={client:"JTRHelper",keyfrom:"JTRHelper.bookmark",q:e.word,pos:-1,doctype:"xml",xmlVersion:"3.2",dogVersion:"1.0",vendor:"jtr",le:"eng"},t="https://fanyi.youdao.com/fsearch"):(n={client:"JTRHelper",keyfrom:"JTRHelper.bookmark",i:e.word,doctype:"xml",xmlVersion:"1.1",dogVersion:"1.0"},t="https://fanyi.youdao.com/translate"),[t,n]};if(window.chrome&&window.chrome.runtime&&window.chrome.runtime.sendMessage)return{request:function(e,t){window.chrome.runtime.sendMessage(e,(function(e){e&&t((new DOMParser).parseFromString(e,"text/xml"))}))}};if(n)return{request:function(e,t){var a=i(e);n.ajax({url:a[0],handler:"translate",data:a[1],callback:t,dataType:"xml",type:"POST"})}};if(e.CDA){var a=null;try{a=e.CDA("_OUTFOX_JTR_SWIPE_CONN",t,CONN_FILE_PATH)}catch(e){throw new Error("Unable to get cross-domain ajax file.")}return{request:function(e,t){var n=i(e);a.ajax({url:n[0],handler:"translate",data:n[1],callback:t,dataType:"xml",type:"POST"})}}}throw new Error("Unable to initialize cross-domain connection port.")},a.initWrapper=function(t,n,i,a,s){var r=0,o=0,l=e.scroll().top,d=e.scroll().left,c=t.clientHeight,u=t.clientWidth,h=(e.getPageSize().window.height,e.getPageSize().window.width);a=a||0,s=s||0,o=i-c>=l+50?i-c:i+s,r=n+u<=h+d?n+a:h+d-u;var p=!("static"===e.css(document.body,"position")),f=e.css(document.body,"marginLeft"),m=e.css(document.body,"marginRight");if("auto"===f&&"auto"===m){var g=e.getPageSize().page.width,v=parseInt(e.css(document.body,"width"));f=g>v?(g-v)/2:0}f=p?parseInt(f):0;var T=p?parseInt(e.css(document.body,"marginTop")):0;e.css(t,{position:"absolute",left:r-f+"px",top:o-T+"px"})},a.processXmlTransData=function(t){var i=(t.getElementsByTagName("input")[0].childNodes[1]||t.getElementsByTagName("input")[0].childNodes[0]).nodeValue,s=(t.getElementsByTagName("translation")[0].childNodes[1]||t.getElementsByTagName("translation")[0].childNodes[0]).nodeValue,r=(t.getElementsByTagName("response")[0].getAttribute("errorCode"),e.trim(s)),o=e.trim(i);if((n.isContainChinese(o)||n.isContainJapanese(o)||n.isContainKoera(o))&&o.length>15?o=o.substring(0,8)+" ...":o.length>25&&(o=o.substring(0,15)+" ..."),o==r)return null;var l="https://fanyi.youdao.com/translate?i="+encodeURIComponent(i)+"&keyfrom=chrome";return e.formatTemplate('<div class="ydd-container">                          <div class="ydd-top-wrapper">                            <div class="ydd-top">                            </div>                          </div>                          <div class="ydd-body-wrapper">                            <div class="ydd-lb"></div>                            <div class="ydd-rb"></div>                            <div class="ydd-body">                              <div class="ydd-titile">                                <span>{input}</span>                                <span><a href="{searchURL}" target="_blank">详细&rsaquo;&rsaquo;</a></span>                              </div>                              <div class="ydd-middle">                                <div class="ydd-trans-wrapper ydd-simple-trans">                                  <div class="ydd-trans-container">{trans}</div>                                </div>                              </div>                            </div>                          </div>                          <div class="ydd-bottom-wrapper"><div class="ydd-bottom"></div></div>                          <div class="ydd-bg-top"></div></div>                        </div>',{searchURL:l,input:a.escapeHTML(o),trans:a.escapeHTML(s)})},a.processXmlDictData=function(t){var i,a,s,r,o=null,l=null,d=[],c=[],u=0,h=function(e){try{return t.getElementsByTagName(e)[0].firstChild.nodeValue}catch(e){return""}};if(i=h("return-phrase"),a=h("dictcn-speach"),s=h("lang"),r=h("phonetic-symbol"),(l=t.getElementsByTagName("translation"))&&l.length>0)for(u=0;u<l.length;u++)d.push(l[u].getElementsByTagName("content")[0].firstChild.nodeValue);if((o=t.getElementsByTagName("web-translation"))&&o.length>0)for(u=0;u<o.length-1;u++)c.push({key:o[u].getElementsByTagName("key")[0].firstChild.nodeValue,value:o[u].getElementsByTagName("trans")[0].getElementsByTagName("value")[0].firstChild.nodeValue});var p,f="https://dict.youdao.com/search?q="+encodeURIComponent(i)+"&keyfrom=chrome.extension"+s,m=i,g="",v="",T="";for('<div class="ydd-container">                      <div class="ydd-top-wrapper">                        <div class="ydd-top"></div>                      </div>                      <div class="ydd-body-wrapper">                        <div class="ydd-lb"></div>                        <div class="ydd-rb"></div>                        <div class="ydd-body">                          <div class="ydd-titile">                            <span class="ydd-key-title">{title}</span>                            <span class="ydd-phonetic">{phonetic}</span> {speechHTML} <span class="ydd-detail"><a href="{searchURL}" target="_blank">详细&rsaquo;&rsaquo;</a></span>                          </div>                          <div class="ydd-middle">                            <div class="ydd-trans-wrapper ydd-base-trans">                              <div class="ydd-tabs"><span class="ydd-tab">基本翻译</span></div>{baseTransHTML}</div>                              <div class="ydd-trans-wrapper ydd-web-trans">                                <div class="ydd-tabs"><span class="ydd-tab">网络释义</span></div>{webTransHTML}</div>                              </div>                            </div>                          </div>                        <div class="ydd-bottom-wrapper">                          <div class="ydd-bottom"><a href="https://www.youdao.com/search?q={title}&keyfrom=fanyi.jtr" target="_blank" title="使用有道搜索 {title}">搜索&nbsp;{title}</a></div>                        </div>                        <div class="ydd-bg-top"></div>                      </div>                    </div>',(n.isContainChinese(m)||n.isContainJapanese(m)||n.isContainKoera(m))&&m.length>15?m=m.substring(0,10)+"...":m.length>25&&(m=m.substring(0,15)+" ..."),d.length+c.length>0&&a&&(g='<span class="ydd-voice">'+function(e){return'<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="https://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=7,0,0,0" width="15px" height="15px" align="absmiddle" id="speach_flash"><param name="allowScriptAccess" value="sameDomain" /><param name="movie" value="https://cidian.youdao.com/chromeplus/voice.swf" /><param name="loop" value="false" /><param name="menu" value="false" /><param name="quality" value="high" /><param name="wmode"  value="transparent"><param name="FlashVars" value="audio='+e+'"><embed wmode="transparent" play="false" src="https://cidian.youdao.com/chromeplus/voice.swf" loop="false" menu="false" quality="high" bgcolor="#ffffff" width="15" height="15" align="absmiddle" allowScriptAccess="sameDomain" FlashVars="audio='+e+'" type="application/x-shockwave-flash" pluginspage="https://www.macromedia.com/go/getflashplayer" /></object>'}("https://dict.youdao.com/speech?audio="+a)+"</span>"),u=0;u<d.length;u++)v+='<div class="ydd-trans-container">'+d[u]+"</div>";for(u=0;u<c.length;u++){T+='<div class="ydd-trans-container"><a href="'+("https://dict.youdao.com/search?q="+encodeURIComponent(c[u].key)+"&keyfrom=chrome.extension"+s)+'" target="_blank">'+c[u].key+":</a> "+c[u].value+"</div>"}p=e.formatTemplate('<div class="ydd-container">                      <div class="ydd-top-wrapper">                        <div class="ydd-top"></div>                      </div>                      <div class="ydd-body-wrapper">                        <div class="ydd-lb"></div>                        <div class="ydd-rb"></div>                        <div class="ydd-body">                          <div class="ydd-titile">                            <span class="ydd-key-title">{title}</span>                            <span class="ydd-phonetic">{phonetic}</span> {speechHTML} <span class="ydd-detail"><a href="{searchURL}" target="_blank">详细&rsaquo;&rsaquo;</a></span>                          </div>                          <div class="ydd-middle">                            <div class="ydd-trans-wrapper ydd-base-trans">                              <div class="ydd-tabs"><span class="ydd-tab">基本翻译</span></div>{baseTransHTML}</div>                              <div class="ydd-trans-wrapper ydd-web-trans">                                <div class="ydd-tabs"><span class="ydd-tab">网络释义</span></div>{webTransHTML}</div>                              </div>                            </div>                          </div>                        <div class="ydd-bottom-wrapper">                          <div class="ydd-bottom"><a href="https://www.youdao.com/search?q={title}&keyfrom=fanyi.jtr" target="_blank" title="使用有道搜索 {title}">搜索&nbsp;{title}</a></div>                        </div>                        <div class="ydd-bg-top"></div>                      </div>                    </div>',{phonetic:r?"["+r+"]":"",title:m,searchURL:f,speechHTML:g,baseTransHTML:v,webTransHTML:T});var y=e.query(".ydd-middle",p)[0];l=e.query(".ydd-base-trans",y)[0],o=e.query(".ydd-web-trans",y)[0],d.length+c.length===0&&(y.innerHTML='<p class="ydd-no-result">没有英汉互译结果</p>');try{0===d.length?y.removeChild(l):0===c.length&&y.removeChild(o)}catch(e){}return p};var s={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};a.escapeHTML=function(e){return String(e).replace(/[&<>"'\/]/g,(function(e){return s[e]}))},a.fn.init.prototype=a.fn,e.Swipe=a}(J),function(e){var t=function(t,n,i){var a=this;if(!e.isDOM(t))throw Error("Invalid slider container element");if(this.container=t,!e.isDOM(n))throw Error("Invalid slider controller block element");this.controller=n;for(var s=this.container;s;s=s.parentNode)if(9===s.nodeType){this.document=s;break}if(!s)throw Error("Can't find parent Document element of container, container dom node should insert to document first");if(e.isDOM(i.bar)?this.bar=i.bar:this.bar=null,this.range=Number(i.max-i.min),!(this.range&&this.range>0))throw Error("range must greater than 0");e.isFunction(i.callback)&&(this.callback=function(e){i.callback.call(a,e)}),this.borderFix=Number(i.borderFix)||0,this.mousemove=function(e){a._mousemove(e)},this.mouseup=function(e){a._mouseup(e)},this.mousedown=function(e){a._mousedown(e)}};t.prototype={enable:function(){e.bind(this.container,"mousedown",this.mousedown)},disable:function(){e.unbind(this.container,"mousedown",this.mousedown)},to:function(e,t){var n=this;tempFunc=function(){if(n.container.offsetHeight&&n.container.clientWidth){var t=n.container.clientWidth-n.controller.clientWidth-2*n.borderFix;pos=e/n.range*t,n._valueChange(pos/t*n.range,pos)}else setTimeout(tempFunc,200)},tempFunc()},_mousemove:function(e){var t=e||window.event;this._moveHandler(t,!1)},_mouseup:function(t){var n=t||window.event;this._moveHandler(n,!0),e.unbind(this.document,"mouseup",this.mouseup),e.unbind(this.document,"mousemove",this.mousemove),this.container.style.cursor="pointer"},_mousedown:function(t){var n=t||window.event;this._moveHandler(n,!1),e.bind(this.document,"mouseup",this.mouseup),e.bind(this.document,"mousemove",this.mousemove),n.preventDefault&&n.preventDefault(),n.returnValue=!1},_moveHandler:function(t,n){var i=t.clientX-.5*this.controller.clientWidth-e.findPos(this.container).x-this.borderFix,a=this.container.clientWidth-this.controller.clientWidth-2*this.borderFix,s=a/this.range,r=s/2,o=i%s,l=0;i<0?(i=0,o=0):i>a&&(i=a,o=0),l=n&&o<r?i-o:n&&o>s-r?i-o+s:i,this._valueChange(l/a*this.range,l)},_valueChange:function(e,t){this.callback(e),this.controller.style.left=t+this.borderFix+"px",this.bar&&(this.bar.style.width=t+this.controller.clientWidth/2+"px")}},e.Slider=t}(J),function(e){var t=function(){this.nodes=[],this.originals={},this.transResults={},this.tipsResults={}};t.prototype={addNode:function(e,t){var n=0;if(!t)for(;n<this.nodes.length;n++)if(this.nodes[n]===e)return n;return this.nodes.push(e),this.originals[n]=e.nodeValue,n},replaceTrans:function(e){if(this.nodes[e]&&this.transResults[e]){var t=this.nodes[e],n=document.createElement("font"),i=this.transResults[e];try{if(t.nodeValue===i)return!1;if(!t.parentNode)return}catch(e){return}t.nodeValue="",n.className="OUTFOX_JTR_TRANS_NODE",n.id="OUTFOX_JTR_TRANS_NODE-"+e,n.setAttribute("rel",e),n.innerHTML=i;try{t.parentNode.insertBefore(n,t.nextSibling)}catch(e){}}},revertTrans:function(t){if(this.nodes[t]&&this.originals[t]){var n=e.query("#OUTFOX_JTR_TRANS_NODE-"+t);n&&n.parentNode&&n.parentNode.removeChild(n);try{this.nodes[t].nodeValue=this.originals[t]}catch(e){}}},replaceTips:function(t,n){var i=n||-1;this.nodes[t]&&this.tipsResults[t]&&e.each(this.tipsResults[t],(function(e,n){if(!(n.level&&n.level<i)){var a=this.nodes[t],s=n.start,r=n.end,o=n.explain;if(void 0!==typeof a.parentNode){var l=document.createElement("font");l.className="OUTFOX_NANCI_WRAPPER";try{var d=a.nodeValue.substr(0,s),c=a.nodeValue.substr(s,r-s),u=a.nodeValue.substr(r);a.nodeValue=d,l.innerHTML=c,a.parentNode.insertBefore(document.createTextNode(u),a.nextSibling),a.parentNode.insertBefore(l,a.nextSibling);var h=document.createElement("font");h.className="OUTFOX_NANCI_TIPS",h.setAttribute("rel",t),h.innerHTML="("+o+")",l.parentNode.insertBefore(h,l.nextSibling)}catch(e){}}}}),this)},revertTips:function(e){var t;if(this.nodes[e])do{try{t=!this.revertTip(this.nodes[e].nextSibling)}catch(e){t=!0}}while(!t)},revertTip:function(t){if(e.hasClass(t,"OUTFOX_NANCI_WRAPPER")&&t.firstChild){var n=t.nextSibling;return e.hasClass(n,"OUTFOX_NANCI_TIPS")&&n.parentNode.removeChild(n),t.nextSibling&&3===t.nextSibling.nodeType&&(t.firstChild.nodeValue+=t.nextSibling.nodeValue,t.parentNode.removeChild(t.nextSibling)),t.previousSibling&&3===t.previousSibling.nodeType&&(t.previousSibling.nodeValue+=t.firstChild.nodeValue,t.parentNode.removeChild(t)),!0}return!1},countTips:function(t){var n=0;return e.each(this.tipsResults,(function(e,i){for(var a=0;a<i.length;a++)i[a].level>=t&&n++}),this),n}},e.NodeManager=t}(J),function(e){var t=function(){this.map={},this.dataMap={}};t.prototype={getId:function(t){var n=null;return e.each(this.map,(function(e,i){if(i===t)return n=e,!1})),null===n&&(n=e.guid(),this.map[n]=t),n},data:function(e,t,n){var i=this.getId(e);if(3===arguments.length)return this.dataMap[i]||(this.dataMap[i]={}),this.dataMap[i][t]=n,n;var a=null;try{a=this.dataMap[i][t]}catch(e){a=void 0}return a}},e.Cache=t}(J),function(e){var t=function(t){this.contentDocument=t,this.cache=new e.Cache};t.prototype={IGNORE_TAGS:["HTML","HEAD","META","TITLE","SCRIPT","STYLE","LINK","IMG","FORM","INPUT","BUTTON","TEXTAREA","SELECT","OPTION","LABEL","IFRAME","UL","OL","LI","DD","DT","A","OBJECT","PARAM","EMBED","NOSCRIPT","EM","B","STRONG","I","INS","BR","HR","PRE","H1","H2","H3","H4","H5","CITE"],getMainArticle:function(){return null},_getAllArticle:function(){for(var e=this.contentDocument.getElementsByTagName("*"),t=[],i=0,a=e.length>100?100:e.length;i<a;i++){var s=e[i];this._checkTagName(s)&&this._checkSize(s)&&this._checkVisibility(s)&&(t[t.length]=new n(s))}return t},_checkTagName:function(t){return-1==e.indexOf(this.IGNORE_TAGS,t.tagName)},_checkVisibility:function(t){return!("hidden"==e.css(t,"visibility")||"none"==e.css(t,"display")||parseInt(e.css(t,"height"))<=0||parseInt(e.css(t,"width"))<=0)},_checkSize:function(e){return e.offsetWidth>300&&e.offsetHeight>200}};var n=function(e){this.elem=e,this._texts=this._getAllTexts(),this.weight=this.calcWeight()};n.prototype={IGNORE_TAGS:["A","DD","DT","OL","OPTION","PRE","SCRIPT","STYLE","UL","IFRAME"],MINOR_REGEXP:/comment|combx|disqus|foot|header|menu|rss|shoutbox|sidebar|sponsor/i,MAJOR_REGEXP:/article|entry|post|body|column|main|content/i,TINY_REGEXP:/comment/i,BLANK_REGEXP:/\S/i,_getAllTexts:function(){for(var t=[],n=e.getTextNodes(this.elem),i=0,a=n.length;i<a;i++){var s=n[i];if(this._checkTagName(s)&&this._checkLength(s)){var r=s.parentNode||{},o=r.parentNode||{};this._checkMinorContent(r)||this._checkMinorContent(o)||t.push(s)}}return t},calcStructWeight:function(){for(var e=0,t=0,n=this._texts.length;t<n;t++){var i=this._texts[t],a=i.nodeValue.length,s=1;if(!(a>20)){for(var r=i.parentNode;r&&r!=this.elem;r=r.parentNode)s-=.1;e+=Math.pow(a*s,1.25)}}return e},calcContentWeight:function(){for(var e=1,t=this.elem;t;t=t.parentNode){var n=t.id+" "+t.className;this.MAJOR_REGEXP.test(n)&&(e+=.4),this.MINOR_REGEXP.test(n)&&(e-=.8)}return e},calcWeight:function(){return this.calcStructWeight()*this.calcContentWeight()},_checkTagName:function(t){return-1==e.indexOf(this.IGNORE_TAGS,t.tagName)},_checkLength:function(e){return Boolean(this.BLANK_REGEXP.test(e.nodeValue))},_checkMinorContent:function(e){return Boolean(this.TINY_REGEXP.test(e.id+" "+e.className))}},e.Page=t}(J),function(e){var t={runCount:0,swipe:!0,mode:"TRANS",level:"0"},n={0:["TIPS",3],1:["TIPS",2],2:["TIPS",1],3:["TRANS","0"],4:["NONE","NONE"]};e.TR.UI=function(t,i){var a=this;this.initLogger(i.logURL),this.log({action:"start"}),this.guid=e.guid(),this.context=t,this.conn=e.CDA("OUTFOX_JTR_CDA",i.domain,i.connFilePath),this.update=i.update,this.updateTipMsg=i.updateTipMsg,this.updateDate=i.updateDate,this.manager=new e.NodeManager,this.barHeight=50,this.permissionDenied="由于该网页存在安全性限制, 无法加载有道网页翻译2.0",this.translator=new e.TR(t,{reqSize:i.reqSize,onStatusChange:function(){a._trStatusChangeCallback.apply(a,arguments)},url:{textTrans:i.transURL,tips:i.tipsURL},guid:this.guid},this.conn,this.manager),this.queue={TRANS:{0:{currentThread:-1}},TIPS:{1:{currentThread:-1},2:{currentThread:-1},3:{currentThread:-1}},NONE:{NONE:{}}},this.mode=null,this.level=null,this.initFrame(i.cssURL,(function(){var t=this;location&&location.href,this.movePage(t.barHeight),this.frame.body.innerHTML='<div id="wrapper"><a href="https://fanyi.youdao.com/web2/?keyfrom=headerLogo" target="_blank"><h1 id="headerLogo" class="logo"></h1></a><div id="sliderLabel" style="display: none;">翻译级别</div><div id="sliderWrapper" class="slider-wrapper" style="display: none;"><div id="levelLabel"><label id="level-3" rel="0"><a>专&nbsp;&nbsp;&nbsp;家</a></label><label id="level-2" rel="1"><a>进&nbsp;&nbsp;&nbsp;阶</a></label><label id="level-1" rel="2"><a>入&nbsp;&nbsp;&nbsp;门</a></label><label id="level-0" rel="3"><a>全文翻译</a></label></div><div id="sliderContainer" class="slider-container"><div id="sliderBackground"><div class="slider-background"></div></div><a id="slider" href="javascript:void(0);" class="slider"></a></div></div><div id="status"></div><div id="switchWrapper"><a id="switch" href="javascript:void(0);"></a></div></div><a id="OUTFOX_JTR_BAR_CLOSE" href="javascript:void(0);" class="OUTFOX_JTR_BAR_CLOSE"></a><div id="OUTFOX_JTR_BAR_UPDATE_SHADE"></div><div id="OUTFOX_JTR_BAR_CLOSE_UPDATE_TIP"><div id="OUTFOX_JTR_BAR_CLOSE_UPDATE_TIP_CONTENT"></div></div>',this.initTipContent(),this.initBarClose(),this.initSwitch(),this.initSlider(),this.initLabel(),this.initTipsCtrl(),this.initTransTip(),this.initSwipe();this.conn.ajax({handler:"localStorage",data:{key:"settings"},dataType:"json",callback:function(i){!function(i){t.loadSetting(i),t.enable(),t.writeSettings({runCount:t.settings.runCount+1}),e.each(n,(function(e,n){t.mode===n[0]&&t.level===n[1]&&t.slider.to(e)}))}(i)}})}))},e.TR.UI.prototype={positionElementInViewPort:function(t){var n=t.tip,i=t.target,a=!("static"===e.css(document.body,"position")),s=e.css(document.body,"marginLeft"),r=e.css(document.body,"marginRight");if("auto"===s&&"auto"===r){var o=e.getPageSize().page.width,l=parseInt(e.css(document.body,"width"));s=o>l?(o-l)/2:0}s=a?parseInt(s):0;var d=a?parseInt(e.css(document.body,"marginTop")):0,c=e.findPos(i),u=0,h=0,p=e.scroll().top,f=e.scroll().left,m=c.x,g=c.y,v=i.offsetHeight,T=n.clientHeight,y=n.clientWidth,b=(e.getPageSize().window.height,e.getPageSize().window.width);u=g-T>=p+this.barHeight?g-T:g+v,h=m+y<=b+f?m:b+f-y,e.css(t.tip,{position:"absolute",top:u-d+"px",left:h-s+"px"})},disable:function(){this.changeMode("NONE","NONE"),this.slider.disable(),this.frame.body.className="disable",this.disabled=!0,this.updateStatus(),this.switchElem.innerHTML="重新翻译"},enable:function(){this.changeMode(this.settings.mode,this.settings.level),this.slider.enable(),e.removeClass(this.frame.body,"disable"),e.addClass(this.frame.body,"enable"),this.disabled=!1,this.updateStatus(),this.switchElem.innerHTML="取消翻译"},_trStatusChangeCallback:function(e){if(e.id&&e.action&&e.level){var t=this.queue[e.action][e.level];t.currentThread<=e.id&&(t.currentThread=e.id,t.status=e.status,t.data=e.data||null,e.action===this.mode&&e.level===this.level&&this.updateStatus())}},updateStatus:function(){var t=this.queue[this.mode][this.level];if(e.removeClass(this.statusElem.parentNode,"statistic"),"busy"===t.status&&t.data){this.switchElem.style.visibility="hidden";var n=parseInt(100*t.data[0]/t.data[1],10);"TRANS"===this.mode?this.statusElem.innerHTML="正在翻译&nbsp;"+n+"%&nbsp;...":this.statusElem.innerHTML="正在分析&nbsp;"+n+"%&nbsp;...",this.statusElem.className="busy"}else if("finish"===t.status){if(this.switchElem.style.visibility="inherit","TRANS"===this.mode)this.statusElem.innerHTML="翻译完成";else{var i=this.manager.countTips(this.level);0!==i?(e.addClass(this.statusElem.parentNode,"statistic"),this.statusElem.innerHTML='共注释<span class="OUTFOX_BAR_TOTAL_NUM">'+i+"</span>个难词"):this.statusElem.innerHTML="恭喜您！该网页上没有难词~"}this.statusElem.className="finish"}else this.switchElem.style.visibility="inherit",this.statusElem.innerHTML="翻译助手已关闭",this.statusElem.className="finish"},initLogger:function(e){this.logURL=e,this._logImgCache=[]},log:function(t){if(this.logURL){t.relatedURL=document.location.href,t.guid=this.guid;var n=new Image;n.src=this.logURL+"?"+e.param(t)+"&"+(new Date).getTime(),this._logImgCache[this._logImgCache.length]=n}},initSwipe:function(){var t=this;this.swipe=e.Swipe(this.context,this.conn),this.swipe.onSwipeCallback=function(e){t.log({action:"swipeWord",word:e})}},movePage:function(t){if(e.browser.msie){var n=e.css(this.context,"paddingTop");try{n=parseInt(n)}catch(e){n=0}this.context.style.cssText+=";padding-top:"+(t+n)+"px !important;"}else{var i=e.css(this.context,"marginTop");try{i=parseInt(i)}catch(e){i=0}"static"===e.css(this.context,"position")&&e.css(this.context,{position:"relative"}),this.context.style.cssText+=";margin-top:"+(t+i)+"px !important;"}notifyEdgeTranslate("page_moved",{translator:"youdao",distance:t})},initFrame:function(t,n){var i=this,a=document.createElement("div");a.id="OUTFOX_BAR_WRAPPER",this.context.appendChild(a),notifyEdgeTranslate("banner_created",{translator:"youdao"}),this.wrapper=a;var s=function(t){t.innerHTML='<iframe id="OUTFOX_JTR_BAR" src="" style="display:none;"></iframe>';var n=e.query("#OUTFOX_JTR_BAR");return n.setAttribute("frameBorder",0),e.browser.msie&&document.domain!=window.location.hostname&&(n.src="javascript:void(document.write(\"<script>document.domain='"+document.domain+"';<\/script><body></body>\"))"),!e.browser.msie||"8.0"===e.browser.msie&&"CSS1Compat"===document.compatMode||(e.css(n,{width:e.getPageSize().window.width+"px"}),e.bind(window,"resize",(function(t){e.css(n,{width:e.getPageSize().window.width+"px"})}))),n}(a);this.iframe=s,setTimeout((function(){try{i.frame=s.contentDocument||s.contentWindow.document}catch(e){return i.log({action:"secRestrict",relatedURL:window.location.href}),void alert(i.permissionDenied)}e.css(s,{display:"block"}),e.addClass(s,"OUTFOX_JTR_BAR"),e.loadCSS(i.frame,t),i.frame.body.id="OUTFOX_JTR_BAR_BODY",e.addClass(i.frame.body,"forbid-select"),i.frame.body.onselectstart=i.frame.body.ondrag=function(){return!1},n.call(i)}),100)},initBarClose:function(){var t=this,n=this.frame.getElementById("OUTFOX_JTR_BAR_CLOSE");e.addClass(n,"OUTFOX_JTR_BAR_CLOSE"),e.bind(window,"resize",(function(t){e.css(n,{top:"1px",right:"1px"})})),e.bind(n,"click",(function(){t.disable(),t.movePage(-t.barHeight),t.context.removeChild(t.wrapper);var n=e.query("#OUTFOX_JTR_CDA");n&&t.context.removeChild(n),(n=e.query("#yddWrapper"))&&t.context.removeChild(n),(n=e.query("#outfox_seed_js"))&&t.context.removeChild(n)}))},initTipContent:function(){if(this.update){var t=this;t.conn.ajax({handler:"localStorage",data:{key:"date"},callback:function(n){n!==t.updateDate&&(!function(){var n=e.query("#OUTFOX_JTR_BAR_CLOSE_UPDATE_TIP_CONTENT",t.frame),i=e.query("#OUTFOX_JTR_BAR_UPDATE_SHADE",t.frame),a=e.query("#OUTFOX_JTR_BAR_CLOSE_UPDATE_TIP",t.frame);n.innerHTML="更新提示：<br/>"+t.updateTipMsg+'<span class="update-date">'+t.updateDate+'</span><a href="javascript:void(0);" id="OUTFOX_JTR_BAR_CLOSE_UPDATE_TIP_CONTENT_CLOSE"></a>';var s=e.query("#OUTFOX_JTR_BAR_CLOSE_UPDATE_TIP_CONTENT_CLOSE",t.frame);e.css(i,{display:"block"}),e.css(a,{display:"block"}),e.bind(s,"click",(function(){e.css(i,{display:"none"}),e.css(a,{display:"none"})}))}(),t.conn.ajax({handler:"localStorage",data:{key:"date",value:t.updateDate}}))}})}},initSwitch:function(){var t=this;this.statusElem=e.query("#status",this.frame),this.switchElem=e.query("#switch",this.frame),e.bind(this.switchElem,"click",(function(e){t.disabled?t.enable():t.disable()}))},initLabel:function(){this.labels=[];for(var t=this,i=function(i){var a=i||window.event,s=(a.target||a.srcElement).parentNode.getAttribute("rel");t.disabled||s&&(t.changeMode(n[s][0],n[s][1]),e.each(n,(function(e,n){t.mode===n[0]&&t.level===n[1]&&t.slider.to(e)})))},a=0;a<4;a++)this.labels[a]=e.query("#level-"+a,this.frame),e.bind(this.labels[a],"click",i)},initSlider:function(){var t=e.query("#sliderContainer",this.frame),n=e.query("#slider",this.frame),i=this,a=null;this.slider=new e.Slider(t,n,{bar:e.query("#sliderBackground",this.frame),max:3,min:0,step:1,borderFix:-3,callback:function(e){clearTimeout(a),a=setTimeout((function(){i._valueChange(e)}),10)}})},loadSetting:function(n){var i={};if(null===n||"[object Object]"!==Object.prototype.toString.call(n))this.conn.ajax({handler:"localStorage",dataType:"json",data:{key:"settings",value:JSONDAO.stringify(t)}}),i=t;else for(var a in t)t.hasOwnProperty(a)&&(i[a]=n.hasOwnProperty(a)?n[a]:t[a]);i.mode=i.mode||t.mode,i.level=i.level||t.level,e.log("Load Settings:",i),this.settings=i},_valueChange:function(e){var t=Math.round(e),i=n[t][0],a=n[t][1];i!==this.mode?this.changeMode(i,a):a!==this.level&&this.changeLevel(a)},changeMode:function(e,t){if("TIPS"===this.mode){for(var n=1;n<=3;n++)this.labels[n].className="deactive";this.translator.revertTips()}else"TRANS"===this.mode&&(this.labels[0].className="deactive",this.translator.revertTrans());this.swipe.disableSwipe(),this.disableTransTip(),this.disableTipsCtrl(),this.mode=e,this.changeLevel(t)},changeLevel:function(t){if(e.log("Change level to:",t),null===this.level?this.log({action:"view",level:t}):this.log({action:"changeLevel",oldLevel:this.level,newLevel:t}),this.level=t,"TIPS"===this.mode){this.swipe.enableSwipe();for(var n=1;n<=3;n++)this.labels[n].className=n==t?"active":"deactive";this.translator.revertTips(),this.translator.doTips(this.level),this.enableTipsCtrl()}else"TRANS"===this.mode&&(this.labels[0].className="active",this.translator.doTrans(),this.enableTransTip());"NONE"!==this.mode&&this.writeSettings({mode:this.mode,level:this.level})},writeSettings:function(t){e.each(t,(function(e,t){this.settings[e]=t}),this),this.conn.ajax({handler:"localStorage",dataType:"json",data:{key:"settings",value:JSONDAO.stringify(this.settings)}})},initTipsCtrl:function(){var t=this,n=this.initTipsCtrlElem(),i=null;this.tipsTarget=null,this.tipsCtrlHandler=function(a){var s=a||window.evt,r=s.target||s.srcElement;clearTimeout(i),r===t.tipsTarget||r.className&&-1!==r.className.indexOf("OUTFOX_JTR_NANCI_")||(i=setTimeout((function(){if(n.parentNode&&n.parentNode.removeChild(n),e.hasClass(r,"OUTFOX_NANCI_TIPS")){var i=e.findPos(r),a=e.query(".OUTFOX_JTR_NANCI_CTRL_WORD",n)[0];t.context.appendChild(n),a.innerHTML=r.innerHTML;var s=e.css(r,"fontSize"),o=e.css(r,"fontFamily");try{-1!=s.indexOf("em")||parseInt(s)<12&&(s="12px")}catch(e){s="12px"}var l=!("static"===e.css(document.body,"position")),d=e.css(document.body,"marginLeft"),c=e.css(document.body,"marginRight");if("auto"===d&&"auto"===c){var u=e.getPageSize().page.width,h=parseInt(e.css(document.body,"width"));d=u>h?(u-h)/2:0}d=l?parseInt(d):0;var p=l?parseInt(e.css(document.body,"marginTop")):0;e.css(a,{fontSize:s}),e.css(a,{fontFamily:o}),e.css(n,{left:i.x-d+"px",top:i.y-p+"px",position:"absolute"}),t.tipsTarget=r}else t.tipsTarget=null}),200))}},initTipsCtrlElem:function(){var t=document.createElement("span"),n=document.createElement("span"),i=document.createElement("a"),a=document.createElement("span"),s=document.createElement("a"),r=document.createElement("span"),o=this;r.className="OUTFOX_JTR_NANCI_CTRL_WORD",t.appendChild(r),i.className="OUTFOX_JTR_NANCI_CTRL_DETAIL",i.setAttribute("title","查看详细解释"),i.innerHTML="详解",n.appendChild(i),n.className="OUTFOX_JTR_NANCI_CTRL_DETAIL_BG",t.appendChild(n),s.className="OUTFOX_JTR_NANCI_CTRL_CLOSE",s.setAttribute("title","我知道了"),s.innerHTML="关闭",a.appendChild(s),a.className="OUTFOX_JTR_NANCI_CTRL_CLOSE_BG",t.appendChild(a),t.className="OUTFOX_JTR_NANCI_BAR";var l=function(){var e=null;try{e=o.tipsTarget.previousSibling}catch(e){}return e};return e.bind(i,"click",(function(n){var i=l();if(i&&o.swipe){o.log({action:"viewDetail",word:i.innerHTML}),function(e){var t=null;if(document.createRange){var n=window.getSelection();t=document.createRange(),n.removeAllRanges(),t.selectNode(e),n.addRange(t)}else document.body.createTextRange&&((t=document.body.createTextRange()).moveToElementText(e),t.select())}(i);var a=document.createElement("font");a.innerHTML="&nbsp",i.appendChild(a);var s=e.findPos(a),r=a.offsetHeight;i.removeChild(a),o.swipe.swipeWord(i.firstChild.nodeValue,s.x,s.y,0,r)}t.parentNode.removeChild(t),e.removeClass(o.tipsTarget,"on")})),e.bind(s,"click",(function(n){t.getAttribute("rel");var i=l();i&&(o.log({action:"closeTip",word:i.innerHTML,tip:o.tipsTarget.innerHTML}),o.translator._manager.revertTip(i)),t.parentNode.removeChild(t),e.removeClass(o.tipsTarget,"on")})),t},_findTipCtrlPosition:function(t,n){var i=t.firstChild,a=i.nodeValue,s=i.nodeValue.length,r=document.createElement("font"),o=document.createTextNode(""),l=[0,0],d=null,c=null,u=0,h=0,p=s,f=null;e.css(r,{border:"none",padding:0,margin:0});for(var m=0;m<=s;m++)o.nodeValue=i.nodeValue.substr(m),i.nodeValue=i.nodeValue.substr(0,m),t.insertBefore(o,i.nextSibling),t.insertBefore(r,i.nextSibling),(c=e.findPos(r)).x-n[0],(u=c.y-n[1])<=0&&(null===d||u>d)&&(f=d=u,l[0]=c.x,l[1]=c.y,null,h=m),u!==f&&(p=m,f=u),i.nodeValue=a,t.removeChild(o),t.removeChild(r);return r.innerHTML=i.nodeValue.substr(h,p),i.nodeValue=i.nodeValue.substr(0,h),t.insertBefore(r,i.nextSibling),l[0]+=r.offsetWidth,t.removeChild(r),i.nodeValue=a,l},preventClose:function(){e.css(e.query("#OUTFOX_JTR_BAR_CLOSE",this.frame),{display:"none"})},enableTipsCtrl:function(){e.bind(this.context,"mouseover",this.tipsCtrlHandler)},disableTipsCtrl:function(){e.unbind(this.context,"mouseover",this.tipsCtrlHandler)},enableTransTip:function(){e.bind(this.context,"mouseover",this.transTipHandler)},disableTransTip:function(){e.unbind(this.context,"mouseover",this.transTipHandler)},initTransTip:function(t){var n=this,i=null,a=null;this.initTransTipElem("",""),this.transTipHandler=function(t){var s=t||window.event,r=s.target||s.srcElement;clearTimeout(a),a=setTimeout((function(){if(i!==r&&(!r.className||-1===r.className.indexOf("OUTFOX_JTR_TRANSTIP_")&&-1===r.className.indexOf("ydd-")))if(i&&(i.style.textDecoration="none"),n.transTipElem.elem.parentNode&&n.transTipElem.elem.parentNode.removeChild(n.transTipElem.elem),e.hasClass(r,"OUTFOX_JTR_TRANS_NODE")){i=r;var t=r.getAttribute("rel"),a=n.translator._manager;n.resetTransTipElem(a.originals[t],a.transResults[t],t),n.context.appendChild(n.transTipElem.elem),n.positionElementInViewPort({target:r,tip:n.transTipElem.elem}),r.style.textDecoration="underline"}else i=null}),200)}},initTransTipElem:function(){var t=this,n=document.createElement("div");n.className="OUTFOX_JTR_TRANSTIP_WRAPPER";var i=document.createTextNode(""),a=document.createTextNode("");n.innerHTML+='<div class="OUTFOX_JTR_TRANSTIP_ORIGIN">                                        <div class="ydd-container">                                          <div class="ydd-top-wrapper">                                            <div class="ydd-top">                                            </div>                                          </div>                                          <div class="ydd-body-wrapper">                                            <div class="ydd-lb"></div>                                            <div class="ydd-rb"></div>                                            <div class="ydd-body">                                              <div class="ydd-title">                                                <strong>原文：</strong>                                              </div>                                              <div class="ydd-middle">                                                <div class="OUTFOX_JTR_TRANSTIP_ORIGIN_TEXT"></div>                                                <div class="OUTFOX_JTR_TRANSTIP_ADVISE">                                                  <textarea class="OUTFOX_JTR_TRANSTIP_ADVISE_TEXT"></textarea>                                                  <a class="OUTFOX_JTR_TRANSTIP_ADVISE_SUBMIT" href="javascript:void(0);">提交翻译建议</a>                                                </div>                                              </div>                                            </div>                                          </div>                                          <div class="ydd-bottom-wrapper">                                            <div class="ydd-bottom">                                              <a class="OUTFOX_JTR_TRANSTIP_ADVISE_TOGGLE">更好的翻译建议</a>                                              <span class="OUTFOX_JTR_TRANSTIP_ADVISE_THANK">感谢您为有道提供建议^_^</span>                                            </div>                                          </div>                                          <div class="ydd-bg-top"></div>                                        </div>                                      </div>',e.query(".OUTFOX_JTR_TRANSTIP_ORIGIN_TEXT",n)[0].appendChild(a),e.query(".OUTFOX_JTR_TRANSTIP_ADVISE_TEXT",n)[0].appendChild(i);var s=e.query(".OUTFOX_JTR_TRANSTIP_ADVISE_TOGGLE",n)[0],r=e.query(".OUTFOX_JTR_TRANSTIP_ADVISE_SUBMIT",n)[0],o=e.query(".OUTFOX_JTR_TRANSTIP_ADVISE",n)[0],l=e.query(".ydd-bottom",n)[0],d=e.query(".OUTFOX_JTR_TRANSTIP_ADVISE_TEXT",n)[0];r.hideFocus=!0,e.bind(s,"click",(function(){e.toggleClass(o,"expand"),e.css(s,{display:"none"})}));e.bind(r,"click",(function(){var n=d.value;if(""!==n){n=function(e){return e.replace(/</g,"&lt;").replace(/>/g,"&gt;")}(n),e.addClass(o,"finish"),e.removeClass(o,"expand"),e.addClass(l,"OUTFOX_JTR_TRANSTIP_ADVISE_THANK_TIP");var i=t.transTipElem.index;i&&t.manager.transResults[i]&&(t.manager.transResults[i]=n,t.manager.revertTrans(i),t.manager.replaceTrans(i))}else alert("翻译建议不能为空，请您输入内容后再次提交")})),this.transTipElem={elem:n,transTextContainer:d,trans:i,original:a,toggle:s,submit:r,advise:o,bottom:l,index:null}},resetTransTipElem:function(t,n,i){e.removeClass(this.transTipElem.advise,"finish"),e.removeClass(this.transTipElem.advise,"expand"),e.removeClass(this.transTipElem.bottom,"OUTFOX_JTR_TRANSTIP_ADVISE_THANK_TIP"),this.transTipElem.toggle.innerHTML="提交翻译建议",e.css(this.transTipElem.toggle,{display:""}),this.transTipElem.transTextContainer.value=n,this.transTipElem.original.nodeValue=t,this.transTipElem.index=i}}}(J),function(e){var t="https://fanyi.youdao.com",n=chrome.runtime.getURL("youdao/conn.html"),i=chrome.runtime.getURL("youdao/main.css");e.loadCSS(document,i),window.OUTFOX_JavascriptTranslatoR=new e.TR.UI(document.body,{domain:t,update:!1,updateTipMsg:"修复链接错误",updateDate:"2013-12-24",cssURL:i,tipsURL:"https://fanyi.youdao.com/web2/index.do",transURL:"https://fanyi.youdao.com/jtr",connFilePath:n,reqSize:20})}(J);