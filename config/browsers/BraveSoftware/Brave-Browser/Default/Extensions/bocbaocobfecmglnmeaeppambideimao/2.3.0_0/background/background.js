(()=>{var e={9669:(e,t,r)=>{e.exports=r(1609)},5448:(e,t,r)=>{"use strict";var n=r(4867),a=r(6026),s=r(4372),o=r(5327),i=r(4097),l=r(4109),c=r(7985),u=r(5061),h=r(5655),d=r(5263);e.exports=function(e){return new Promise((function(t,r){var m,g=e.data,p=e.headers,f=e.responseType;function T(){e.cancelToken&&e.cancelToken.unsubscribe(m),e.signal&&e.signal.removeEventListener("abort",m)}n.isFormData(g)&&delete p["Content-Type"];var b=new XMLHttpRequest;if(e.auth){var _=e.auth.username||"",y=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";p.Authorization="Basic "+btoa(_+":"+y)}var A=i(e.baseURL,e.url);function w(){if(b){var n="getAllResponseHeaders"in b?l(b.getAllResponseHeaders()):null,s={data:f&&"text"!==f&&"json"!==f?b.response:b.responseText,status:b.status,statusText:b.statusText,headers:n,config:e,request:b};a((function(e){t(e),T()}),(function(e){r(e),T()}),s),b=null}}if(b.open(e.method.toUpperCase(),o(A,e.params,e.paramsSerializer),!0),b.timeout=e.timeout,"onloadend"in b?b.onloadend=w:b.onreadystatechange=function(){b&&4===b.readyState&&(0!==b.status||b.responseURL&&0===b.responseURL.indexOf("file:"))&&setTimeout(w)},b.onabort=function(){b&&(r(u("Request aborted",e,"ECONNABORTED",b)),b=null)},b.onerror=function(){r(u("Network Error",e,null,b)),b=null},b.ontimeout=function(){var t="timeout of "+e.timeout+"ms exceeded",n=e.transitional||h.transitional;e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),r(u(t,e,n.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",b)),b=null},n.isStandardBrowserEnv()){var k=(e.withCredentials||c(A))&&e.xsrfCookieName?s.read(e.xsrfCookieName):void 0;k&&(p[e.xsrfHeaderName]=k)}"setRequestHeader"in b&&n.forEach(p,(function(e,t){void 0===g&&"content-type"===t.toLowerCase()?delete p[t]:b.setRequestHeader(t,e)})),n.isUndefined(e.withCredentials)||(b.withCredentials=!!e.withCredentials),f&&"json"!==f&&(b.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&b.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&b.upload&&b.upload.addEventListener("progress",e.onUploadProgress),(e.cancelToken||e.signal)&&(m=function(e){b&&(r(!e||e&&e.type?new d("canceled"):e),b.abort(),b=null)},e.cancelToken&&e.cancelToken.subscribe(m),e.signal&&(e.signal.aborted?m():e.signal.addEventListener("abort",m))),g||(g=null),b.send(g)}))}},1609:(e,t,r)=>{"use strict";var n=r(4867),a=r(1849),s=r(321),o=r(7185),i=function e(t){var r=new s(t),i=a(s.prototype.request,r);return n.extend(i,s.prototype,r),n.extend(i,r),i.create=function(r){return e(o(t,r))},i}(r(5655));i.Axios=s,i.Cancel=r(5263),i.CancelToken=r(4972),i.isCancel=r(6502),i.VERSION=r(7288).version,i.all=function(e){return Promise.all(e)},i.spread=r(8713),i.isAxiosError=r(6268),e.exports=i,e.exports.default=i},5263:e=>{"use strict";function t(e){this.message=e}t.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},t.prototype.__CANCEL__=!0,e.exports=t},4972:(e,t,r)=>{"use strict";var n=r(5263);function a(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var r=this;this.promise.then((function(e){if(r._listeners){var t,n=r._listeners.length;for(t=0;t<n;t++)r._listeners[t](e);r._listeners=null}})),this.promise.then=function(e){var t,n=new Promise((function(e){r.subscribe(e),t=e})).then(e);return n.cancel=function(){r.unsubscribe(t)},n},e((function(e){r.reason||(r.reason=new n(e),t(r.reason))}))}a.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},a.prototype.subscribe=function(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]},a.prototype.unsubscribe=function(e){if(this._listeners){var t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}},a.source=function(){var e;return{token:new a((function(t){e=t})),cancel:e}},e.exports=a},6502:e=>{"use strict";e.exports=function(e){return!(!e||!e.__CANCEL__)}},321:(e,t,r)=>{"use strict";var n=r(4867),a=r(5327),s=r(782),o=r(3572),i=r(7185),l=r(4875),c=l.validators;function u(e){this.defaults=e,this.interceptors={request:new s,response:new s}}u.prototype.request=function(e){"string"==typeof e?(e=arguments[1]||{}).url=arguments[0]:e=e||{},(e=i(this.defaults,e)).method?e.method=e.method.toLowerCase():this.defaults.method?e.method=this.defaults.method.toLowerCase():e.method="get";var t=e.transitional;void 0!==t&&l.assertOptions(t,{silentJSONParsing:c.transitional(c.boolean),forcedJSONParsing:c.transitional(c.boolean),clarifyTimeoutError:c.transitional(c.boolean)},!1);var r=[],n=!0;this.interceptors.request.forEach((function(t){"function"==typeof t.runWhen&&!1===t.runWhen(e)||(n=n&&t.synchronous,r.unshift(t.fulfilled,t.rejected))}));var a,s=[];if(this.interceptors.response.forEach((function(e){s.push(e.fulfilled,e.rejected)})),!n){var u=[o,void 0];for(Array.prototype.unshift.apply(u,r),u=u.concat(s),a=Promise.resolve(e);u.length;)a=a.then(u.shift(),u.shift());return a}for(var h=e;r.length;){var d=r.shift(),m=r.shift();try{h=d(h)}catch(e){m(e);break}}try{a=o(h)}catch(e){return Promise.reject(e)}for(;s.length;)a=a.then(s.shift(),s.shift());return a},u.prototype.getUri=function(e){return e=i(this.defaults,e),a(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},n.forEach(["delete","get","head","options"],(function(e){u.prototype[e]=function(t,r){return this.request(i(r||{},{method:e,url:t,data:(r||{}).data}))}})),n.forEach(["post","put","patch"],(function(e){u.prototype[e]=function(t,r,n){return this.request(i(n||{},{method:e,url:t,data:r}))}})),e.exports=u},782:(e,t,r)=>{"use strict";var n=r(4867);function a(){this.handlers=[]}a.prototype.use=function(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1},a.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},a.prototype.forEach=function(e){n.forEach(this.handlers,(function(t){null!==t&&e(t)}))},e.exports=a},4097:(e,t,r)=>{"use strict";var n=r(1793),a=r(7303);e.exports=function(e,t){return e&&!n(t)?a(e,t):t}},5061:(e,t,r)=>{"use strict";var n=r(481);e.exports=function(e,t,r,a,s){var o=new Error(e);return n(o,t,r,a,s)}},3572:(e,t,r)=>{"use strict";var n=r(4867),a=r(8527),s=r(6502),o=r(5655),i=r(5263);function l(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new i("canceled")}e.exports=function(e){return l(e),e.headers=e.headers||{},e.data=a.call(e,e.data,e.headers,e.transformRequest),e.headers=n.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),n.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||o.adapter)(e).then((function(t){return l(e),t.data=a.call(e,t.data,t.headers,e.transformResponse),t}),(function(t){return s(t)||(l(e),t&&t.response&&(t.response.data=a.call(e,t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))}},481:e=>{"use strict";e.exports=function(e,t,r,n,a){return e.config=t,r&&(e.code=r),e.request=n,e.response=a,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},e}},7185:(e,t,r)=>{"use strict";var n=r(4867);e.exports=function(e,t){t=t||{};var r={};function a(e,t){return n.isPlainObject(e)&&n.isPlainObject(t)?n.merge(e,t):n.isPlainObject(t)?n.merge({},t):n.isArray(t)?t.slice():t}function s(r){return n.isUndefined(t[r])?n.isUndefined(e[r])?void 0:a(void 0,e[r]):a(e[r],t[r])}function o(e){if(!n.isUndefined(t[e]))return a(void 0,t[e])}function i(r){return n.isUndefined(t[r])?n.isUndefined(e[r])?void 0:a(void 0,e[r]):a(void 0,t[r])}function l(r){return r in t?a(e[r],t[r]):r in e?a(void 0,e[r]):void 0}var c={url:o,method:o,data:o,baseURL:i,transformRequest:i,transformResponse:i,paramsSerializer:i,timeout:i,timeoutMessage:i,withCredentials:i,adapter:i,responseType:i,xsrfCookieName:i,xsrfHeaderName:i,onUploadProgress:i,onDownloadProgress:i,decompress:i,maxContentLength:i,maxBodyLength:i,transport:i,httpAgent:i,httpsAgent:i,cancelToken:i,socketPath:i,responseEncoding:i,validateStatus:l};return n.forEach(Object.keys(e).concat(Object.keys(t)),(function(e){var t=c[e]||s,a=t(e);n.isUndefined(a)&&t!==l||(r[e]=a)})),r}},6026:(e,t,r)=>{"use strict";var n=r(5061);e.exports=function(e,t,r){var a=r.config.validateStatus;r.status&&a&&!a(r.status)?t(n("Request failed with status code "+r.status,r.config,null,r.request,r)):e(r)}},8527:(e,t,r)=>{"use strict";var n=r(4867),a=r(5655);e.exports=function(e,t,r){var s=this||a;return n.forEach(r,(function(r){e=r.call(s,e,t)})),e}},5655:(e,t,r)=>{"use strict";var n=r(4867),a=r(6016),s=r(481),o={"Content-Type":"application/x-www-form-urlencoded"};function i(e,t){!n.isUndefined(e)&&n.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var l,c={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:(("undefined"!=typeof XMLHttpRequest||"undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process))&&(l=r(5448)),l),transformRequest:[function(e,t){return a(t,"Accept"),a(t,"Content-Type"),n.isFormData(e)||n.isArrayBuffer(e)||n.isBuffer(e)||n.isStream(e)||n.isFile(e)||n.isBlob(e)?e:n.isArrayBufferView(e)?e.buffer:n.isURLSearchParams(e)?(i(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):n.isObject(e)||t&&"application/json"===t["Content-Type"]?(i(t,"application/json"),function(e,t,r){if(n.isString(e))try{return(0,JSON.parse)(e),n.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(0,JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){var t=this.transitional||c.transitional,r=t&&t.silentJSONParsing,a=t&&t.forcedJSONParsing,o=!r&&"json"===this.responseType;if(o||a&&n.isString(e)&&e.length)try{return JSON.parse(e)}catch(e){if(o){if("SyntaxError"===e.name)throw s(e,this,"E_JSON_PARSE");throw e}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};n.forEach(["delete","get","head"],(function(e){c.headers[e]={}})),n.forEach(["post","put","patch"],(function(e){c.headers[e]=n.merge(o)})),e.exports=c},7288:e=>{e.exports={version:"0.22.0"}},1849:e=>{"use strict";e.exports=function(e,t){return function(){for(var r=new Array(arguments.length),n=0;n<r.length;n++)r[n]=arguments[n];return e.apply(t,r)}}},5327:(e,t,r)=>{"use strict";var n=r(4867);function a(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}e.exports=function(e,t,r){if(!t)return e;var s;if(r)s=r(t);else if(n.isURLSearchParams(t))s=t.toString();else{var o=[];n.forEach(t,(function(e,t){null!=e&&(n.isArray(e)?t+="[]":e=[e],n.forEach(e,(function(e){n.isDate(e)?e=e.toISOString():n.isObject(e)&&(e=JSON.stringify(e)),o.push(a(t)+"="+a(e))})))})),s=o.join("&")}if(s){var i=e.indexOf("#");-1!==i&&(e=e.slice(0,i)),e+=(-1===e.indexOf("?")?"?":"&")+s}return e}},7303:e=>{"use strict";e.exports=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},4372:(e,t,r)=>{"use strict";var n=r(4867);e.exports=n.isStandardBrowserEnv()?{write:function(e,t,r,a,s,o){var i=[];i.push(e+"="+encodeURIComponent(t)),n.isNumber(r)&&i.push("expires="+new Date(r).toGMTString()),n.isString(a)&&i.push("path="+a),n.isString(s)&&i.push("domain="+s),!0===o&&i.push("secure"),document.cookie=i.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},1793:e=>{"use strict";e.exports=function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}},6268:e=>{"use strict";e.exports=function(e){return"object"==typeof e&&!0===e.isAxiosError}},7985:(e,t,r)=>{"use strict";var n=r(4867);e.exports=n.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a");function a(e){var n=e;return t&&(r.setAttribute("href",n),n=r.href),r.setAttribute("href",n),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:"/"===r.pathname.charAt(0)?r.pathname:"/"+r.pathname}}return e=a(window.location.href),function(t){var r=n.isString(t)?a(t):t;return r.protocol===e.protocol&&r.host===e.host}}():function(){return!0}},6016:(e,t,r)=>{"use strict";var n=r(4867);e.exports=function(e,t){n.forEach(e,(function(r,n){n!==t&&n.toUpperCase()===t.toUpperCase()&&(e[t]=r,delete e[n])}))}},4109:(e,t,r)=>{"use strict";var n=r(4867),a=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];e.exports=function(e){var t,r,s,o={};return e?(n.forEach(e.split("\n"),(function(e){if(s=e.indexOf(":"),t=n.trim(e.substr(0,s)).toLowerCase(),r=n.trim(e.substr(s+1)),t){if(o[t]&&a.indexOf(t)>=0)return;o[t]="set-cookie"===t?(o[t]?o[t]:[]).concat([r]):o[t]?o[t]+", "+r:r}})),o):o}},8713:e=>{"use strict";e.exports=function(e){return function(t){return e.apply(null,t)}}},4875:(e,t,r)=>{"use strict";var n=r(7288).version,a={};["object","boolean","number","function","string","symbol"].forEach((function(e,t){a[e]=function(r){return typeof r===e||"a"+(t<1?"n ":" ")+e}}));var s={};a.transitional=function(e,t,r){function a(e,t){return"[Axios v"+n+"] Transitional option '"+e+"'"+t+(r?". "+r:"")}return function(r,n,o){if(!1===e)throw new Error(a(n," has been removed"+(t?" in "+t:"")));return t&&!s[n]&&(s[n]=!0,console.warn(a(n," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(r,n,o)}},e.exports={assertOptions:function(e,t,r){if("object"!=typeof e)throw new TypeError("options must be an object");for(var n=Object.keys(e),a=n.length;a-- >0;){var s=n[a],o=t[s];if(o){var i=e[s],l=void 0===i||o(i,s,e);if(!0!==l)throw new TypeError("option "+s+" must be "+l)}else if(!0!==r)throw Error("Unknown option "+s)}},validators:a}},4867:(e,t,r)=>{"use strict";var n=r(1849),a=Object.prototype.toString;function s(e){return"[object Array]"===a.call(e)}function o(e){return void 0===e}function i(e){return null!==e&&"object"==typeof e}function l(e){if("[object Object]"!==a.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function c(e){return"[object Function]"===a.call(e)}function u(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),s(e))for(var r=0,n=e.length;r<n;r++)t.call(null,e[r],r,e);else for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.call(null,e[a],a,e)}e.exports={isArray:s,isArrayBuffer:function(e){return"[object ArrayBuffer]"===a.call(e)},isBuffer:function(e){return null!==e&&!o(e)&&null!==e.constructor&&!o(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:i,isPlainObject:l,isUndefined:o,isDate:function(e){return"[object Date]"===a.call(e)},isFile:function(e){return"[object File]"===a.call(e)},isBlob:function(e){return"[object Blob]"===a.call(e)},isFunction:c,isStream:function(e){return i(e)&&c(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:u,merge:function e(){var t={};function r(r,n){l(t[n])&&l(r)?t[n]=e(t[n],r):l(r)?t[n]=e({},r):s(r)?t[n]=r.slice():t[n]=r}for(var n=0,a=arguments.length;n<a;n++)u(arguments[n],r);return t},extend:function(e,t,r){return u(t,(function(t,a){e[a]=r&&"function"==typeof t?n(t,r):t})),e},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},stripBOM:function(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e}}}},t={};function r(n){var a=t[n];if(void 0!==a)return a.exports;var s=t[n]={exports:{}};return e[n](s,s.exports,r),s.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";var e=r(9669);const t=new Proxy(r.n(e)(),{apply:async function(e,t,r){try{return await e(...r)}catch(e){throw{errorType:"NET_ERR",errorCode:0,errorMsg:e.message}}},get:function(e,t){let r=e[t];return"[object Function]"!==Object.prototype.toString.call(r)?r:async(...e)=>{try{return await Promise.resolve(r(...e))}catch(e){throw{errorType:"NET_ERR",errorCode:0,errorMsg:e.message}}}}}),n=[["ach","ach"],["af","afr"],["aka","aka"],["sq","alb"],["am","amh"],["ar","ara"],["arg","arg"],["hy","arm"],["asm","asm"],["ast","ast"],["auto","auto"],["aym","aym"],["az","aze"],["bal","bal"],["sun","sun"],["bak","bak"],["eu","baq"],["be","bel"],["bem","bem"],["bn","ben"],["ber","ber"],["bho","bho"],["bis","bis"],["bli","bli"],["nob","nob"],["bs","bos"],["bre","bre"],["bg","bul"],["bur","bur"],["yue","yue"],["ca","cat"],["ceb","ceb"],["chr","chr"],["ny","nya"],["chv","chv"],["wyw","wyw"],["cor","cor"],["co","cos"],["cre","cre"],["cri","cri"],["hr","hrv"],["cs","cs"],["da","dan"],["div","div"],["nl","nl"],["en","en"],["eo","epo"],["et","est"],["fao","fao"],["fil","fil"],["fi","fin"],["fr","fra"],["fri","fri"],["ful","ful"],["gla","gla"],["gl","glg"],["ka","geo"],["de","de"],["el","el"],["grn","grn"],["gu","guj"],["ht","ht"],["hak","hak"],["ha","hau"],["haw","haw"],["he","heb"],["hil","hil"],["hi","hi"],["hmn","hmn"],["hu","hu"],["hup","hup"],["is","ice"],["ido","ido"],["ig","ibo"],["id","id"],["ing","ing"],["ina","ina"],["iku","iku"],["ga","gle"],["it","it"],["ja","jp"],["jw","jav"],["kab","kab"],["kal","kal"],["kn","kan"],["kau","kau"],["kas","kas"],["kah","kah"],["kk","kaz"],["km","hkm"],["kin","kin"],["tlh","kli"],["kon","kon"],["kok","kok"],["ko","kor"],["ku","kur"],["ky","kir"],["lo","lao"],["lag","lag"],["la","lat"],["lv","lav"],["lim","lim"],["lin","lin"],["lt","lit"],["loj","loj"],["lug","lug"],["lb","ltz"],["mk","mac"],["mai","mai"],["mg","mg"],["ms","may"],["ml","mal"],["mt","mlt"],["glv","glv"],["mi","mao"],["mr","mar"],["mah","mah"],["mau","mau"],["frm","frm"],["mot","mot"],["nea","nea"],["ne","nep"],["sme","sme"],["ped","ped"],["no","nor"],["nno","nno"],["oci","oci"],["oji","oji"],["eno","eno"],["or","ori"],["orm","orm"],["oss","oss"],["pam","pam"],["pap","pap"],["ps","pus"],["fa","per"],["pl","pl"],["pt","pt"],["pa","pan"],["que","que"],["ro","rom"],["roh","roh"],["ro","ro"],["ru","ru"],["ruy","ruy"],["sm","sm"],["san","san"],["srd","srd"],["sco","sco"],["src","src"],["sr","srp"],["sec","sec"],["sha","sha"],["sn","sna"],["sil","sil"],["sd","snd"],["si","sin"],["sk","sk"],["sl","slo"],["so","som"],["sol","sol"],["nbl","nbl"],["sot","sot"],["es","spa"],["sw","swa"],["sv","swe"],["syr","syr"],["tgl","tgl"],["tg","tgk"],["ta","tam"],["tat","tat"],["te","tel"],["tet","tet"],["th","th"],["tir","tir"],["zh-TW","cht"],["zh-CN","zh"],["tso","tso"],["tr","tr"],["tuk","tuk"],["twi","twi"],["uk","ukr"],["ups","ups"],["ur","urd"],["uz","uzb"],["ven","ven"],["vi","vie"],["wln","wln"],["cy","wel"],["fry","fry"],["wol","wol"],["xh","xho"],["yi","yid"],["yo","yor"],["zaz","zaz"],["zu","zul"]],a=class{constructor(){this.MAX_RETRY=3,this.HOST="https://fanyi.baidu.com/",this.token="",this.gtk="",this.sign="",this.languages={},this.HEADERS={accept:"*/*","accept-language":"en,zh;q=0.9,en-GB;q=0.8,en-CA;q=0.7,en-AU;q=0.6,en-ZA;q=0.5,en-NZ;q=0.4,en-IN;q=0.3,zh-CN;q=0.2","content-type":"application/x-www-form-urlencoded; charset=UTF-8"},this.LAN_TO_CODE=new Map(n),this.CODE_TO_LAN=new Map(n.map((([e,t])=>[t,e]))),this.AUDIO=new Audio}throwError(e,t,r,n,a=null,s=null){throw{errorType:"API_ERR",errorCode:e,errorMsg:t,errorAct:{api:"baidu",action:r,text:n,from:a,to:s}}}async getTokenGtk(){let e=async()=>{const e=await t({method:"get",baseURL:this.HOST,timeout:5e3});this.token=e.data.match(/token: '(.*?)',/)[1],this.gtk=e.data.match(/window.gtk = '(.*?)'/)[1]};await e(),await e()}parseResult(e){let t={},r=[],n=[];for(let t of e.trans_result.data)r.push(t.src),n.push(t.dst);if(t.originalText=r.join("\n"),t.mainMeaning=n.join("\n"),e.trans_result.phonetic&&(t.tPronunciation=e.trans_result.phonetic.map((e=>" "!==e.trg_str?e.trg_str:e.src_str)).reduce(((e,t)=>`${e} ${t}`))),e.trans_result.jp_pinyin&&(t.tPronunciation=e.trans_result.jp_pinyin[0].dst),e.dict_result){if(e.dict_result.simple_means){t.sPronunciation=e.dict_result.simple_means.symbols[0].ph_en,t.detailedMeanings=[];let r=e=>{let r={};r.pos=e.part,r.meaning=e.means.reduce(((e,t)=>`${e}, ${t}`)),t.detailedMeanings.push(r)};for(let t of e.dict_result.simple_means.symbols[0].parts)if(t.part)r(t);else for(let e of t.means)e.means&&r(e)}if(e.dict_result.edict){t.definitions=[];for(let r of e.dict_result.edict.item)for(let e of r.tr_group){let n={};n.pos=r.pos,n.meaning=e.tr[0],n.example=e.example[0],n.synonyms=e.similar_word,t.definitions.push(n)}}if(e.dict_result.content){t.sPronunciation=e.dict_result.voice[0].en_phonic,t.detailedMeanings||(t.detailedMeanings=[]);for(let r of e.dict_result.content[0].mean){let e={};e.pos=r.pre,e.meaning=Object.keys(r.cont)[0],t.detailedMeanings.push(e)}}}if(e.liju_result.double){t.examples=[];let r=e.liju_result.double;r=JSON.parse(r);for(let e of r){let r={};r.source=e[0].map((e=>e.length>4?e[0]+e[4]:e[0])).reduce(((e,t)=>e+t)),r.target=e[1].map((e=>e.length>4?e[0]+e[4]:e[0])).reduce(((e,t)=>e+t)),t.examples.push(r)}}return t}supportedLanguages(){return new Set(this.LAN_TO_CODE.keys())}async detect(e){const r=await t({url:"langdetect",method:"post",baseURL:this.HOST,headers:this.HEADERS,data:new URLSearchParams({query:e}),timeout:5e3});if("success"===r.data.msg)return this.CODE_TO_LAN.get(r.data.lan);this.throwError(r.data.errno,r.data.msg,"detect",e)}async translate(e,r,n){let a=0,s=async()=>{let o=r;"auto"===o&&(o=await this.detect(e));let i=this.LAN_TO_CODE.get(n),l=this.LAN_TO_CODE.get(o),c=(await t({url:`/v2transapi?from=${l}&to=${i}`,method:"post",baseURL:this.HOST,headers:this.HEADERS,data:new URLSearchParams({from:l,to:i,query:e,transtype:"realtime",simple_means_flag:3,sign:this.generateSign(e,this.gtk),token:this.token,domain:"common"}),timeout:5e3})).data;return c.errno?a<this.MAX_RETRY?(a++,await this.getTokenGtk(),s()):void this.throwError(c.errno,c.msg,"translate",e,r,n):this.parseResult(c)};return this.token&&this.gtk||await this.getTokenGtk(),s()}async pronounce(e,t,r){this.stopPronounce();let n="fast"===r?"7":"3";this.AUDIO.src=`${this.HOST}gettts?lan=${this.LAN_TO_CODE.get(t)}&text=${encodeURIComponent(e)}&spd=${n}&source=web`;try{await this.AUDIO.play()}catch(r){throw{errorType:"NET_ERR",errorCode:0,errorMsg:r.message,errorAct:{api:"baidu",action:"pronounce",text:e,from:t,to:null}}}}stopPronounce(){this.AUDIO.paused||this.AUDIO.pause()}tokenA(e,t){for(var r=0;r<t.length-2;r+=3){var n=t.charAt(r+2);n=n>="a"?n.charCodeAt(0)-87:Number(n),n="+"===t.charAt(r+1)?e>>>n:e<<n,e="+"===t.charAt(r)?e+n&4294967295:e^n}return e}generateSign(e,t){var r=null,n=e.length;n>30&&(e=""+e.substr(0,10)+e.substr(Math.floor(n/2)-5,10)+e.substring(e.length,e.length-10));for(var a=(null!==r?r:(r=t||"")||"").split("."),s=Number(a[0])||0,o=Number(a[1])||0,i=[],l=0,c=0;c<e.length;c++){var u=e.charCodeAt(c);128>u?i[l++]=u:(2048>u?i[l++]=u>>6|192:(55296==(64512&u)&&c+1<e.length&&56320==(64512&e.charCodeAt(c+1))?(u=65536+((1023&u)<<10)+(1023&e.charCodeAt(++c)),i[l++]=u>>18|240,i[l++]=u>>12&63|128):i[l++]=u>>12|224,i[l++]=u>>6&63|128),i[l++]=63&u|128)}for(var h=s,d=0;d<i.length;d++)h+=i[d],h=this.tokenA(h,"+-a^+6");return h=this.tokenA(h,"+-3^+b+-f"),0>(h^=o)&&(h=2147483648+(2147483647&h)),(h%=1e6).toString()+"."+(h^s)}},s=[["auto","auto-detect"],["ar","ar"],["ga","ga"],["et","et"],["or","or"],["bg","bg"],["is","is"],["pl","pl"],["bs","bs-Latn"],["fa","fa"],["prs","prs"],["da","da"],["de","de"],["ru","ru"],["fr","fr"],["zh-TW","zh-Hant"],["fil","fil"],["fj","fj"],["fi","fi"],["gu","gu"],["kk","kk"],["ht","ht"],["ko","ko"],["nl","nl"],["ca","ca"],["zh-CN","zh-Hans"],["cs","cs"],["kn","kn"],["otq","otq"],["tlh","tlh"],["hr","hr"],["lv","lv"],["lt","lt"],["ro","ro"],["mg","mg"],["mt","mt"],["mr","mr"],["ml","ml"],["ms","ms"],["mi","mi"],["bn","bn-BD"],["hmn","mww"],["af","af"],["pa","pa"],["pt","pt"],["ps","ps"],["ja","ja"],["sv","sv"],["sm","sm"],["sr-Latn","sr-Latn"],["sr-Cyrl","sr-Cyrl"],["no","nb"],["sk","sk"],["sl","sl"],["sw","sw"],["ty","ty"],["te","te"],["ta","ta"],["th","th"],["to","to"],["tr","tr"],["cy","cy"],["ur","ur"],["uk","uk"],["es","es"],["he","iw"],["el","el"],["hu","hu"],["it","it"],["hi","hi"],["id","id"],["en","en"],["yua","yua"],["yue","yua"],["vi","vi"],["ku","ku"],["kmr","kmr"]],o={ar:["ar-SA","Male","ar-SA-Naayf"],bg:["bg-BG","Male","bg-BG-Ivan"],ca:["ca-ES","Female","ca-ES-HerenaRUS"],cs:["cs-CZ","Male","cs-CZ-Jakub"],da:["da-DK","Female","da-DK-HelleRUS"],de:["de-DE","Female","de-DE-Hedda"],el:["el-GR","Male","el-GR-Stefanos"],en:["en-US","Female","en-US-JessaRUS"],es:["es-ES","Female","es-ES-Laura-Apollo"],fi:["fi-FI","Female","fi-FI-HeidiRUS"],fr:["fr-FR","Female","fr-FR-Julie-Apollo"],he:["he-IL","Male","he-IL-Asaf"],hi:["hi-IN","Female","hi-IN-Kalpana-Apollo"],hr:["hr-HR","Male","hr-HR-Matej"],hu:["hu-HU","Male","hu-HU-Szabolcs"],id:["id-ID","Male","id-ID-Andika"],it:["it-IT","Male","it-IT-Cosimo-Apollo"],ja:["ja-JP","Female","ja-JP-Ayumi-Apollo"],ko:["ko-KR","Female","ko-KR-HeamiRUS"],ms:["ms-MY","Male","ms-MY-Rizwan"],nl:["nl-NL","Female","nl-NL-HannaRUS"],nb:["nb-NO","Female","nb-NO-HuldaRUS"],no:["nb-NO","Female","nb-NO-HuldaRUS"],pl:["pl-PL","Female","pl-PL-PaulinaRUS"],pt:["pt-PT","Female","pt-PT-HeliaRUS"],ro:["ro-RO","Male","ro-RO-Andrei"],ru:["ru-RU","Female","ru-RU-Irina-Apollo"],sk:["sk-SK","Male","sk-SK-Filip"],sl:["sl-SL","Male","sl-SI-Lado"],sv:["sv-SE","Female","sv-SE-HedvigRUS"],ta:["ta-IN","Female","ta-IN-Valluvar"],te:["te-IN","Male","te-IN-Chitra"],th:["th-TH","Male","th-TH-Pattara"],tr:["tr-TR","Female","tr-TR-SedaRUS"],vi:["vi-VN","Male","vi-VN-An"],"zh-Hans":["zh-CN","Female","zh-CN-HuihuiRUS"],"zh-Hant":["zh-CN","Female","zh-CN-HuihuiRUS"],yue:["zh-HK","Female","zh-HK-TracyRUS"]},i={ar:"ar-EG",ca:"ca-ES",da:"da-DK",de:"de-DE",en:"en-US",es:"es-ES",fi:"fi-FI",fr:"fr-FR",hi:"hi-IN",it:"it-IT",ja:"ja-JP",ko:"ko-KR",nb:"nb-NO",nl:"nl-NL",pl:"pl-PL",pt:"pt-PT",ru:"ru-RU",sv:"sv-SE",th:"th-TH","zh-Hans":"zh-CN","zh-Hant":"zh-HK",yue:"zh-HK",gu:"gu-IN",mr:"mr-IN",ta:"ta-IN",te:"te-IN",tr:"tr-TR"},l=class{constructor(){this.IG="",this.IID="",this.token="",this.key="",this.tokensInitiated=!1,this.TTS_AUTH={region:"",token:""},this.count=0,this.HTMLParser=new DOMParser,this.MAX_RETRY=1,this.HOST="https://cn.bing.com/",this.HOME_PAGE="https://cn.bing.com/translator",this.HEADERS={accept:"*/*","accept-language":"zh-CN,zh-TW;q=0.9,zh;q=0.8,en;q=0.7","content-type":"application/x-www-form-urlencoded"},this.LAN_TO_CODE=new Map(s),this.CODE_TO_LAN=new Map(s.map((([e,t])=>[t,e]))),this.AUDIO=new Audio}async updateTokens(){const e=await t.get(this.HOME_PAGE);let r=/(https:\/\/.*\.bing\.com\/).*/g.exec(e.request.responseURL);r&&r[1]!=this.HOST&&(this.HOST=r[1],this.HOME_PAGE=`${this.HOST}translator`),this.IG=e.data.match(/IG:"([A-Za-z0-9]+)"/)[1],[,this.key,this.token]=e.data.match(/var params_RichTranslateHelper\s*=\s*\[([0-9]+),\s*"([^"]+)",[^\]]*\];/);let n=this.HTMLParser.parseFromString(e.data,"text/html");this.IID=n.getElementById("rich_tta").getAttribute("data-iid"),this.count=0}parseTranslateResult(e,t){let r=t||new Object;try{let t=e[0].translations;r.mainMeaning=t[0].text,r.tPronunciation=t[0].transliteration.text}catch(e){}return r}parseLookupResult(e,t){let r=t||new Object;try{r.originalText=e[0].displaySource;let t=e[0].translations;r.mainMeaning=t[0].displayTarget,r.tPronunciation=t[0].transliteration;let n=[];for(let e in t){let r=[];for(let n in t[e].backTranslations)r.push(t[e].backTranslations[n].displayText);n.push({pos:t[e].posTag,meaning:t[e].displayTarget,synonyms:r})}r.detailedMeanings=n}catch(e){}return r}parseExampleResult(e,t){let r=t||new Object;try{r.examples=e[0].examples.map((e=>({source:`${e.sourcePrefix}<b>${e.sourceTerm}</b>${e.sourceSuffix}`,target:`${e.targetPrefix}<b>${e.targetTerm}</b>${e.targetSuffix}`})))}catch(e){}return r}async updateTTSAuth(){const e=await this.request((()=>({method:"POST",baseURL:this.HOST,url:`tfetspktok?isVertical=1&&IG=${this.IG}&IID=${this.IID}.${this.count.toString()}`,headers:this.HEADERS,data:`&token=${encodeURIComponent(this.token)}&key=${encodeURIComponent(this.key)}`})),[]);this.TTS_AUTH.region=e.region,this.TTS_AUTH.token=e.token}generateTTSData(e,t,r){let n=this.LAN_TO_CODE.get(t),a=o[n],s=i[n],l="fast"===r?"-10.00%":"-30.00%";return`<speak version='1.0' xml:lang='${s}'><voice xml:lang='${s}' xml:gender='${a[1]}' name='${a[2]}'><prosody rate='${l}'>${e}</prosody></voice></speak>`}arrayBufferToBase64(e){let t="",r=new Uint8Array(e);for(let e=0;e<r.byteLength;e++)t+=String.fromCharCode(r[e]);return btoa(t)}constructDetectParams(e){let t=`ttranslatev3?isVertical=1&IG=${this.IG}&IID=${this.IID}.${this.count.toString()}`,r=`&fromLang=auto-detect&to=zh-Hans&text=${encodeURIComponent(e)}&token=${encodeURIComponent(this.token)}&key=${encodeURIComponent(this.key)}`;return{method:"POST",baseURL:this.HOST,url:t,headers:this.HEADERS,data:r}}constructTranslateParams(e,t,r){let n=`ttranslatev3?isVertical=1&IG=${this.IG}&IID=${this.IID}.${this.count.toString()}`,a=`&fromLang=${this.LAN_TO_CODE.get(t)}&to=${this.LAN_TO_CODE.get(r)}&text=${encodeURIComponent(e)}&token=${encodeURIComponent(this.token)}&key=${encodeURIComponent(this.key)}`;return{method:"POST",baseURL:this.HOST,url:n,headers:this.HEADERS,data:a}}constructLookupParams(e,t,r){let n=`tlookupv3?isVertical=1&IG=${this.IG}&IID=${this.IID}.${this.count.toString()}`,a=`&from=${t}&to=${this.LAN_TO_CODE.get(r)}&text=${encodeURIComponent(e)}&token=${encodeURIComponent(this.token)}&key=${encodeURIComponent(this.key)}`;return{method:"POST",baseURL:this.HOST,url:n,headers:this.HEADERS,data:a}}constructExampleParams(e,t,r,n){let a=`texamplev3?isVertical=1&IG=${this.IG}&IID=${this.IID}.${this.count.toString()}`,s=`&from=${e}&to=${this.LAN_TO_CODE.get(t)}&text=${encodeURIComponent(r)}&translation=${encodeURIComponent(n)}&token=${encodeURIComponent(this.token)}&key=${encodeURIComponent(this.key)}`;return{method:"POST",baseURL:this.HOST,url:a,headers:this.HEADERS,data:s}}constructTTSParams(e,t,r){return{method:"POST",baseURL:`https://${this.TTS_AUTH.region}.tts.speech.microsoft.com/cognitiveservices/v1?`,headers:{"Content-Type":"application/ssml+xml",Authorization:`Bearer ${this.TTS_AUTH.token}`,"X-MICROSOFT-OutputFormat":"audio-16khz-32kbitrate-mono-mp3","cache-control":"no-cache"},data:this.generateTTSData(e,t,r),responseType:"arraybuffer"}}async request(e,r,n=!0){let a=0,s=async()=>{this.count++;const o=await t(e.call(this,...r));if(401===o.status||429===o.status)throw{errorType:"API_ERR",errorCode:o.status,errorMsg:"Request too frequently!"};const i=/(https:\/\/.*\.bing\.com\/).*/g.exec(o.request.responseURL);if(i&&i[1]!==this.HOST)return this.HOST=i[1],this.HOME_PAGE=`${this.HOST}translator`,await this.updateTokens().then(s);const l=o.data.StatusCode||o.data.statusCode||200;switch(l){case 200:return o.data;case 205:return await this.updateTokens().then(s)}if(n&&a<this.MAX_RETRY)return a++,await this.updateTokens().then(s);throw{errorType:"API_ERR",errorCode:l,errorMsg:"Request failed."}};return this.tokensInitiated||(await this.updateTokens(),this.tokensInitiated=!0),s()}supportedLanguages(){return new Set(this.LAN_TO_CODE.keys())}async detect(e){try{let t=(await this.request(this.constructDetectParams,[e]))[0].detectedLanguage.language;return this.CODE_TO_LAN.get(t)}catch(t){throw t.errorMsg=t.errorMsg||t.message,t.errorAct={api:"bing",action:"detect",text:e,from:null,to:null},t}}async translate(e,t,r){let n;try{n=await this.request(this.constructTranslateParams,[e,t,r])}catch(n){throw n.errorAct={api:"bing",action:"translate",text:e,from:t,to:r},n}let a=this.parseTranslateResult(n,{originalText:e});try{const t=await this.request(this.constructLookupParams,[e,n[0].detectedLanguage.language,r],!1);let s=this.parseLookupResult(t,a);const o=await this.request(this.constructExampleParams,[n[0].detectedLanguage.language,r,e,s.mainMeaning],!1);return this.parseExampleResult(o,s)}catch(e){return a}}async pronounce(e,t,r){this.stopPronounce();let n=0,a=async()=>{try{const n=await this.request(this.constructTTSParams,[e,t,r],!1);this.AUDIO.src=`data:audio/mp3;base64,${this.arrayBufferToBase64(n)}`,await this.AUDIO.play()}catch(r){if(n<this.MAX_RETRY)return n++,this.updateTTSAuth().then(a);let s={api:"bing",action:"pronounce",text:e,from:t,to:null};if(r.errorType)throw r.errorAct=s,r;throw{errorType:"NET_ERR",errorCode:0,errorMsg:r.message,errorAct:s}}};return this.TTS_AUTH.region.length>0&&this.TTS_AUTH.token.length>0||await this.updateTTSAuth(),a()}stopPronounce(){this.AUDIO.paused||this.AUDIO.pause()}},c=[["auto","auto"],["bg","bg"],["et","et"],["pl","pl"],["da","da"],["de","de"],["ru","ru"],["fr","fr"],["fi","fi"],["nl","nl"],["zh-CN","zh"],["cs","cs"],["lv","lv"],["lt","lt"],["ro","ro"],["pt","pt"],["ja","ja"],["sv","sv"],["sk","sk"],["sl","sl"],["es","es"],["el","el"],["hu","hu"],["it","it"],["en","en"]],u=[["auto","auto"],["zh-CN","zh-CN"],["zh-TW","zh-TW"],["en","en"],["af","af"],["am","am"],["ar","ar"],["az","az"],["be","be"],["bg","bg"],["bn","bn"],["bs","bs"],["ca","ca"],["ceb","ceb"],["co","co"],["cs","cs"],["cy","cy"],["da","da"],["de","de"],["el","el"],["eo","eo"],["es","es"],["et","et"],["eu","eu"],["fa","fa"],["fi","fi"],["fr","fr"],["fy","fy"],["ga","ga"],["gd","gd"],["gl","gl"],["gu","gu"],["ha","ha"],["haw","haw"],["he","he"],["hi","hi"],["hmn","hmn"],["hr","hr"],["ht","ht"],["hu","hu"],["hy","hy"],["id","id"],["ig","ig"],["is","is"],["it","it"],["ja","ja"],["jw","jw"],["ka","ka"],["kk","kk"],["km","km"],["kn","kn"],["ko","ko"],["ku","ku"],["ky","ky"],["la","la"],["lb","lb"],["lo","lo"],["lt","lt"],["lv","lv"],["mg","mg"],["mi","mi"],["mk","mk"],["ml","ml"],["mn","mn"],["mr","mr"],["ms","ms"],["mt","mt"],["my","my"],["ne","ne"],["nl","nl"],["no","no"],["ny","ny"],["pl","pl"],["ps","ps"],["pt","pt"],["ro","ro"],["ru","ru"],["sd","sd"],["si","si"],["sk","sk"],["sl","sl"],["sm","sm"],["sn","sn"],["so","so"],["sq","sq"],["sr","sr"],["st","st"],["su","su"],["sv","sv"],["sw","sw"],["ta","ta"],["te","te"],["tg","tg"],["th","th"],["fil","tl"],["tr","tr"],["ug","ug"],["uk","uk"],["ur","ur"],["uz","uz"],["vi","vi"],["xh","xh"],["yi","yi"],["yo","yo"],["zu","zu"]],h=class{constructor(){this.TKK=[434217,1534559001],this.HOME_PAGE="https://translate.google.cn/",this.HOST="https://translate.googleapis.com/",this.TRANSLATE_URL=`${this.HOST}translate_a/single?client=gtx&dj=1&dt=t&dt=at&dt=bd&dt=ex&dt=md&dt=rw&dt=ss&dt=rm`,this.TTS_URL=`${this.HOST}translate_tts?client=gtx`,this.FALLBACK_TRANSLATE_URL=`${this.HOST}translate_a/single?ie=UTF-8&client=webapp&otf=1&ssel=0&tsel=0&kc=5&dt=t&dt=at&dt=bd&dt=ex&dt=md&dt=rw&dt=ss&dt=rm`,this.FALLBACK_TTS_URL=`${this.HOST}translate_tts?ie=UTF-8&client=webapp`,this.fallBacking=!1,this.LAN_TO_CODE=new Map(u),this.CODE_TO_LAN=new Map(u.map((([e,t])=>[t,e]))),this.AUDIO=new Audio}generateTK(e,t,r){t=Number(t)||0;let n=[],a=0,s=0;for(;s<e.length;s++){let t=e.charCodeAt(s);128>t?n[a++]=t:(2048>t?n[a++]=t>>6|192:(55296==(64512&t)&&s+1<e.length&&56320==(64512&e.charCodeAt(s+1))?(t=65536+((1023&t)<<10)+(1023&e.charCodeAt(++s)),n[a++]=t>>18|240,n[a++]=t>>12&63|128):n[a++]=t>>12|224,n[a++]=t>>6&63|128),n[a++]=63&t|128)}for(e=t,a=0;a<n.length;a++)e+=n[a],e=this._magic(e,"+-a^+6");return e=this._magic(e,"+-3^+b+-f"),0>(e^=Number(r)||0)&&(e=2147483648+(2147483647&e)),(e%=1e6).toString()+"."+(e^t)}_magic(e,t){for(var r=0;r<t.length-2;r+=3){var n="a"<=(n=t.charAt(r+2))?n.charCodeAt(0)-87:Number(n);n="+"==t.charAt(r+1)?e>>>n:e<<n,e="+"==t.charAt(r)?e+n&4294967295:e^n}return e}async updateTKK(){let e=(await t.get(this.HOME_PAGE)).data,r=(e.match(/TKK=(.*?)\(\)\)'\);/i)||[""])[0].replace(/\\x([0-9A-Fa-f]{2})/g,"").match(/[+-]?\d+/g);r?(this.TKK[0]=Number(r[2]),this.TKK[1]=Number(r[0])+Number(r[1])):(r=e.match(/TKK[=:]['"](\d+?)\.(\d+?)['"]/i),r&&(this.TKK[0]=Number(r[1]),this.TKK[1]=Number(r[2])))}fallBack(){this.fallBacking=!0,setTimeout((()=>{this.fallBacking=!1}),18e5)}generateDetectURL(e){let t="&sl=auto&tl=zh-cn";return t+=`&tk=${this.generateTK(e,this.TKK[0],this.TKK[1])}&q=${encodeURIComponent(e)}`,this.fallBacking?this.FALLBACK_TRANSLATE_URL+t:this.TRANSLATE_URL+t}generateTranslateURL(e,t,r){let n=`&sl=${this.LAN_TO_CODE.get(t)}&tl=${this.LAN_TO_CODE.get(r)}`;return n+=`&tk=${this.generateTK(e,this.TKK[0],this.TKK[1])}&q=${encodeURIComponent(e)}`,this.fallBacking?this.FALLBACK_TRANSLATE_URL+n:this.TRANSLATE_URL+n}parseDetectResult(e){return this.fallBacking?this.CODE_TO_LAN.get(e[2]):this.CODE_TO_LAN.get(e.ld_result.srclangs[0])}parseBetterResult(e){let t=new Object;if(e.sentences){t.mainMeaning="",t.originalText="";let r=0;for(;r<e.sentences.length&&e.sentences[r].trans;r++)t.mainMeaning+=e.sentences[r].trans,t.originalText+=e.sentences[r].orig;r<e.sentences.length&&(e.sentences[r].translit&&(t.tPronunciation=e.sentences[r].translit),e.sentences[r].src_translit&&(t.sPronunciation=e.sentences[r].src_translit))}if(e.dict){t.detailedMeanings=[];for(let r of e.dict)for(let e of r.entry)t.detailedMeanings.push({pos:r.pos,meaning:e.word,synonyms:e.reverse_translation})}if(e.definitions){t.definitions=[];for(let r of e.definitions)for(let e of r.entry)t.definitions.push({pos:r.pos,meaning:e.gloss,synonyms:[],example:e.example})}if(e.examples){t.examples=[];for(let r of e.examples.example)t.examples.push({source:r.text,target:null});t.examples.sort(((e,t)=>e.source>t.source?1:e.source===t.source?0:-1))}return t}parseFallbackResult(e){let t=new Object;for(let r=0;r<e.length;r++)if(e[r]){let n=e[r];switch(r){case 0:{let e=[],r=[],a=n.length-1;for(let t=0;t<=a;t++)e.push(n[t][0]),r.push(n[t][1]);t.mainMeaning=e.join(""),t.originalText=r.join("");try{a>0&&(n[a][2]&&n[a][2].length>0&&(t.tPronunciation=n[a][2]),n[a][3]&&n[a][3].length>0&&(t.sPronunciation=n[a][3]))}catch(e){}break}case 1:t.detailedMeanings=new Array,n.forEach((e=>t.detailedMeanings.push({pos:e[0],meaning:e[1].join(", ")})));break;case 2:t.from=n;break;case 12:t.definitions=new Array,n.forEach((e=>{e[1].forEach((r=>{t.definitions.push({pos:e[0],meaning:r[0],example:r[2]})}))}));break;case 13:t.examples=new Array,n.forEach((e=>e.forEach((e=>t.examples.push({source:null,target:e[0]})))))}}return t}parseTranslateResult(e){return this.fallBacking?this.parseFallbackResult(e):this.parseBetterResult(e)}supportedLanguages(){return new Set(this.LAN_TO_CODE.keys())}detect(e){let r=async()=>{const n=await t.get(this.generateDetectURL(e),{validateStatus:e=>e<500});if(200===n.status)return this.parseDetectResult(n.data);if(429===n.status&&!this.fallBacking)return this.fallBack(),await this.updateTKK().then(r);throw{errorType:"API_ERR",errorCode:n.status,errorMsg:"Detect failed.",errorAct:{api:"google",action:"detect",text:e,from:null,to:null}}};return r()}translate(e,r,n){let a=async()=>{const s=await t.get(this.generateTranslateURL(e,r,n),{validateStatus:e=>e<500});if(200===s.status)return this.parseTranslateResult(s.data);if(429===s.status&&!this.fallBacking)return this.fallBack(),await this.updateTKK().then(a);throw{errorType:"API_ERR",errorCode:s.status,errorMsg:"Translate failed.",errorAct:{api:"google",action:"translate",text:e,from:r,to:n}}};return a()}async pronounce(e,t,r){this.stopPronounce();let n="fast"===r?"0.8":"0.2";this.AUDIO.src=`${this.fallBacking?this.FALLBACK_TTS_URL:this.TTS_URL}&q=${encodeURIComponent(e)}&tl=${this.LAN_TO_CODE.get(t)}&ttsspeed=${n}&tk=${this.generateTK(e,this.TKK[0],this.TKK[1])}`;try{await this.AUDIO.play()}catch(r){throw{errorType:"NET_ERR",errorCode:0,errorMsg:r.message,errorAct:{api:"google",action:"pronounce",text:e,from:t,to:null}}}}stopPronounce(){this.AUDIO.paused||this.AUDIO.pause()}},d=[["auto","auto"],["zh-CN","zh"],["en","en"],["ja","jp"],["ko","kr"],["fr","fr"],["es","es"],["it","it"],["de","de"],["tr","tr"],["ru","ru"],["pt","pt"],["vi","vi"],["id","id"],["th","th"],["ms","ms"],["ar","ar"],["hi","hi"]],m=class{constructor(e){this.channel=e,this.MAX_RETRY=1,this.qtk="",this.qtv="",this.BASE_URL="https://fanyi.qq.com",this.HEADERS={},this.LAN_TO_CODE=new Map(d),this.CODE_TO_LAN=new Map(d.map((([e,t])=>[t,e]))),this.AUDIO=new Audio}supportedLanguages(){return new Set(this.LAN_TO_CODE.keys())}async requestHomePage(){let e=await new Promise(((e,t)=>chrome.tabs.create({url:this.BASE_URL,active:!1},(r=>{chrome.runtime.lastError?t(chrome.runtime.lastError.message):e(r.id)}))));await new Promise(((t,r)=>chrome.tabs.executeScript(e,{code:'\n    let watcher = document.createElement("script");\n    watcher.textContent = `\n        let intervalId = setInterval(() => {\n            if (window.qtk && window.qtv && window.qtk.length > 0 && window.qtv.length > 0) {\n                window.postMessage("et_tencent_token_updated", "*");\n                clearInterval(intervalId);\n            }\n        }, 50);\n    `;\n    document.body.appendChild(watcher);\n\n    window.addEventListener("message", event => {\n        if (event.data === "et_tencent_token_updated") {\n            chrome.runtime.sendMessage(\n                JSON.stringify({\n                    type: "event",\n                    event: "tencent_token_updated"\n                }),\n                () => window.close()\n            );\n        }\n    });\n',runAt:"document_end"},(()=>{chrome.runtime.lastError?(r(chrome.runtime.lastError.message),chrome.tabs.remove(e,(()=>chrome.runtime.lastError))):t()})))),await new Promise((e=>{const t=this.channel.on("tencent_token_updated",(()=>{t(),e()}))}))}async updateTokens(){return await this.requestHomePage(),new Promise((e=>{chrome.cookies.getAll({url:this.BASE_URL},(t=>{for(let e of t)"qtv"===e.name?this.qtv=e.value:"qtk"===e.name&&(this.qtk=e.value);e()}))}))}parseResult(e,t){let r={originalText:"",mainMeaning:""};for(let t of e.translate.records)r.mainMeaning+=t.targetText,r.originalText+=t.sourceText;let n=new DOMParser;return r.originalText=n.parseFromString(r.originalText,"text/html").documentElement.textContent,r.mainMeaning=n.parseFromString(r.mainMeaning,"text/html").documentElement.textContent,(!r.originalText||r.originalText.length<=0)&&(r.originalText=t),e.suggest&&e.suggest.data&&e.suggest.data.length>0&&(e.suggest.data[0].prx_ph_AmE&&(r.sPronunciation=e.suggest.data[0].prx_ph_AmE),e.suggest.data[0].examples_json&&(r.examples=JSON.parse(e.suggest.data[0].examples_json).basic.map((e=>({source:n.parseFromString(e.sourceText,"text/html").documentElement.textContent,target:n.parseFromString(e.targetText,"text/html").documentElement.textContent}))))),e.dict&&e.dict.abstract&&e.dict.abstract.length>0&&(r.detailedMeanings=e.dict.abstract.map((e=>({pos:e.ps,meaning:n.parseFromString(e.explanation.join(", "),"text/html").documentElement.textContent})))),r}async detect(e){const r=await t({method:"POST",baseURL:this.BASE_URL,url:"/api/translate",headers:this.HEADERS,data:new URLSearchParams({source:this.LAN_TO_CODE.get("auto"),target:this.LAN_TO_CODE.get("zh-CN"),sourceText:e})});let n=r.data.translate.source;if(!n||n.length<=0)throw{errorType:"API_ERR",errorCode:r.status,errorMsg:"Detect failed.",errorAct:{api:"tencent",action:"detect",text:e,from:null,to:null}};return this.CODE_TO_LAN.get(n)}async translate(e,r,n){let a=0,s=async()=>{const o=await t({method:"POST",baseURL:this.BASE_URL,url:"/api/translate",headers:this.HEADERS,data:new URLSearchParams({source:this.LAN_TO_CODE.get(r),target:this.LAN_TO_CODE.get(n),sourceText:e,qtv:this.qtv,qtk:this.qtk,sessionUuid:`translate_uuid${(new Date).getTime()}`})});let i=!1;if((o.data.dict||o.data.translate&&o.data.translate.records[0].targetText.length>0&&(e.trim().indexOf(" ")>-1||a>=this.MAX_RETRY))&&(i=!0),i)return this.parseResult(o.data,e);if(a<this.MAX_RETRY)return a++,await this.updateTokens().then(s);throw{errorType:"API_ERR",errorCode:o.status,errorMsg:"Translate failed.",errorAct:{api:"tencent",action:"translate",text:e,from:r,to:n}}};return 0!==this.qtk.length&&0!==this.qtv.length||await this.updateTokens(),await s()}pronounce(e,t,r){this.stopPronounce();let n=0,a=async()=>{try{let r=await new Promise(((e,t)=>{chrome.cookies.get({url:this.BASE_URL,name:"fy_guid"},(r=>{r&&r.value?e(r.value):t("Tencent guid not found!")}))}));this.AUDIO.src=`${this.BASE_URL}/api/tts?platform=PC_Website&lang=${this.LAN_TO_CODE.get(t)}&text=${encodeURIComponent(e)}&guid=${r}`,await this.AUDIO.play()}catch(r){if(n<this.MAX_RETRY)return n++,await this.requestHomePage(),a();throw{errorType:"NET_ERR",errorCode:0,errorMsg:r.message,errorAct:{api:"tencent",action:"pronounce",text:e,from:t,to:null}}}};return a()}stopPronounce(){this.AUDIO.paused||this.AUDIO.pause()}};function g(e){if(e){let t=/.+:\/+([\w.-]+).*/,r=e.match(t);if(r)return r[1]}return""}function p(e){console.log(e)}class f{static create(e){return new Promise(((t,r)=>{chrome.tabs.create(e,(e=>{if(chrome.runtime.lastError)return r(chrome.runtime.lastError.message);t(e)}))}))}static query(e){return new Promise(((t,r)=>{chrome.tabs.query(e,(e=>chrome.runtime.lastError||!e[0]||e[0].id<0?r({error:chrome.runtime.lastError||"The query has no results"}):t(e)))}))}}function T(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function b(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?T(Object(r),!0).forEach((function(t){_(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):T(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function y(e){chrome.storage.sync.get(["DefaultPageTranslator"],(t=>{switch(t.DefaultPageTranslator){case"YouDaoPageTranslate":default:w(e);break;case"GooglePageTranslate":k(e)}}))}async function A(e){let r="POST"===e.type,n=await t({method:e.type,baseURL:e.url,headers:r?{"Content-Type":"application/x-www-form-urlencoded"}:{},data:r?e.data:null});return{response:200===n.status?JSON.stringify(n.data):null,index:e.index}}function w(e){chrome.tabs.executeScript({file:"/youdao/main.js"},(t=>{chrome.runtime.lastError?(p(`Chrome runtime error: ${chrome.runtime.lastError}`),p(`Detail: ${t}`)):f.query({active:!0,currentWindow:!0}).then((t=>{e.emitToTabs(t[0].id,"start_page_translate",{translator:"youdao"})}))}))}function k(e){chrome.tabs.executeScript({file:"/google/init.js"},(t=>{chrome.runtime.lastError?(p(`Chrome runtime error: ${chrome.runtime.lastError}`),p(`Detail: ${t}`)):f.query({active:!0,currentWindow:!0}).then((t=>{e.emitToTabs(t[0].id,"start_page_translate",{translator:"google"})}))}))}const v="X";function S(e,t){chrome.tabs.query({active:!0,currentWindow:!0},(r=>{r&&r[0]&&chrome.storage.sync.get("blacklist",(n=>{let a=n.blacklist,s="urls"===e?r[0].url:g(r[0].url);a[e][s]=!0,chrome.storage.sync.set({blacklist:a},(()=>{t(a,r[0].url)}))}))}))}function R(e,t){chrome.tabs.query({active:!0,currentWindow:!0},(r=>{r&&r[0]&&chrome.storage.sync.get("blacklist",(n=>{let a=n.blacklist,s="urls"===e?r[0].url:g(r[0].url);a[e][s]&&delete a[e][s],chrome.storage.sync.set({blacklist:a},(()=>{t(a,r[0].url)}))}))}))}function E(e){chrome.storage.sync.get("blacklist",(t=>{t.blacklist?t.blacklist.domains[g(e)]?(L(["add_url_blacklist","remove_url_blacklist","add_domain_blacklist"]),O(["remove_domain_blacklist"]),chrome.browserAction.setBadgeText({text:v})):t.blacklist.urls[e]?(L(["add_url_blacklist","add_domain_blacklist","remove_domain_blacklist"]),O(["remove_url_blacklist"]),chrome.browserAction.setBadgeText({text:v})):(L(["remove_url_blacklist","remove_domain_blacklist"]),O(["add_url_blacklist","add_domain_blacklist"]),chrome.browserAction.setBadgeText({text:""})):chrome.storage.sync.set({blacklist:{urls:{},domains:{}}})}))}function O(e){e.forEach((e=>{chrome.contextMenus.update(e,{enabled:!0,visible:!0},(()=>{chrome.runtime.lastError&&p(`Chrome runtime error: ${chrome.runtime.lastError}`)}))}))}function L(e){e.forEach((e=>{chrome.contextMenus.update(e,{enabled:!1,visible:!1},(()=>{chrome.runtime.lastError&&p(`Chrome runtime error: ${chrome.runtime.lastError}`)}))}))}function x(e,t,r){let n=document.location.origin+document.location.pathname+document.location.search;var a;a=()=>{var a;a=a=>{let s={v:1,tid:"UA-153659474-1",cid:a,ul:navigator.language,an:chrome.runtime.getManifest().name,av:chrome.runtime.getManifest().version,t,dl:n,dp:`/${e}`,dt:e};Object.assign(s,r);let o=new XMLHttpRequest;o.open("POST","https://www.google-analytics.com/collect",!0),o.send(function(e){let t="";if(e)for(let r in e)t+=`${r}=${e[r]}&`;return t}(s))},chrome.storage.sync.get("UUID",(e=>{let t=e.UUID;t||(t=function(){let e=(new Date).getTime();return window.performance&&"function"==typeof window.performance.now&&(e+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(t=>{let r=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?r:3&r|8).toString(16)}))}(),chrome.storage.sync.set({UUID:t})),a(t)}))},chrome.storage.sync.get("OtherSettings",(e=>{e.OtherSettings.UseGoogleAnalytics&&a()}))}const N={ach:"ach",ady:"en",af:"af","af-NA":"af","af-ZA":"af",ak:"aka",am:"am",ar:"ar","ar-AR":"ar","ar-MA":"ar","ar-SA":"ar","ay-BO":"aym",az:"az","az-AZ":"az","be-BY":"be",bg:"bg","bg-BG":"bg",bn:"bn","bn-IN":"bn","bn-BD":"bn","bs-BA":"bs",ca:"ca","ca-ES":"ca",cak:"en",ceb:"ceb","ck-US":"chr",co:"co",cs:"cs","cs-CZ":"cs",cy:"cy","cy-GB":"cy",da:"da","da-DK":"da",de:"de","de-AT":"de","de-DE":"de","de-CH":"de",dsb:"en",el:"el","el-GR":"el",en:"en","en-GB":"en","en-AU":"en","en-CA":"en","en-IE":"en","en-IN":"en","en-PI":"en","en-UD":"en","en-US":"en","en-ZA":"en","en@pirate":"en",eo:"eo","eo-EO":"eo",es:"es","es-AR":"es","es-419":"es","es-CL":"es","es-CO":"es","es-EC":"es","es-ES":"es","es-LA":"es","es-NI":"es","es-MX":"es","es-US":"es","es-VE":"es",et:"et","et-EE":"et",eu:"eu","eu-ES":"eu",fa:"fa","fa-IR":"fa","fb-LT":"en",ff:"en",fi:"fi","fi-FI":"fi","fo-FO":"fao",fr:"fr","fr-CA":"fr","fr-FR":"fr","fr-BE":"fr","fr-CH":"fr","fy-NL":"fy",ga:"ga","ga-IE":"ga",gd:"gd",gl:"gl","gl-ES":"gl","gn-PY":"grn","gu-IN":"gu","gx-GR":"el",ha:"ha",haw:"haw",he:"he","he-IL":"he",hi:"hi","hi-IN":"hi",hmn:"hmn",hr:"hr","hr-HR":"hr",hsb:"en",ht:"ht",hu:"hu","hu-HU":"hu","hy-AM":"hy",id:"id","id-ID":"id",ig:"ig",is:"is","is-IS":"is",it:"it","it-IT":"it",iw:"he",ja:"ja","ja-JP":"ja","jv-ID":"jw","ka-GE":"ka","kk-KZ":"kk",km:"km","km-KH":"km",kab:"kab",kn:"kn","kn-IN":"kn",ko:"ko","ko-KR":"ko","ku-TR":"ku",ky:"ky",la:"la","la-VA":"la",lb:"lb","li-NL":"lim",lo:"lo",lt:"lt","lt-LT":"lt",lv:"lv","lv-LV":"lv",mai:"mai","mg-MG":"mg",mi:"mi",mk:"mk","mk-MK":"mk",ml:"ml","ml-IN":"ml","mn-MN":"mn",mr:"mr","mr-IN":"mr",ms:"ms","ms-MY":"ms",mt:"mt","mt-MT":"mt",my:"my",no:"no",nb:"no","nb-NO":"no",ne:"ne","ne-NP":"ne",nl:"nl","nl-BE":"nl","nl-NL":"nl","nn-NO":"no",ny:"ny",oc:"oci","or-IN":"or",pa:"pa","pa-IN":"pa",pl:"pl","pl-PL":"pl","ps-AF":"ps",pt:"pt","pt-BR":"pt","pt-PT":"pt","qu-PE":"que","rm-CH":"roh",ro:"ro","ro-RO":"ro",ru:"ru","ru-RU":"ru","sa-IN":"san",sd:"sd","se-NO":"sme","si-LK":"si",sk:"sk","sk-SK":"sk",sl:"sl","sl-SI":"sl",sm:"sm",sn:"sn","so-SO":"so",sq:"sq","sq-AL":"sq",sr:"sr","sr-RS":"sr",st:"st",su:"su",sv:"sv","sv-SE":"sv",sw:"sw","sw-KE":"sw",ta:"ta","ta-IN":"ta",te:"te","te-IN":"te",tg:"tg","tg-TJ":"tg",th:"th","th-TH":"th",tl:"fil","tl-PH":"fil",tlh:"tlh",tr:"tr","tr-TR":"tr","tt-RU":"tat",uk:"uk","uk-UA":"uk",ur:"ur","ur-PK":"ur",uz:"uz","uz-UZ":"uz",vi:"vi","vi-VN":"vi","xh-ZA":"xh",yi:"yi","yi-DE":"yi",yo:"yo",zh:"zh-CN","zh-Hans":"zh-CN","zh-Hant":"zh-TW","zh-CN":"zh-CN","zh-HK":"zh-TW","zh-SG":"zh-CN","zh-TW":"zh-TW","zu-ZA":"zu"},I={blacklist:{urls:{},domains:{"chrome.google.com":!0,extensions:!0}},LayoutSettings:{Resize:!1,RTL:!1,FoldLongContent:!0,SelectTranslatePosition:"TopRight"},languageSetting:{sl:"auto",tl:N[chrome.i18n.getUILanguage()]},OtherSettings:{MutualTranslate:!1,SelectTranslate:!0,TranslateAfterDblClick:!1,TranslateAfterSelect:!1,CancelTextSelection:!1,UseGoogleAnalytics:!0,UsePDFjs:!0},DefaultTranslator:"GoogleTranslate",DefaultPageTranslator:"YouDaoPageTranslate",HybridTranslatorConfig:{translators:["BaiduTranslate","BingTranslate","GoogleTranslate"],selections:{originalText:"BaiduTranslate",mainMeaning:"BaiduTranslate",tPronunciation:"BaiduTranslate",sPronunciation:"BaiduTranslate",detailedMeanings:"BingTranslate",definitions:"GoogleTranslate",examples:"BaiduTranslate"}},TranslateResultFilter:{mainMeaning:!0,originalText:!0,tPronunciation:!0,sPronunciation:!0,tPronunciationIcon:!0,sPronunciationIcon:!0,detailedMeanings:!0,definitions:!0,examples:!0},ContentDisplayOrder:["mainMeaning","originalText","detailedMeanings","definitions","examples"],HidePageTranslatorBanner:!1};chrome.contextMenus.create({id:"translate",title:`${chrome.i18n.getMessage("Translate")} '%s'`,contexts:["selection"]}),chrome.contextMenus.create({id:"shortcut",title:chrome.i18n.getMessage("ShortcutSetting"),contexts:["browser_action"]}),chrome.contextMenus.create({id:"translate_page",title:chrome.i18n.getMessage("TranslatePage"),contexts:["page"]}),chrome.contextMenus.create({id:"translate_page_youdao",title:chrome.i18n.getMessage("TranslatePageYouDao"),contexts:["browser_action"]}),chrome.contextMenus.create({id:"translate_page_google",title:chrome.i18n.getMessage("TranslatePageGoogle"),contexts:["browser_action"]}),chrome.contextMenus.create({id:"add_url_blacklist",title:chrome.i18n.getMessage("AddUrlBlacklist"),contexts:["browser_action"],enabled:!1,visible:!1}),chrome.contextMenus.create({id:"add_domain_blacklist",title:chrome.i18n.getMessage("AddDomainBlacklist"),contexts:["browser_action"],enabled:!1,visible:!1}),chrome.contextMenus.create({id:"remove_url_blacklist",title:chrome.i18n.getMessage("RemoveUrlBlacklist"),contexts:["browser_action"],enabled:!1,visible:!1}),chrome.contextMenus.create({id:"remove_domain_blacklist",title:chrome.i18n.getMessage("RemoveDomainBlacklist"),contexts:["browser_action"],enabled:!1,visible:!1}),chrome.runtime.onInstalled.addListener((e=>{chrome.storage.sync.get((e=>{let t=e;D(t,I),chrome.storage.sync.set(t)})),"install"===e.reason?(chrome.tabs.create({url:chrome.i18n.getMessage("WikiLink")}),chrome.notifications.create("data_collection_notification",{type:"basic",iconUrl:"./icon/icon128.png",title:chrome.i18n.getMessage("AppName"),message:chrome.i18n.getMessage("DataCollectionNotice")}),setTimeout((()=>{x("background","event",{ec:"installation",ea:"installation"})}),6e5)):"update"===e.reason&&(chrome.storage.sync.get("languageSetting",(e=>{"zh-cn"===e.languageSetting.sl?e.languageSetting.sl="zh-CN":"zh-tw"===e.languageSetting.sl&&(e.languageSetting.sl="zh-TW"),"zh-cn"===e.languageSetting.tl?e.languageSetting.tl="zh-CN":"zh-tw"===e.languageSetting.tl&&(e.languageSetting.tl="zh-TW"),chrome.storage.sync.set(e)})),chrome.notifications.create("update_notification",{type:"basic",iconUrl:"./icon/icon128.png",title:chrome.i18n.getMessage("AppName"),message:chrome.i18n.getMessage("ExtensionUpdated")})),chrome.runtime.setUninstallURL("https://wj.qq.com/s2/3265930/8f07/")}));const C=new class{constructor(){this._services=new Map,this._eventManager=new class{constructor(){this._handlerID=1,this._eventToHandlerIDs=new Map,this._handlerIDToHandler=new Map}on(e,t){const r=this._allocHandlerID();this._handlerIDToHandler.set(r,t),this._eventToHandlerIDs.has(e)?this._eventToHandlerIDs.get(e).add(r):this._eventToHandlerIDs.set(e,new Set([r]));let n=!1;return(()=>{n?console.warn("You shouldn't call the canceler more than once!"):(n=!0,this._off(e,r))}).bind(this)}emit(e,t,r){const n=this._eventToHandlerIDs.get(e);if(n)for(const e of n){const n=this._handlerIDToHandler.get(e);n&&n(t,r)}}_allocHandlerID(){for(;this._handlerIDToHandler.has(this._handlerID);)this._handlerID=(this._handlerID+1)%Number.MAX_SAFE_INTEGER;return this._handlerID}_off(e,t){const r=this._eventToHandlerIDs.get(e);r&&r.delete(t),this._handlerIDToHandler.delete(t)}},chrome.runtime.onMessage.addListener(((e,t,r)=>{let n=JSON.parse(e);if(n&&n.type)switch(n.type){case"event":this._eventManager.emit(n.event,n.detail,t),r&&r();break;case"service":{const e=this._services.get(n.service);if(!e)break;return e(n.params,t).then((e=>r&&r(e))),!0}default:console.error(`Unknown message type: ${e.type}`)}else console.error(`Bad message: ${e}`)}).bind(this))}provide(e,t){this._services.set(e,t)}request(e,t){const r=JSON.stringify({type:"service",service:e,params:t});return new Promise(((e,t)=>{chrome.runtime.sendMessage(r,(r=>{chrome.runtime.lastError?t(chrome.runtime.lastError):e(r)}))}))}requestToTab(e,t,r){const n=this._getTabMessageSender();return n?n(e,JSON.stringify({type:"service",service:t,params:r})):Promise.reject("Can not send message to tabs in current context!")}on(e,t){return this._eventManager.on(e,t)}emit(e,t){let r=JSON.stringify({type:"event",event:e,detail:t});chrome.runtime.sendMessage(r,(()=>{chrome.runtime.lastError&&console.error(chrome.runtime.lastError)}))}emitToTabs(e,t,r){const n=this._getTabMessageSender();if(!n)return void console.error("Can not send message to tabs in current context!");"number"==typeof e&&(e=[e]);const a=JSON.stringify({type:"event",event:t,detail:r});for(let t of e)n(t,a).catch((e=>console.error(e)))}_getTabMessageSender(){return chrome.tabs&&chrome.tabs.sendMessage?(e,t)=>new Promise(((r,n)=>{chrome.tabs.sendMessage(e,t,(e=>{chrome.runtime.lastError?n(chrome.runtime.lastError):r(e)}))})):null}},U=new class{constructor(e){this.channel=e,this.HYBRID_TRANSLATOR=new class{constructor(e){this.channel=e,this.REAL_TRANSLATORS={BaiduTranslate:new a,BingTranslate:new l,GoogleTranslate:new h,TencentTranslate:new m(e)},this.REAL_TRANSLATORS.DeepLTranslate=new class{constructor(e,t){this.HOME_PAGE="https://www.deepl.com/translator",this.LAN_TO_CODE=new Map(c),this.CODE_TO_LAN=new Map(c.map((([e,t])=>[t,e]))),this.langDetector=e,this.TTSEngine=t,this._createIframe()}_createIframe(){this.deepLIframe=document.createElement("iframe"),document.body.appendChild(this.deepLIframe),this.deepLIframe.src=this.HOME_PAGE}supportedLanguages(){return new Set(this.LAN_TO_CODE.keys())}async detect(e){return await this.langDetector.detect(e)}async translate(e,t,r){try{return{mainMeaning:await new Promise(((n,a)=>{const s=setTimeout((()=>{a({status:408,errorMsg:"Request timeout!"})}),1e4),o=e=>{e.data.type&&"edge_translate_deepl_response"===e.data.type&&(window.removeEventListener("message",o),clearTimeout(s),200===e.data.status?n(e.data.result):a(e.data))};window.addEventListener("message",o),this.deepLIframe.contentWindow.postMessage({type:"edge_translate_deepl_request",url:`${this.HOME_PAGE}#${this.LAN_TO_CODE.get(t)}/${this.LAN_TO_CODE.get(r)}/${encodeURIComponent(e.replaceAll("/","\\/"))}`},this.HOME_PAGE)})),originalText:e}}catch(n){throw 408===n.status&&(document.body.removeChild(this.deepLIframe),this.deepLIframe=null,this._createIframe()),n.errorCode=n.status||0,n.errorMsg=n.errorMsg||n.message,n.errorAct={api:"deepl",action:"translate",text:e,from:t,to:r},n}}async pronounce(e,t,r){return await this.TTSEngine.pronounce(e,t,r)}stopPronounce(){this.TTSEngine.stopPronounce()}}(this.REAL_TRANSLATORS.GoogleTranslate,this.REAL_TRANSLATORS.GoogleTranslate),this.CONFIG={},this.MAIN_TRANSLATOR="",chrome.storage.onChanged.addListener(((e,t)=>{"sync"===t&&e.HybridTranslatorConfig&&(this.CONFIG=e.HybridTranslatorConfig.newValue,this.MAIN_TRANSLATOR=this.CONFIG.selections.mainMeaning)}).bind(this))}loadConfigIfNotLoaded(){return new Promise(((e,t)=>{this.CONFIG.translators&&this.CONFIG.selections?e():chrome.storage.sync.get("HybridTranslatorConfig",(r=>{chrome.runtime.lastError?t(chrome.runtime.lastError):(this.CONFIG=r.HybridTranslatorConfig,this.MAIN_TRANSLATOR=this.CONFIG.selections.mainMeaning,e())}))}))}getAvailableTranslatorsFor(e,t){let r=[];for(let n in this.REAL_TRANSLATORS){let a=this.REAL_TRANSLATORS[n].supportedLanguages();a.has(e)&&a.has(t)&&r.push(n)}return r.sort()}async updateConfigFor(e,t){await this.loadConfigIfNotLoaded();let r={translators:new Set,selections:{}},n=this.getAvailableTranslatorsFor(e,t),a=n[0],s=new Set(n);for(let e in this.CONFIG.selections){let t,n=this.CONFIG.selections[e];s.has(n)?(r.selections[e]=n,t=n):(r.selections[e]=a,t=a),r.translators.add(t)}return r.translators=Array.from(r.translators),chrome.storage.sync.set({HybridTranslatorConfig:r}),Promise.resolve(r)}async detect(e){return await this.loadConfigIfNotLoaded(),this.REAL_TRANSLATORS[this.MAIN_TRANSLATOR].detect(e)}async translate(e,t,r){await this.loadConfigIfNotLoaded();let n=[];for(let a of this.CONFIG.translators)n.push(this.REAL_TRANSLATORS[a].translate(e,t,r).then((e=>[a,e])));let a={},s=new Map(await Promise.all(n));for(let e in this.CONFIG.selections)try{let t=this.CONFIG.selections[e];a[e]=s.get(t)[e]}catch(t){p(`${e} ${this.CONFIG.selections[e]}`),p(t)}return a}async pronounce(e,t,r){return await this.loadConfigIfNotLoaded(),this.REAL_TRANSLATORS[this.MAIN_TRANSLATOR].pronounce(e,t,r)}async stopPronounce(){await this.loadConfigIfNotLoaded(),this.REAL_TRANSLATORS[this.MAIN_TRANSLATOR].stopPronounce()}}(e),this.TRANSLATORS=b({HybridTranslate:this.HYBRID_TRANSLATOR},this.HYBRID_TRANSLATOR.REAL_TRANSLATORS),this.IN_MUTUAL_MODE=null,this.LANGUAGE_SETTING={},this.DEFAULT_TRANSLATOR="",this.CONFIG_LOADED=!1,this.TTS_SPEED="fast",this.localTTS=new class{constructor(){this.speaking=!1,this.synthesis=window.speechSynthesis}speak(e,t,r){if(!this.synthesis.getVoices().find((e=>e.lang.startsWith(t))))return console.log(`No voice for language: "${t}"`),!1;this.speaking=!0;let n=new SpeechSynthesisUtterance(e);return n.rate="fast"===r?1:.6,n.onend=(()=>this.speaking=!1).bind(this),this.synthesis.speak(n),!0}pause(){this.speaking&&(this.synthesis.cancel(),this.speaking=!1)}},this.provideServices(),this.listenToEvents()}provideServices(){this.channel.provide("translate",(e=>this.translate(e.text,e.position))),this.channel.provide("pronounce",(e=>{let t=e.speed;return t||(t=this.TTS_SPEED,this.TTS_SPEED="fast"===t?"slow":"fast"),this.pronounce(e.pronouncing,e.text,e.language,t)})),this.channel.provide("youdao_page_translate",A),this.channel.provide("get_available_translators",(e=>Promise.resolve(this.getAvailableTranslators(e)))),this.channel.provide("update_default_translator",(e=>this.updateDefaultTranslator(e.translator)))}listenToEvents(){this.channel.on("translate_page_youdao",(()=>{w(this.channel)})),this.channel.on("translate_page_google",(()=>{k(this.channel)})),this.channel.on("language_setting_update",this.onLanguageSettingUpdated.bind(this)),this.channel.on("frame_closed",this.stopPronounce.bind(this)),chrome.storage.onChanged.addListener(((e,t)=>{"sync"===t&&(e.OtherSettings&&(this.IN_MUTUAL_MODE=e.OtherSettings.newValue.MutualTranslate),e.languageSetting&&(this.LANGUAGE_SETTING=e.languageSetting.newValue),e.DefaultTranslator&&(this.DEFAULT_TRANSLATOR=e.DefaultTranslator.newValue))}).bind(this))}loadConfigIfNotLoaded(){return new Promise(((e,t)=>{this.CONFIG_LOADED?e():chrome.storage.sync.get(["DefaultTranslator","languageSetting","OtherSettings"],(r=>{chrome.runtime.lastError?t(chrome.runtime.lastError):(this.IN_MUTUAL_MODE=r.OtherSettings.MutualTranslate,this.LANGUAGE_SETTING=r.languageSetting,this.DEFAULT_TRANSLATOR=r.DefaultTranslator,this.CONFIG_LOADED=!0,e())}))}))}async getCurrentTabId(){let e=-1;const t=await f.query({active:!0,currentWindow:!0});return e=t[0].id,await this.channel.requestToTab(e,"check_availability").catch((async()=>{if(!await new Promise((e=>{/^file:\/\.*/.test(t[0].url)?chrome.extension.isAllowedFileSchemeAccess((t=>{!t&&confirm(chrome.i18n.getMessage("PermissionRemind"))?(chrome.tabs.create({url:`chrome://extensions/?id=${chrome.runtime.id}`}),e(!1)):e(!0)})):e(!0)})))return void(e=-1);const r=chrome.runtime.getURL("content/notice/notice.html");try{const t=(await f.query({url:r}))[0];chrome.tabs.highlight({tabs:t.index}),e=t.id}catch(t){const a=await f.create({url:r,active:!0});await(n=200,new Promise(((e,t)=>{setTimeout((()=>{e()}),n)}))),e=a.id}var n})),e}async detect(e){return await this.loadConfigIfNotLoaded(),this.TRANSLATORS[this.DEFAULT_TRANSLATOR].detect(e)}async translate(e,t){await this.loadConfigIfNotLoaded();const r=await this.getCurrentTabId();if(-1===r)return;let n=(new Date).getTime();this.channel.emitToTabs(r,"start_translating",{text:e,position:t,timestamp:n});let a=this.LANGUAGE_SETTING.sl,s=this.LANGUAGE_SETTING.tl;try{if("auto"!==a&&this.IN_MUTUAL_MODE)switch(a=await this.detect(e),a){case this.LANGUAGE_SETTING.sl:s=this.LANGUAGE_SETTING.tl;break;case this.LANGUAGE_SETTING.tl:s=this.LANGUAGE_SETTING.sl;break;default:a="auto",s=this.LANGUAGE_SETTING.tl}let t=await this.TRANSLATORS[this.DEFAULT_TRANSLATOR].translate(e,a,s);t.sourceLanguage=a,t.targetLanguage=s,this.channel.emitToTabs(r,"translating_finished",b({timestamp:n},t))}catch(e){this.channel.emitToTabs(r,"translating_error",{error:e,timestamp:n})}}async pronounce(e,t,r,n){await this.loadConfigIfNotLoaded();const a=await this.getCurrentTabId();if(-1===a)return;let s=r,o=(new Date).getTime();this.channel.emitToTabs(a,"start_pronouncing",{pronouncing:e,text:t,language:r,timestamp:o});try{"auto"===r&&(s=await this.TRANSLATORS[this.DEFAULT_TRANSLATOR].detect(t)),await this.TRANSLATORS[this.DEFAULT_TRANSLATOR].pronounce(t,s,n).catch((e=>{if(!this.localTTS.speak(t,s,n))throw e}).bind(this)),this.channel.emitToTabs(a,"pronouncing_finished",{pronouncing:e,text:t,language:r,timestamp:o})}catch(t){this.channel.emitToTabs(a,"pronouncing_error",{pronouncing:e,error:t,timestamp:o})}}async stopPronounce(){await this.loadConfigIfNotLoaded(),this.TRANSLATORS[this.DEFAULT_TRANSLATOR].stopPronounce(),this.localTTS.pause()}getAvailableTranslators(e){return["HybridTranslate"].concat(this.HYBRID_TRANSLATOR.getAvailableTranslatorsFor(e.from,e.to))}async onLanguageSettingUpdated(e){let t=this.DEFAULT_TRANSLATOR,r=this.getAvailableTranslators(e),n=await this.HYBRID_TRANSLATOR.updateConfigFor(e.from,e.to);new Set(r).has(t)||(t=r[1],chrome.storage.sync.set({DefaultTranslator:t})),this.channel.emit("hybrid_translator_config_updated",{config:n,availableTranslators:r.slice(1)}),f.query({active:!0,currentWindow:!0}).then((e=>this.channel.emitToTabs(e[0].id,"update_translator_options",{selectedTranslator:t,availableTranslators:r})))}updateDefaultTranslator(e){return new Promise((t=>{chrome.storage.sync.set({DefaultTranslator:e},(()=>{t()}))}))}}(C);function D(e,t){for(let r in t)"object"==typeof t[r]&&!(t[r]instanceof Array)&&Object.keys(t[r]).length>0?e[r]?D(e[r],t[r]):e[r]=t[r]:void 0===e[r]&&(e[r]=t[r])}chrome.notifications.onClicked.addListener((e=>{switch(e){case"update_notification":chrome.tabs.create({url:"https://github.com/EdgeTranslate/EdgeTranslate/releases"});break;case"data_collection_notification":chrome.tabs.create({url:chrome.runtime.getURL("options/options.html#google-analytics")})}})),chrome.contextMenus.onClicked.addListener(((e,t)=>{switch(e.menuItemId){case"translate":C.requestToTab(t.id,"get_selection").then((({text:e,position:t})=>e?U.translate(e,t):Promise.reject())).catch((t=>e.selectionText.trim()?U.translate(e.selectionText,null):Promise.resolve(t)));break;case"translate_page":y(C);break;case"translate_page_youdao":w(C);break;case"translate_page_google":k(C);break;case"settings":chrome.runtime.openOptionsPage();break;case"shortcut":chrome.tabs.create({url:"chrome://extensions/shortcuts"});break;case"add_url_blacklist":S("urls",(()=>{L(["add_url_blacklist","add_domain_blacklist","remove_domain_blacklist"]),O(["remove_url_blacklist"])})),chrome.browserAction.setBadgeText({text:v});break;case"remove_url_blacklist":R("urls",(()=>{L(["remove_url_blacklist","remove_domain_blacklist"]),O(["add_url_blacklist","add_domain_blacklist"])})),chrome.browserAction.setBadgeText({text:""});break;case"add_domain_blacklist":S("domains",(()=>{L(["add_url_blacklist","add_domain_blacklist","remove_url_blacklist"]),O(["remove_domain_blacklist"])})),chrome.browserAction.setBadgeText({text:v});break;case"remove_domain_blacklist":R("domains",((e,t)=>{e.urls[t]?(L(["add_url_blacklist","add_domain_blacklist","remove_domain_blacklist"]),O(["remove_url_blacklist"])):(L(["remove_url_blacklist","remove_domain_blacklist"]),O(["add_url_blacklist","add_domain_blacklist"]),chrome.browserAction.setBadgeText({text:""}))}))}})),chrome.tabs.onActivated.addListener((e=>{chrome.tabs.get(e.tabId,(e=>{e.url&&e.url.length>0&&E(e.url)}))})),chrome.tabs.onUpdated.addListener(((e,t,r)=>{r.active&&r.url&&r.url.length>0&&E(r.url)})),C.on("redirect",((e,t)=>chrome.tabs.update(t.tab.id,{url:e.url}))),C.on("open_options_page",(()=>chrome.runtime.openOptionsPage())),C.on("page_translate_event",((e,t)=>{C.emitToTabs(t.tab.id,"page_translate_event",e)})),C.provide("get_lang",(()=>Promise.resolve({lang:N[chrome.i18n.getUILanguage()]}))),chrome.commands.onCommand.addListener((e=>{"translate_page"===e?y(C):f.query({active:!0,currentWindow:!0}).then((t=>C.emitToTabs(t[0].id,"command",{command:e}))).catch((()=>{}))})),chrome.webRequest.onHeadersReceived.addListener((e=>({responseHeaders:e.responseHeaders.map((e=>/^content-security-policy$/i.test(e.name)?{name:e.name,value:e.value.replaceAll(/((^|;)\s*(default-src|script-src|img-src|connect-src))\s+['"]none['"]/g,"$1").replaceAll(/((^|;)\s*(default-src|script-src|img-src|connect-src))/g,"$1 translate.googleapis.com translate.google.com www.google.com www.gstatic.com "+chrome.runtime.getURL(""))}:e))})),{urls:["*://*/*"],types:["main_frame","sub_frame"]},["blocking","responseHeaders"]),chrome.webRequest.onHeadersReceived.addListener((e=>({responseHeaders:e.responseHeaders.map((e=>/^content-security-policy$/i.test(e.name)?{name:e.name,value:e.value.replaceAll(/frame-ancestors [^;]*;?/g,"")}:e))})),{urls:["*://*.deepl.com/*"],types:["main_frame","sub_frame"]},["blocking","responseHeaders"]),chrome.webRequest.onHeadersReceived.addListener((e=>{for(let t of e.responseHeaders)if("cross-origin-resource-policy"===t.name.toLowerCase()){t.value="cross-origin";break}return{responseHeaders:e.responseHeaders}}),{urls:["*://translate.google.cn/*"]},["blocking","responseHeaders","extraHeaders"]),chrome.webRequest.onBeforeSendHeaders.addListener((e=>{let t=!1,r=`https://${g(e.url)}`;for(let n of e.requestHeaders)if("origin"===n.name.toLowerCase()){n.value=r,t=!0;break}return t||e.requestHeaders.push({name:"Origin",value:r}),{requestHeaders:e.requestHeaders}}),{urls:["*://fanyi.qq.com/*"]},["blocking","requestHeaders","extraHeaders"]),setTimeout((()=>{x("background","pageview",null)}),1e3)})()})();