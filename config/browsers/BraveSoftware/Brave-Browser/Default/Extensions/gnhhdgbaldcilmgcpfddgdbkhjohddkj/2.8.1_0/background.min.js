"use strict";function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function asyncGeneratorStep(e,t,n,o,i,s,r){try{var a=e[s](r),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(o,i)}function _asyncToGenerator(a){return function(){var e=this,r=arguments;return new Promise(function(t,n){var o=a.apply(e,r);function i(e){asyncGeneratorStep(o,t,n,i,s,"next",e)}function s(e){asyncGeneratorStep(o,t,n,i,s,"throw",e)}i(void 0)})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var ngApp=angular.module("NimBackgroundApp",[]);ngApp.run(function(){}).controller("nimController",["$scope","$window","$http","$q",function(m,v,c,u){var e=function(){function e(){_classCallCheck(this,e);var n=this;n.isAuthenticated=!1,n.loggingin=!1,createAuth0Client({domain:env.AUTH0_DOMAIN,client_id:env.AUTH0_CLIENT_ID,audience:f?"https://api-dev.brakecode.com/api/v1/":"https://api.brakecode.com/api/v1",display:"popup"}).then(function(e){n.auth0=e}),m.$on("brakecode-login",function(){n.loggingin=!0,setTimeout(function(){this.loggingin=!1,Object.values(j).map(function(e){return e.postMessage({event:"brakecode-login-cancelled"})})}.bind(n),5e3),m.Auth.auth0.getTokenSilently().then(function(){n.isAuthenticated=!0,n.setProfileData(function(){Object.values(j).map(function(e){return e.postMessage({event:"brakecode-logged-in"})}),m.$emit("brakecode-logged-in")}),n.loggingin=!1}).catch(function(e){"login_required"===e.error?m.Auth.auth0.loginWithPopup().then(function(e){n.isAuthenticated=!0,localStorage.authResult=JSON.stringify(e),n.setProfileData(function(){Object.values(j).map(function(e){return e.postMessage({event:"brakecode-logged-in"})}),m.$emit("brakecode-logged-in")}),P.notifications.create({type:"basic",iconUrl:"icon/icon128.png",title:"Login Successful",message:"Advanced NiM Features Ready."},function(e){v._gaq.push(["_trackEvent","Notification Event","notification_created","Brakecode Login Success",void 0,!0]),4<=m.settings.debugVerbosity&&console.log(e)}),n.loggingin=!1}).catch(function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:P.notifications.create({type:"basic",title:"Login Failed",message:t.message,iconUrl:"icon/icon128.png"},function(e){v._gaq.push(["_trackEvent","Notification Event","notification_created","Brakecode Login Failed",void 0,!0]),4<=m.settings.debugVerbosity&&console.log(e)}),n.loggingin=!1;case 2:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}()):(P.notifications.create({type:"basic",title:"Login Failed",message:e.error_description,iconUrl:"icon/icon128.png"},function(e){v._gaq.push(["_trackEvent","Notification Event","notification_created","Brakecode Login Failed",void 0,!0]),4<=m.settings.debugVerbosity&&console.log(e)}),n.loggingin=!1)})}),m.$on("brakecode-logout",function(){localStorage.clear(),m.Auth.auth0.logout({localOnly:!0}),m.Auth.isAuthenticated=!1})}var t,n,o;return _createClass(e,[{key:"setProfileData",value:(o=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getIdToken();case 2:n=e.sent,n=jwt_decode(n),this.profile={nickname:n.nickname,user_metadata:n[f?"http://localhost/user_metadata":"https://brakecode.com/user_metadata"],picture:n.picture},t();case 6:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"getIdToken",value:(n=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this,e.next=3,t.auth0.getIdTokenClaims();case 3:return t=e.sent,t=t.__raw,e.abrupt("return",t);case 6:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})},{key:"getAPIKey",value:(t=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(m.Auth&&m.Auth.isAuthenticated){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.getIdToken();case 4:return t=e.sent,t=jwt_decode(t)[f?"http://localhost/apikey":"https://brakecode.com/apikey"],e.abrupt("return",t);case 7:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})}]),e}(),t=function(){function e(){_classCallCheck(this,e),this.sockets={}}return _createClass(e,[{key:"getSocket",value:function(e){var t=this,n=new WebSocket(e),o=this.parseWebSocketUrl(e)[2];return n.addEventListener("close",function(){t.closeSocket(t.sockets[o])}),n}},{key:"parseWebSocketUrl",value:function(e){return e.match(/(wss?):\/\/(.*)\/(.*)$/)}},{key:"setSocket",value:function(e,t,n){var o,i=this.parseWebSocketUrl(t)[2];return this.sockets[i]||(o=this.getSocket(t),this.sockets[i]={messageIndex:0,socketUrl:t,ws:o,socket:i}),this.tasks(this.sockets[i],n)}},{key:"closeSocket",value:function(e){void 0!==e&&(delete this.sockets[e.socket],e.ws.readyState!==WebSocket.CLOSED&&e.ws.close())}},{key:"updateSocket",value:function(e,t,n){var o=this.parseWebSocketUrl(t)[2];return t.includes(e)?Promise.resolve(this.sockets[o]):(!this.sockets[o].ws.readyState!==WebSocket.CLOSED&&(this.sockets[o].ws.close(),delete this.sockets[o].ws),this.sockets[o]={messageIndex:0,socketUrl:t,ws:this.getSocket(t),socket:o},this.tasks(this.sockets[o],n))}},{key:"tasks",value:function(n,o){var i=this,e=new Promise(function(t){!(!o||!o.autoResume)&&o.autoResume?i.autoResumeInspectBrk(n).then(function(e){t(e)}):t(n)}),t=new Promise(function(e){o&&o.focusOnBreakpoint&&o.focusOnBreakpoint&&i.focusOnBreakpoint(n),e(n)});return Promise.all([e,t]).then(function(){return Promise.resolve(n)})}},{key:"autoResumeInspectBrk",value:function(n){var o=this,i={};return n.ws.addEventListener("message",function(e){var t=JSON.parse(e.data);switch(t.method){case"Debugger.paused":o.sockets[n.socket].autoResumedOnce||(n.ws.send(JSON.stringify({id:667+n.messageIndex++,method:"Debugger.resume"})),console.log("Auto resuming debugger from initial 'inspect-brk' state."),o.sockets[n.socket].autoResumedOnce=!0);break;case"Debugger.scriptParsed":t.url&&t.url.indexOf("helloworld2.js")&&(i.scriptId=t.params.scriptId)}1<=m.settings.debugVerbosity&&console.log(e)}),new Promise(function(e){n.ws.onopen=function(e){1<=m.settings.debugVerbosity&&console.log(e),n.ws.send(JSON.stringify({id:667+n.messageIndex++,method:"Debugger.enable"}))},e(n)})}},{key:"focusOnBreakpoint",value:function(e){e.ws.addEventListener("message",function(e){var t=JSON.parse(e.data);if("Debugger.paused"===t.method){var n=e.currentTarget.url.split("ws://")[1],t=m.devToolsSessions.find(function(e){return e.url.includes(n)});if(void 0===t)return;t.isWindow?P.windows.update(t.id,{focused:!0},function(e){4<=m.settings.debugVerbosity&&console.log("focusOnBreakpoint(): window: ".concat(e.id))}):P.tabs.update(t.id,{active:!0},function(t){P.windows.update(t.windowId,{focused:!0},function(e){4<=m.settings.debugVerbosity&&console.log("focusOnBreakpoint(): window: ".concat(e.id," tab: ").concat(t.id))})})}1<=m.settings.debugVerbosity&&console.log(e)})}}]),e}(),n=function(){function t(){_classCallCheck(this,t);var e=this;this.init(),m.$on("brakecode-logged-in",function(){e.init(),e.pubnub.reconnect()}),m.$on("brakecode-logged-out",function(){e.pubnub.stop(),e.pubnub=null})}return _createClass(t,[{key:"init",value:function(){var n=this,e=f?"http://localhost/pubsub_auth_keys":"https://brakecode.com/pubsub_auth_keys";this.pubnub=new PubNub({subscribeKey:env.PUBNUB_SUBSCRIBE_KEY,authKey:localStorage.profile?JSON.parse(localStorage.profile)[e]:[],ssl:!0}),this.pubnub.subscribe({channels:this.getChannels()}),this.pubnub.addListener({message:function(e){var t=e.message;t.report&&(t.report=n.parseReport(t),m.nodeReportMessages.push(t));try{Object.values(j).forEach(function(e){return e.postMessage({event:"newNodeReportMessage",report:t.report})})}catch(e){f&&console.log("Error ".concat(e))}n.sortMessagesByHost(),n.pruneMessages()}})}},{key:"getChannels",value:function(){if(localStorage.profile){var e=[];return f&&JSON.parse(localStorage.profile)["http://localhost/apikey"]?e.push("".concat(JSON.parse(localStorage.profile)["http://localhost/apikey"])):e.push("".concat(JSON.parse(localStorage.profile)["https://brakecode.com/apikey"])),e}}},{key:"parseReport",value:function(e){var i,t=e.report,s={};return"node-reports"===e.type?(i=["dump event time","module load time","process id","command line","node.js version","os version","machine","Total heap memory size","Total heap committed memory","Total used heap memory","Total available heap memory","Heap memory limit"],(s.string=t).split("\n").map(function(o){i.find(function(e,t){var n=new RegExp("(^".concat(e,"):(.*)"),"i");if(s.temp=o.match(n)?o.match(n):"",s.temp)return i.splice(t,1),s[e]={title:s.temp[1],value:s.temp[2].trim()},!0})}),s.id=s.machine.value+" "+s["dump event time"].value):((s=e.report).machine={title:"machine",value:e.host||s.header.host},s.id=s.machine.value+" "+s.header.dumpEventTime),s}},{key:"sortMessagesByHost",value:function(){if(0===m.nodeReportMessages.length)return[];var o={};m.nodeReportMessages.map(function(e){var t=e.report.id.split(" ")[0],n=e.report;o[t]?o[t].find(function(e){return e.report.id===n.id})?console.log("SOMETHING IS WRONG!  found duplicate message"):o[t].push({report:n}):o[t]=[{report:n}]}),m.nodeReportSortedMessages=o}},{key:"pruneMessages",value:function(){Object.entries(m.nodeReportSortedMessages).map(function(e,t,n){for(var o=e[0],i=e[1];i.length>m.settings.diagnosticReports.maxMessages;)i.shift();for(;m.nodeReportMessages.length>n.length*m.settings.diagnosticReports.maxMessages;)m.nodeReportMessages.shift();m.nodeReportSortedMessages["".concat(o)]=i})}}]),t}(),o=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"check",value:function(){c({method:"GET",url:"http://localhost:6607/json",responseType:"json"}).then(function(e){e.data.forEach(function(e){Q(function(e){e=e.devtoolsFrontendUrl;m.getDevToolsOption()===m.settings.scheme+"devtools/bundled/inspector.html"&&(m.localDevToolsOptions[0].url=e.split("?")[0]);m.settings.localDevTools&&(e=e.replace(I,m.getDevToolsOption().url));return e}(e),"http://"+e.inspectSocket+"/json",e.id,null,e)})}).catch(function(e){1<=m.settings.debugVerbosity&&console.log(e)})}}]),e}(),i=function(){function e(){_classCallCheck(this,e),this.notifications=[],f&&setTimeout(this.pullNotifications.bind(this),5e3),setInterval(this.pullNotifications.bind(this),w),setInterval(this.pushUnpushedNotification.bind(this),S)}return _createClass(e,[{key:"saveNotifications",value:function(){var e=this,t=JSON.stringify(this.notifications);P.storage.local.set({notifications:t},function(){v._gaq.push(["_trackEvent","Program Event","Notification Service","Saving notifications.",e.notifications.length,!0])})}},{key:"loadNotifications",value:function(){var t=this;P.storage.local.get(["notifications"],function(e){0!==Object.keys(e).length&&(t.notifications=e,v._gaq.push(["_trackEvent","Program Event","Notification Service","Loading notifications.",t.notifications.length,!0]))})}},{key:"pullNotifications",value:function(){var o=this;c({method:"GET",url:env.MESSAGING_SERVICE_URL,responseType:"json"}).then(function(e){var n=[];n.push(["_trackEvent","Program Event","Notification Service","Pulled Messages",parseInt(e.data.length),!0]),e.data.forEach(function(t){void 0===o.notifications.find(function(e){return e.type+" "+e.id==t.type+" "+t.id})&&(n.push(["_trackEvent","Program Event","Notification Service","Pulled "+t.type+" "+t.id,void 0,!0]),o.notifications.push(t))}),v._gaq.push(n),o.removeExpiredNotifications(),o.saveNotifications()}).catch(function(e){1<=m.settings.debugVerbosity&&console.log(e)})}},{key:"removeExpiredNotifications",value:function(){var o=[];this.notifications=this.notifications.filter(function(e){var t=Date.now()+y-e.date,n=!(0<t);return(f||1<=m.settings.debugVerbosity)&&n&&console.log("Removing expired ".concat(e.type," notification ").concat(e.id,".")),(f||1<=m.settings.debugVerbosity)&&console.log("Notification lifetime for ".concat(e.type," notification ").concat(e.id,": ").concat(m.moment.duration(t).humanize())),o.push(["_trackEvent","Program Event","Notification Service","Expired "+e.type+" "+e.id,void 0,!0]),!n}),v._gaq.push(o)}},{key:"addNotification",value:function(e){void 0===this.notifications.find()&&this.notifications.push(e)}},{key:"getNotifications",value:function(){return this.notifications}},{key:"getNotification",value:function(t){return this.notifications.find(function(e){return e.chromiumNotificationId===t})}},{key:"pushUnpushedNotification",value:function(){var t,e,n,o=this.notifications.find(function(e){return void 0===e.pushed||!0!==e.pushed});o&&(m.settings.notifications.enabled?(o.pushable&&(e="twitter"===(t=o).type?"@june07t Tweeted":"NiM Notification",n="twitter"===t.type?"Follow":"",P.notifications.create({type:"basic",iconUrl:"icon/icon128.png",title:e,message:t.text,buttons:[{title:n,iconUrl:"icon/twitter.svg"},{title:"Retweet"}]},function(e){v._gaq.push(["_trackEvent","Notification Event","notification_created",t.type,void 0,!0]),t.chromiumNotificationId=e,t.twitterButtonText={button1:n},4<=m.settings.debugVerbosity&&console.log(e)})),o.pushed=!0,v._gaq.push(["_trackEvent","Program Event","Notification Service","Pushed "+o.type+" "+o.id,void 0,!0])):v._gaq.push(["_trackEvent","Program Event","Notification Service","Push Notifications Disabled "+o.type+" "+o.id,void 0,!0]))}},{key:"haveNotifications",value:function(){var e=parseInt(this.notifications.length);return v._gaq.push(["_trackEvent","Program Event","Notification Service","Notifications",e,!0]),0<e}}]),e}(),s=function(){function t(){_classCallCheck(this,t);var e=this;e.PADS_SERVER=f?"https://pads-dev.brakecode.com":"https://pads.brakecode.com",e.PADS_HOST=f?"pads-dev.brakecode.com":"pads.brakecode.com",e.NAMESPACE_APIKEY_NAME=f?"namespace-apikey-dev.brakecode.com":"namespace-apikey.brakecode.com",e.PUBLIC_KEY_NAME=f?"publickey-dev.brakecode.com":"publickey.brakecode.com",e.REGEXPS={INSPECTOR_WS_URL:new RegExp(/wss=.*\/ws\/(\b[0-9a-f]{8}\b-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-\b[0-9a-f]{12}\b)\/(\b[0-9a-f]{8}\b-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-\b[0-9a-f]{12}\b)/)},e.settings={remoteTabTimeout:6048e5,START_PADS_SOCKET_RETRY_INTERVAL:f?1e4:6e4},e.timeouts={START_PADS_SOCKET_RETRY_INTERVAL:void 0},this.startPADSSocket()}var e;return _createClass(t,[{key:"startPADSSocket",value:(e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var n,t,o,i,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this,e.next=3,m.Auth.getAPIKey();case 3:return t=e.sent,e.next=6,n.lookup(n.NAMESPACE_APIKEY_NAME);case 6:return o=e.sent,e.next=9,n.lookup(n.PUBLIC_KEY_NAME);case 9:if(i=e.sent,t){e.next=13;break}return n.timeouts.START_PADS_SOCKET_RETRY_INTERVAL=setTimeout(n.startPADSSocket.bind(n),n.settings.START_PADS_SOCKET_RETRY_INTERVAL),e.abrupt("return");case 13:s=uuidv5(t,o),n.io=v.io(n.PADS_SERVER+"/"+s,{transports:["websocket"],path:"/nim",query:{apikey:ae(t,i)}}).on("connect_error",function(e){console.log("CALLBACK ERROR: "+e)}).on("metadata",function(o){var i=Date.now();-1===m.remoteTabs.findIndex(function(e,t,n){if(e.uuid===o.uuid)return angular.equals(e,o)?6<=m.settings.debugVerbosity&&console.log("skipping $scope.remoteTabs update.  No change detected."):(o.received=i,n[t]=o),!0})&&m.remoteTabs.push(o),m.remoteTabs=m.remoteTabs.filter(function(e,t){return 0===t||n.remoteTabTimeout(e.received)}),m.$emit("updatedRemoteTabs")});case 15:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"lookup",value:function(o){return new Promise(function(t,n){c({method:"GET",url:"https://cloudflare-dns.com/dns-query?name=".concat(o,"&type=TXT"),headers:{Accept:"application/dns-json"}}).then(function(e){if(200!==e.status)return n(e.statusText);if(0!==e.data.Status)return n(new Error("Cloudflare query failed with status code: ".concat(e.data.Status)));e=e.data.Answer[0].data;e||n(new Error("Error getting ".concat(o,"."))),e=e.replace(/"/g,""),t(e)})})}},{key:"remoteTabTimeout",value:function(e){return void 0===e||Date.now()-e<=this.settings.remoteTabTimeout}},{key:"startNodeInspect",value:function(e,o){var i=this;return new Promise(function(t){var n={host:e,nodePID:o};i.io.emit("inspect",n),i.io.on("inspect-response",function(e){n.host===e.hostname&&n.nodePID==e.pid&&(console.log(e),t(e))})})}}]),t}(),r=function(){function e(){_classCallCheck(this,e),this.STOPPED=!1,this.MAX_OPENED=3,this.WINDOW=3,this.openTabsOrWindows=0,this.seconds=0,this.failsafeSeconds=0,this.secondsTimerInterval=this.start()}return _createClass(e,[{key:"start",value:function(){var e=this,t=setInterval(function(){f&&3<=m.settings.debugVerbosity&&console.log(JSON.stringify(e)),e.seconds++},1e3);return setInterval(function(){e.failsafeSeconds++},1e3),setInterval(function(){e.openTabsOrWindows=0,e.failsafeSeconds=0},1e3*(e.WINDOW+2)),t}},{key:"stop",value:function(){clearInterval(this.secondsTimerInterval),this.STOPPED=!0,m.settings.auto=!1}},{key:"increment",value:function(){this.openTabsOrWindows++,this.openTabsOrWindows>this.MAX_OPENED&&this.failsafeSeconds>this.WINDOW&&this.stop()}},{key:"reset",value:function(){this.STOPPED=!1,this.secondsTimerInterval=this.start()}}]),e}(),a=function(){function n(e){_classCallCheck(this,n);var t=this;t.sessionID=e.sessionID,t.expired=!1,t.elapsed=0,t.timeout=m.settings.localSessionTimeout,t.timerID=setTimeout(function(){e.func(t.sessionID)},t.timeout),setInterval(function(){t.elapsed=t.elapsed+1e3,t.getRemainingTime()<=0&&(t.expired=!0)},1e3)}return _createClass(n,[{key:"clearTimer",value:function(){clearInterval(this.timerID)}},{key:"getRemainingTime",value:function(){return this.timeout-this.elapsed}}]),n}(),l=_createClass(function e(t){var n=this;_classCallCheck(this,e),this.host=t.host,this.port=t.port,this.tabStatus="loading",this.timeout=setTimeout(function(){n.tabStatus=""},5e3)}),d=function(){function t(){_classCallCheck(this,t);var e=this;e.rotateFunctions={rotate0:e.rotate0.bind(e),rotate90:e.rotate90.bind(e),rotate180:e.rotate180.bind(e),rotate270:e.rotate270.bind(e)},v.chrome.contextMenus.removeAll(function(){v.chrome.contextMenus.create({title:"Image Rotate (0deg)",id:"rotate-0",contexts:["image"],onclick:e.rotateFunctions.rotate0},function(){}),v.chrome.contextMenus.create({title:"Image Rotate (90deg)",id:"rotate-90",contexts:["image"],onclick:e.rotateFunctions.rotate90},function(){}),v.chrome.contextMenus.create({title:"Image Rotate (180deg)",id:"rotate-180",contexts:["image"],onclick:e.rotateFunctions.rotate180},function(){}),v.chrome.contextMenus.create({title:"Image Rotate (270deg)",id:"rotate-270",contexts:["image"],onclick:e.rotateFunctions.rotate270},function(){}),v.chrome.contextMenus.create({title:"Utilities",id:"utilities",contexts:["image"]}),v.chrome.contextMenus.create({title:"Image Rotate",id:"image-rotate",parentId:"utilities",contexts:["image"]}),v.chrome.contextMenus.create({title:"Image Rotate (0deg)",id:"utilities-rotate-0",parentId:"image-rotate",contexts:["image"],onclick:e.rotateFunctions.rotate0},function(){}),v.chrome.contextMenus.create({title:"Image Rotate (90deg)",id:"utilities-rotate-90",parentId:"image-rotate",contexts:["image"],onclick:e.rotateFunctions.rotate90},function(){}),v.chrome.contextMenus.create({title:"Image Rotate (180deg)",id:"utilities-rotate-180",parentId:"image-rotate",contexts:["image"],onclick:e.rotateFunctions.rotate180},function(){}),v.chrome.contextMenus.create({title:"Image Rotate (270deg)",id:"utilities-rotate-270",parentId:"image-rotate",contexts:["image"],onclick:e.rotateFunctions.rotate270},function(){})})}return _createClass(t,[{key:"rotate0",value:function(e,t){return this.rotate(0,e,t)}},{key:"rotate90",value:function(e,t){return this.rotate(90,e,t)}},{key:"rotate180",value:function(e,t){return this.rotate(180,e,t)}},{key:"rotate270",value:function(e,t){return this.rotate(270,e,t)}},{key:"rotate",value:function(e,t,n){t.mediaType&&"image"===t.mediaType&&(t=new URL(t.srcUrl).pathname,P.tabs.executeScript(n.id,{allFrames:!0,code:"\n                    document.querySelector(\"img[src*='".concat(t,"']\").style.transform = 'rotate(").concat(e,"deg)';\n                    document.querySelector(\"img[src*='").concat(t,"']\").style.overflow = 'visible';\n                ")},function(){v._gaq.push(["_trackEvent","Utilities Event","rotate","".concat(e),void 0,!0])}))}}]),t}();m.Utilities=new d;var f=!1,p=/Chrome\/([0-9.]+)/.exec(navigator.userAgent)[1].split(".")[0],g="2.8.1",h="https://bit.ly/2vUcRNn",b="https://analytics.june07.com",k="https://shortnr.june07.com/api",w=f?6e4:36e5,S=f?6e4:36e5,y=f?18e4:6048e5,d=["chrome-devtools://","devtools://"],T=/((([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])):([0-9]+)/,I=/(devtools:\/\/|chrome-devtools:\/\/|https:\/\/chrome-devtools-frontend(\.appspot.com|\.june07.com)).*(inspector.html|js_app.html)/,_=new RegExp(/\b[0-9a-f]{8}\b-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-\b[0-9a-f]{12}\b/i);v.chrome.management.getSelf(function(e){m.ExtensionInfo=e}),re().then(function(){new Promise(function(t,n){v.chrome.storage.sync.get(function(e){return void 0===e.NiMSConnector?n(400):(Object.assign(m.NiMSConnector,e.NiMSConnector),void t())})}).catch(function(e){400===e&&(m.NiMSConnector=new s)})}),m.console=console,m.UUID_Regex=_,m.intervals={uptime:null,checkInterval:null},m.fancytrees={},m.NiMSVSCodeConnector=new o,m.notificationService=new i,m.loaded=Date.now(),m.timerUptime=0,m.timerNotification=0,m.VERSION=g,m.settings={DEVEL:f,host:"localhost",port:"9229",auto:!0,checkInterval:500,remoteProbeInterval:1e4,localSessionTimeout:6048e5,debugVerbosity:0,newWindow:!1,autoClose:!1,tabActive:!0,windowFocused:!0,localDevTools:!0,notifications:{showMessage:!0,lastHMAC:0,enabled:!0},chromeNotifications:!0,autoIncrement:{type:"port",name:"Port"},collaboration:!1,panelWindowType:!1,nimsVscode:{enabled:!0},devToolsCompat:!0,localDevToolsOptionsSelectedIndex:2,windowStateMaximized:!1,scheme:75<p?d[1]:d[0],diagnosticReports:{enabled:!0,maxMessages:10},autoResumeInspectBrk:!1,focusOnBreakpoint:!1,group:!0},m.remoteConnectionSettings={},m.Auth=new e,m.pubsub=new n,m.devToolsProtocolClient=new t,m.nodeReportMessages=[],m.localDevToolsOptions=[{id:"0",name:"default",url:m.settings.scheme+"devtools/bundled/inspector.html",selected:!0},{id:"1",name:"appspot",url:"https://chrome-devtools-frontend.brakecode.com/inspector.html"},{id:"2",name:"june07",url:"https://chrome-devtools-frontend.june07.com/front_end/inspector.html"},{id:"3",name:"custom",url:""}],m.remoteTabs=[{connections:{},host:"localhost",title:"BrakeCODE"}],m.localSessions=[],m.brakeCodeSessions=[],m.state={popup:{selectedTab:void 0}},m.devToolsSessions=[],m.changeObject,m.userInfo,m.sessionlessTabs=[],m.locks=[],m.moment=v.moment,m.getDevToolsOption=function(){return m.localDevToolsOptions.find(function(e){return e.selected})},m.validateCustomDevToolsURL=function(){void 0!==m.localDevToolsOptions[3].url&&m.localDevToolsOptions[3].url.match(I)||(m.localDevToolsOptions[3].url=m.localDevToolsOptions[1].url)},m.devtoolsPanelInstances=0;var E,C,R=[],N=[],O=[],P=v.chrome,M={getInstance:B,isComplete:function(){return void 0===C},closeDefunctDevTools:V},x={getInstance:L},D=!(E={}),A={},U=[],j={};function L(t,n,e){var i,s,r;return void 0===E[t]&&(E[t]={}),void 0===Object.keys(E[t]).find(function(e){return e===t})&&(E[t][n]=(i=t,s=n,r=e,new Promise(function(n){var t,o={host:i,port:s};null!==r&&"lock"===r?(t=o,void 0===m.locks.find(function(e){return e.host===t.host&&e.port==t.port})&&m.locks.push(new l(t)),n(!0)):z($())?K(o.host,o.port).then(function(e){var t=z(o)||!1;e&&t?n({inprogress:!0,message:"Opening tab in progress..."}):e||z(o)?(X(o),n(!1)):n({inprogress:!1,message:P.i18n.getMessage("errMsg7",[i,s])})}):n(!1)}).then(function(e){return E[t][n]=void 0,e}))),E[t][n]}function V(e){X(e),W(function(){3<=m.settings.debugVerbosity&&console.log("Closed defunct DevTools session.")})}function B(o){var e=o.host,t=o.port;if(void 0===C)return C=K(e,t).then(function(e){7<=m.settings.debugVerbosity&&console.log("Going thru a check loop [2nd]...");var t,n=m.devToolsSessions.find(function(e){if(e.infoUrl===G(m.settings.host,m.settings.port))return!0});e||void 0===n?e?void 0!==n?(t=n.infoUrl,c({method:"GET",url:t,responseType:"json"}).then(function(e){return ce(e.data[0]).id}).catch(function(e){return e}).then(function(e){n.websocketId!==e&&V(o)})):e&&X(o):7<=m.settings.debugVerbosity&&console.log("No DevTools instance detected.  Skipping [1st] check loop..."):V(o)}).then(function(e){C=e}).catch(function(e){6<=m.settings.debugVerbosity&&console.log("ERROR: "+e)});6<=m.settings.debugVerbosity&&console.log("httpGetTestSingleton promise not settled.")}function q(){return(q=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n,o,i=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=1<i.length&&void 0!==i[1]&&i[1],e.next=3,m.Auth.auth0.getTokenSilently();case 3:return o=e.sent,o=c({method:"GET",url:t,responseType:"json",headers:n?{Authorization:"Bearer "+o}:{},timeout:3*m.settings.checkInterval}).then(function(e){return e.data?e.data[0]:e},function(e){return e}),e.abrupt("return",o);case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}function F(e){e&&clearInterval(e),m.intervals.checkInterval=setInterval(function(){m.settings.auto&&!z($())?(6<=m.settings.debugVerbosity&&console.log("resetInterval going thru a check loop..."),W(m.openTab(m.settings.host,m.settings.port,function(e){3<=m.settings.debugVerbosity&&console.log(e)}))):m.settings.auto&&z($())&&M.getInstance({host:m.settings.host,port:m.settings.port}),m.localSessions.filter(function(e){return e.auto}).map(function(e){var t=J(e.infoUrl);t.host===m.settings.host&&t.port==m.settings.port||(e.auto&&!z(t)?(6<=m.settings.debugVerbosity&&console.log("resetInterval going thru a check loop..."),m.openTab(t.host,t.port,function(e){3<=m.settings.debugVerbosity&&console.log(e)})):e.auto&&z(t)&&M.getInstance(t))}),m.brakeCodeSessions.map(function(e){var t,n,o=(t=e.infoUrl,o=new RegExp("https?://(pads(-dev)?.brakecode.com)/json/("+_.source+")"),n=t.match(o)[1],o=t.match(o)[3],{host:n,port:o}),e=e.infoUrl.match(_)?e.infoUrl.match(_)[0]:void 0;void 0!==e&&((e=!(!m.remoteConnectionSettings[e]||!m.remoteConnectionSettings[e].auto)&&m.remoteConnectionSettings[e].auto)&&!z(o)?m.openTab(o.host,o.port,{wsProto:"wss",port:o.port},function(e){3<=m.settings.debugVerbosity&&console.log(e)}):e&&z(o)&&M.getInstance(o))})},m.settings.checkInterval)}function W(e){var o=m.devToolsSessions;o.forEach(function(t,n){t.autoClose&&c({method:"GET",url:t.infoUrl,responseType:"json"}).then(function(e){e=e.data[0].id;t.websocketId!==e&&Y(t,n)}).catch(function(e){-1===e.status?(9<=m.settings.debugVerbosity&&console.log("ERROR [line 324]"),Y(t,n)):9<=m.settings.debugVerbosity&&console.log("<br>"+P.i18n.getMessage("errMsg3")+(t.isWindow?"window":"tab")+e)}),n>=o.length&&e()})}function G(e,t,n){return m.NiMSConnector&&e===m.NiMSConnector.PADS_HOST?m.NiMSConnector.PADS_SERVER+"/json/"+t:(n=void 0===n?"http":n)+"://"+e+":"+t+"/json"}function J(e){return{host:(e=e.replace(/https?:\/\//,"")).split(":")[0],port:e.split(":")[1].split("/")[0]}}function $(){return{host:m.settings.host,port:m.settings.port}}function H(e,t){return void 0!==e&&void 0!==t&&(e.host===t.host&&e.port==t.port)}function K(r,a){return new Promise(function(s,t){c({method:"GET",url:G(r,a)}).then(function(){var n,o,e,t,i;o={host:r,port:a},e=500,t=5e3,void 0===(i=N.find(function(e,t,n){if(H(o,e.instance))return n[t]=e.increment(),e}))&&N.push(i={max:t,min:e,delay:0,checkCount:0,checkCounts:[6,12,24,48,96,192,364,728,14056],instance:o,increment:function(){var e;return-1!==this.checkCounts.indexOf(this.checkCount)?(e=this.delay+this.min,this.max>=e&&(this.delay=e)):14056<this.checkCount&&(this.delay=this.max),this.checkCount++,this},reset:function(){return this.delay=0,this.checkCount=0,this}}),n=i.delay,u(function(e){var t;m.settings.debugVerbosity&&(t=setInterval(function(){7<=m.settings.debugVerbosity&&console.log(".")},200)),setTimeout(function(){void 0!==t&&clearInterval(t),e()},n)}).then(function(){return s(!0)})},function(e){return 6<=m.settings.debugVerbosity&&console.log(e),s(!1)}).catch(function(e){t(e)})})}function z(t){return m.locks.find(function(e){if(void 0!==e&&e.host===t.host&&e.port==t.port)return"loading"!==e.tabStatus&&(""!==e.tabStatus||(X(t),!1))})}function X(o){var i;return i=o,N.find(function(e,t,n){H(i,e.instance)&&(n[t]=e.reset())}),void 0===m.locks||m.locks.find(function(e,t,n){if(void 0!==e&&void 0!==o&&e.host===o.host&&parseInt(e.port)===parseInt(o.port))return n.splice(t,1),!0})}function Y(e,t){m.devToolsProtocolClient.closeSocket(e.dtpSocket),e.isWindow?(v._gaq.push(["_trackEvent","Program Event","removeDevToolsSession","window",void 0,!0]),P.windows.remove(e.id,function(){P.runtime.lastError&&P.runtime.lastError.message.toLowerCase().includes("no window ")&&Z(e.id),m.devToolsSessions.splice(t,1),3<=m.settings.debugVerbosity&&console.log(P.i18n.getMessage("errMsg6")+JSON.stringify(e)+".")})):(v._gaq.push(["_trackEvent","Program Event","removeDevToolsSession","tab",void 0,!0]),P.tabs.remove(e.id,function(){P.runtime.lastError&&P.runtime.lastError.message.toLowerCase().includes("no tab ")&&Z(e.id),m.devToolsSessions.splice(t,1),3<=m.settings.debugVerbosity&&console.log(P.i18n.getMessage("errMsg2")+JSON.stringify(e)+".")}))}function Z(n){var o,e=m.devToolsSessions.find(function(e,t){if(e.id===n)return o=t,e});e&&(m.devToolsSessions.splice(o,1),X(ee(e.id)))}function Q(e,t,n,o,i,s){var r,a,c=m.devToolsSessions.find(function(e,t){if(e.websocketId===n)return r=t,e});c?(a={url:e,auto:c.auto||m.settings.auto,autoClose:m.settings.autoClose,isWindow:m.settings.newWindow,infoUrl:t,id:o,websocketId:n,nodeInspectMetadataJSON:i,dtpSocket:s||c.dtpSocket},m.devToolsSessions.splice(r,1,a)):(a={url:e,auto:null!==o&&m.settings.auto,autoClose:m.settings.autoClose,isWindow:m.settings.newWindow,infoUrl:t,id:o,websocketId:n,nodeInspectMetadataJSON:i,dtpSocket:s},m.devToolsSessions.push(a)),function(t){{var e;-1===t.infoUrl.search(/\/\/pads(-dev)?\.brakecode.com\/json\//)?-1===(e=m.localSessions.findIndex(function(e){return e.websocketId===t.websocketId}))?m.localSessions.push(t):(t.auto=m.localSessions[e].auto,m.localSessions.splice(e,1,t)):-1!==t.infoUrl.search(/\/\/pads(-dev)?\.brakecode.com\/json\//)&&(-1===(e=m.brakeCodeSessions.findIndex(function(e){return e.websocketId===t.websocketId}))?m.brakeCodeSessions.push(t):(t.auto=m.brakeCodeSessions[e].auto,m.brakeCodeSessions.splice(e,1,t)))}}(a),ee(o,t)}function ee(t,e){var n=m.NiMSConnector?m.NiMSConnector.PADS_HOST:void 0;if(void 0===e)return R.find(function(e){return e.id===t});var o=e.split(/https?:\/\//)[1].split("/json")[0],i=parseInt(e.split(/https?:\/\//)[1].split("/json")[0].split(":")[1]);(o=o!==n?o.split(":")[0]:o)===n&&(i=parseInt(e.split("/json/")[1]));e=R.findIndex(function(e){return e.host===o&&e.port===i});-1!==e?R[e]={host:o,port:i,id:t}:R.push({host:o,port:i,id:t})}function te(e,t){P.storage.sync.set(_defineProperty({},e,t),function(){4<=m.settings.debugVerbosity&&console.log("saved key: ["+JSON.stringify(e)+"] obj: ["+t+"]")})}function ne(){F(m.intervals.checkInterval),function(e,t){e=Object.keys(e);"settings"===t&&(e.forEach(function(e){m.changeObject&&m.changeObject[e]&&m.settings[e]===m.changeObject[e].newValue||te(e,m.settings[e])}),se())}(m.settings,"settings"),Object.values(j).map(function(e){return e.postMessage({event:"options-updated"})})}function oe(){return new Promise(function(t){var o,e;o=function(e){t("s="+e+"&ui="+encodeURIComponent(m.userInfo))},e={},Object.assign(e,m.settings),Object.entries(e).forEach(function(e,t,n){switch(!0===e[1]&&(e[1]="t"),!1===e[1]&&(e[1]="f"),e[0]){case"host":e[0]="h";break;case"port":e[0]="p";break;case"checkInterval":e[0]="ci";break;case"debugVerbosity":e[0]="dv";break;case"newWindow":e[0]="nw";break;case"autoClose":e[0]="ac";break;case"tabActive":e[0]="ta";break;case"windowFocused":e[0]="wf";break;case"localDevTools":e[0]="ldt";break;case"notifications":e[0]="n";break;case"showMessage":e[0]="sm";break;case"lastHMAC":e[0]="lh";break;case"chromeNotifications":e[0]="cn";break;case"autoIncrement":e[0]="ai";break;case"collaboration":e[0]="c";break;case"loginRefreshInterval":e[0]="lri";break;case"tokenRefreshInterval":e[0]="tri";break;case"remoteProbeInterval":e[0]="r";break;case"localSessionTimeout":e[0]="l";break;case"panelWindowType":e[0]="pa";break;case"nimsVscode":e[0]="n";break;case"devToolsCompat":e[0]="d";break;case"localDevToolsOptionsSelectedIndex":e[0]="ld";break;case"windowStateMaximized":e[0]="w"}t===n.length-1&&(n.splice(n.findIndex(function(e){return"DEVEL"===e[0]}),1),o(JSON.stringify(n)))})})}function ie(){return new Promise(function(t){oe().then(function(e){return o=b+"/uninstall?app=nim&redirect="+btoa(h)+"&a="+btoa(e),new Promise(function(t){var n=new XMLHttpRequest,e=JSON.stringify({url:o});n.responseType="text",n.open("POST",k),n.setRequestHeader("Content-Type","application/json"),n.onload=function(){var e=n.response;4==n.readyState&&200==n.status||201==n.status?t(e):(console.log("ERROR: "+JSON.stringify(e)),t(h))},n.send(e)});var o}).then(function(e){t(e)})})}function se(){re().then(ie).then(function(e){m.uninstallURL=e,P.runtime.setUninstallURL(e,function(){P.runtime.lastError&&5<=m.settings.debugVerbosity&&console.log(P.i18n.getMessage("errMsg1")+h)})})}function re(){return new Promise(function(t){v.chrome.identity.getProfileUserInfo(function(e){m.userInfo=ae(e),t(e)})})}function ae(e,t){var n=nacl.randomBytes(32),o=void 0!==t?nacl.util.decodeBase64(t):nacl.util.decodeBase64("cXFjuDdYNvsedzMWf1vSXbymQ7EgG8c40j/Nfj3a2VU="),t=crypto.getRandomValues(new Uint8Array(24)),n=nacl.box.keyPair.fromSecretKey(n);e=nacl.util.decodeUTF8(JSON.stringify(e));o=nacl.box(e,t,o,n.secretKey);return nacl.util.encodeBase64(t)+" "+nacl.util.encodeBase64(n.publicKey)+" "+nacl.util.encodeBase64(o)}function ce(e){return e&&e.devtoolsFrontendUrlCompat&&(e.devtoolsFrontendUrl=e.devtoolsFrontendUrl.replace(/chrome-devtools:\/\//,"devtools://")),e&&e.devtoolsFrontendUrlCompat&&(e.devtoolsFrontendUrlCompat=e.devtoolsFrontendUrlCompat.replace(/chrome-devtools:\/\//,"devtools://")),e}function ue(e){var t=e.url.match(/https?:\/\/chrome-devtools-frontend\..*$/),n=e.url.match(/wss?=(pads(-dev)?\.brakecode\.com.*$)/);t&&n&&(t=t&&0<t.length?t[0]:void 0,n=n&&1<n.length?n[1]:void 0,e="https://".concat(n.replace("/ws/","/json/").replace(/\/(\b[0-9a-f]{8}\b-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-\b[0-9a-f]{12}\b)\?.*$/,"")),n=(n=t.match(_))&&0<n.length?n[0]:void 0,t&&e&&(3<=m.settings.debugVerbosity&&console.log("BrakeCODE DevTools tab detected."),Q(t,e,n,null,null),m.updatePopupSessionsTabs()))}m.tabId_HostPort_LookupTable=R,m.watchdog=new r,window.nim={watchdog:m.watchdog},f&&(v.$scope=m),new Promise(function(i){1<=m.settings.debugVerbosity&&console.log("Restoring saved settings."),P.storage.sync.get(function(o){Object.keys(o).forEach(function(e,t,n){m.settings[e]=o[e],t===n.length-1&&(m.setDevToolsOption(m.settings.localDevToolsOptionsSelectedIndex),i())})})}).then(function(){f&&(m.settings.localSessionTimeout=6048e5);return Promise.resolve()}).then(function(){1<=m.settings.debugVerbosity&&console.log("Starting up."),F()}),m.intervals.uptime=setInterval(function(){m.timerUptime++,(900<=m.timerUptime&&m.timerUptime%900==0||1===m.timerUptime)&&v._gaq.push(["_trackEvent","Program Event","Uptime Check",m.moment.duration(m.timerUptime,"seconds").humanize(),m.timerUptime,!0],["_trackEvent","Program Event","Version Check",g+" "+m.userInfo,void 0,!0])},6e4),m.updatePopupSessionsTabs=function(t){if(t)return m.localSessions.splice(m.localSessions.findIndex(function(e){return e.id===t.id}),1);[{localSessions:m.localSessions},{brakeCodeSessions:m.brakeCodeSessions}].map(function(e){var n,t=Object.keys(e)[0],o=Object.values(e)[0];0!==o.length&&(o=o.map(function(e){return e.timer=new a({sessionID:e.id,func:m.updatePopupSessionsTabs}),e}),e=m[t],m[t]=o.concat(m[t]),m[t]=m[t].filter(function(t,e,n){return 0===e||(void 0===n.find(function(e){return e.infoUrl===t.infoUrl})||(t.timer.clearTimer(),!1))}),"localSessions"!==t||angular.equals(e,m[t])||m.$emit("updateLocalTabSessions"),"brakeCodeSessions"===t&&(n=o,new Promise(function(t){var e=n.map(function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,function(){return q.apply(this,arguments)}(t.infoUrl);case 2:return n=e.sent,n=Object.assign(t,{tunnelSocket:{cid:t.infoUrl.match(_)[0]},jsonInfo:n}),e.abrupt("return",n);case 5:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}());Promise.all(e).then(function(e){return t(e)})}).then(function(e){e={connections:e,host:m.NiMSConnector.PADS_HOST,title:"BrakeCODE"};m.remoteTabs[0]=e,m.$emit("updateBrakeCodeTabSessions")})))})},m.removeLocalSession=function(n){var e=m.localSessions.findIndex(function(e){return e.id==n});-1!=e&&m.localSessions.splice(e,1),m.devToolsSessions.find(function(e,t){null!==e.id&&e.id==n&&Y(e,t)})},m.removeRemoteSession=function(n){var e=m.brakeCodeSessions.findIndex(function(e){return e.infoUrl.match(_)[0]==n});-1!==e&&m.brakeCodeSessions.splice(e,1),m.devToolsSessions.find(function(e,t){null!==e.id&&n==(e.infoUrl.match(_)?e.infoUrl.match(_)[0]:void 0)&&Y(e,t)})},m.localize=function(e,i){Array.from(e.document.getElementsByClassName("i18n")).forEach(function(e,t,n){var o;switch("ja"==P.i18n.getUILanguage()&&(e.style.fontSize="small"),e.id){case"open devtools":o=P.i18n.getMessage("openDevtools"),e.value=o;break;case"checkInterval-value":o=P.i18n.getMessage(e.dataset.badgeCaption),e.dataset.badgeCaption=o;break;default:o=P.i18n.getMessage(e.innerText.split(/\s/)[0]),e.textContent=o}t===n.length-1&&i()})},m.save=function(e){te(e,m.settings[e])},m.openTab=function(u,p,g,h){"function"==typeof g&&((h=g).wsProto="ws"),x.getInstance(u,p,null).then(function(e){return void 0!==e.message?h(e.message):void x.getInstance(u,p,"lock").then(function(){var f=G(u,p);P.tabs.query({url:[m.settings.scheme+"*/*localhost:"+p+"*",m.settings.scheme+"*/*"+u+":"+p+"*",m.settings.scheme+"*/*"+u+"/ws/"+p+"*","https://chrome-devtools-frontend.june07.com/*localhost:"+p+"*","https://chrome-devtools-frontend.june07.com/*"+u+":"+p+"*","https://chrome-devtools-frontend.june07.com/*"+u+"/ws/"+p+"*","https://chrome-devtools-frontend.appspot.com/*localhost:"+p+"*","https://chrome-devtools-frontend.appspot.com/*"+u+":"+p+"*","https://chrome-devtools-frontend.appspot.com/*"+u+"/ws/"+p+"*"]},function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function e(d){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==c.pendingRequests.filter(function(e){return e.url.match(/\/json(\/\b[0-9a-f]{8}\b-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-\b[0-9a-f]{12}\b)?/)}).length)return e.abrupt("return");e.next=2;break;case 2:if("function"==typeof g){e.next=8;break}if(m.Auth.auth0){e.next=5;break}return e.abrupt("return",h(P.i18n.getMessage("brakecodeAuthRequired")));case 5:return e.next=7,m.Auth.auth0.getTokenSilently();case 7:t=e.sent;case 8:c({method:"GET",url:f,responseType:"json",headers:{Authorization:"Bearer "+t},timeout:3*m.settings.checkInterval}).then(function(e){var o,i,t;if(!e||null==e.data)return h(P.i18n.getMessage("errMsg9"));if(!(o=ce(e.data[0])).devtoolsFrontendUrl)return h(P.i18n.getMessage("errMsg7",[u,p]));e=e.data[0],m.localDevToolsOptions[0].url=(m.settings.devToolsCompat&&e.devtoolsFrontendUrlCompat?e.devtoolsFrontendUrlCompat:e.devtoolsFrontendUrl).split("?")[0],m.localDevToolsOptions[0].url=m.localDevToolsOptions[0].url.replace(/chrome-devtools:\/\//,"devtools://"),"wss"===g.wsProto?(i=o.devtoolsFrontendUrl.replace(/wss?=(.*)\//,g.wsProto+"="+u+"/ws/"+p+"/"),o.type&&"deno"===o.type&&(i=i+"?runtime="+o.type)):(e=(i=o.devtoolsFrontendUrl.replace(/wss?=localhost/,"ws=127.0.0.1")).match(T)[1],t=i.match(T)[5],i=i.replace(e+":9229",u+":"+p).replace(e+":"+t,u+":"+p)),!m.settings.localDevTools&&!m.settings.devToolsCompat||(t=m.getDevToolsOption().url).match(I)&&(i=i.replace(I,t)),i.match(/chrome-devtools:\/\//)&&(i=i.replace(/chrome-devtools:\/\//,"devtools://"));var n,s,r,a,c,l=o.id;0===d.length?(s=f,r=i,a=l,c=o,new Promise(function(n){var e=s.match(m.NiMSConnector.PADS_HOST)?r.match(m.NiMSConnector.REGEXPS.INSPECTOR_WS_URL)[0].replace("wss=","wss://"):c.webSocketDebuggerUrl,i=m.devToolsProtocolClient.setSocket(a,e,{autoResume:m.settings.autoResumeInspectBrk,focusOnBreakpoint:m.settings.focusOnBreakpoint});m.settings.newWindow?(v._gaq.push(["_trackEvent","Program Event","createWindow","focused",+m.settings.windowFocused,!0]),P.windows.getCurrent(function(e){P.windows.create({url:r,focused:m.settings.windowFocused,type:m.settings.panelWindowType?"panel":"normal",state:m.settings.windowStateMaximized?P.windows.WindowState.MAXIMIZED:m.settings.windowFocused?P.windows.WindowState.NORMAL:P.windows.WindowState.MINIMIZED},function(t){P.windows.update(e.id,{focused:!0}),m.watchdog.increment(),i.then(function(e){Q(r,s,a,t.id,c,e),n(t)})})})):(v._gaq.push(["_trackEvent","Program Event","createTab","focused",+m.settings.tabActive,!0]),P.tabs.create({url:r,active:m.settings.tabActive},function(o){var e;m.watchdog.increment(),i.then(function(e){Q(r,s,a,o.id,c,e),n(o)}),m.settings.group&&0<m.devToolsSessions.length&&(e=m.devToolsSessions.map(function(e){return new Promise(function(t){P.tabs.get(e.id,function(e){return t({tabId:e.id,groupId:e.groupId})})})}),Promise.all(e).then(function(e){var t=e.filter(function(e){return-1==e.groupId}).map(function(e){return e.tabId}),n=0<(e=e.filter(function(e){return-1!==e.groupId})).length?e[0].groupId:-1;0<e.length?P.tabs.group({tabIds:o.id,groupId:n},function(e){console.log("Added tab to existing group ".concat(e))}):(t.push(o.id),P.tabs.group({tabIds:t},function(e){console.log("Added tab to new group ".concat(e))}))}))}))}).then(function(e){var n=e;P.tabs.onUpdated.addListener(function(e,t){D&&e===n.id&&"complete"===t.status?(D=!1,Q(i,f,l,n.id,o),h(n.url)):D||e!==n.id||6<=m.settings.debugVerbosity&&console.log("Loading updated tab ["+e+"]...")})}).then(h)):n=new Promise(function(t){P.tabs.query({url:[m.settings.scheme+"*/*localhost:"+p+"*",m.settings.scheme+"*/*"+u+":"+p+"*",m.settings.scheme+"*/*"+u+"/ws/"+p+"*","https://chrome-devtools-frontend.june07.com/*localhost:"+p+"*","https://chrome-devtools-frontend.june07.com/*"+u+":"+p+"*","https://chrome-devtools-frontend.june07.com/*"+u+"/ws/"+p+"*","https://chrome-devtools-frontend.appspot.com/*localhost:"+p+"*","https://chrome-devtools-frontend.appspot.com/*"+u+":"+p+"*","https://chrome-devtools-frontend.appspot.com/*"+u+"/ws/"+p+"*"]},function(e){if((e=e[0])&&e.active)P.windows.get(e.windowId,function(e){if(e.focused)return t()});else if(m.settings.windowFocused)return t();var o,i;o=e,i=n,void 0===O.find(function(e,t,n){if(e.tab&&o&&e.tab.id===o.id)return n[t]={tab:o,promise:i},!0})&&O.push({tab:o,promise:i})})}).then(function(){var r,a,c,u;r=f,a=i,c=l,u=d[0],c!==A[r]&&(v._gaq.push(["_trackEvent","Program Event","updateTab","focused",+m.settings.windowFocused,!0]),P.tabs.update(u.id,{url:a,active:m.settings.tabActive},function(){return P.runtime.lastError&&P.runtime.lastError.message.toLowerCase().includes("no tab ")?Z(u.id):(t=a,n=r,o=c,i=u.id,s=m.devToolsSessions.find(function(e){if(e.infoUrl===n)return e}),e=t.match(/wss?=(.*)\/(.*)$/)[0].replace("=","://"),s?(s.websocketId=o,m.devToolsProtocolClient.updateSocket(o,e,{autoResume:m.settings.autoResumeInspectBrk,focusOnBreakpoint:m.settings.focusOnBreakpoint}).then(function(e){s.dtpSocket=e})):m.devToolsProtocolClient.setSocket(o,e,{autoResume:m.settings.autoResumeInspectBrk,focusOnBreakpoint:m.settings.focusOnBreakpoint}).then(function(e){m.devToolsSessions.push({url:t,auto:null!==i&&m.settings.auto,autoClose:m.settings.autoClose,isWindow:m.settings.newWindow,infoUrl:n,id:i,websocketId:o,dtpSocket:e})}),A[r]=c,void(D=!0));var t,n,o,i,s,e}))})}).catch(function(e){var t;-1===e.status?(t=P.i18n.getMessage("errMsg4"),h({statusText:t})):401===e.status&&m.NiMSConnector&&e.config.url.match(m.NiMSConnector.PADS_HOST)?h(Object.assign(e,{statusText:P.i18n.getMessage("brakeCODEDashboardLoginRequired")})):h(e)});case 9:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}())})})},m.$on("options-window-closed",function(){ne()}),m.$on("options-window-focusChanged",function(){ne()}),m.tabNotification=function(t){var n=m.tabId_HostPort_LookupTable.find(function(e){return e.host===t.host&&e.port==t.port});void 0!==n&&(n=n.id,P.tabs.get(n,function(e){(void 0===e||0===m.settings.scheme?e.url.match(/chrome-devtools:\/\//):e.url.match(/devtools:\/\//))||(e=void 0!==(e=m.devToolsSessions.find(function(e){return e.id==n}))?e.nodeInspectMetadataJSON.title:"NiM",P.tabs.executeScript(n,{code:"\n                debugger\n                window.nimTabNotification = (window.nimTabNotification === undefined) ? {} : window.nimTabNotification;\n                function createLinkElement(type) {\n                    let link = document.createElement('link')\n                    link.type = 'image/x-icon';\n                    link.rel = 'shortcut icon';\n                    link.id = 'NiMFavicon';\n                    if (type === 'nim') link.href = 'https://june07.github.io/image/icon/favicon16.ico';\n                    else link.href = 'https://chrome-devtools-frontend.appspot.com/favicon.ico';\n                    return link;\n                }\n                var original = { title: document.URL, link: createLinkElement() }\n                var NiM = { title: '"+e+"', link: createLinkElement('nim') }\n\n                var icon, title;\n                var interval = setInterval(function() {\n                    icon = (icon === original.link) ? NiM.link : original.link;\n                    title = (title === original.title) ? NiM.title : original.title;\n                    document.title = title;\n                    var favicon = document.getElementById('NiMFavicon');\n                    if (favicon) document.getElementsByTagName('head')[0].removeChild(favicon);\n                    document.getElementsByTagName('head')[0].appendChild(icon);\n                }, 500);\n                setTimeout(() => {\n                    window.unBlink("+n+");\n                }, 30000);\n                window.unBlink = (tabId) => {\n                    clearInterval(nimTabNotification[tabId].interval);\n                    document.title = original.title;\n                    document.getElementsByTagName('head')[0].appendChild(NiM.link);\n                }\n                window.nimTabNotification["+n+"] = { interval };\n                ",allFrames:!0},function(){!function t(n,e){void 0===e?(U[n]=_defineProperty({},"fn"+n,function(e){e.tabId===n&&P.tabs.executeScript(n,{code:"window.unBlink("+n+")"},function(){t(n,"remove"),console.log("Stopped blinking tab.")})}),P.tabs.onActivated.addListener(U[n]["fn"+n])):"remove"===e&&P.tabs.onActivated.removeListener(U[n])}(n),console.log("Blinking tab.")}))}))},m.setDevToolsOption=function(n){m.localDevToolsOptions.forEach(function(e,t){t===n?(e.selected=!0,m.settings.localDevToolsOptionsSelectedIndex=n):e.selected=!1})},m.getInstanceFromInfoURL=J,setInterval(function(){m.locks.forEach(function(e,t,n){""===e.tabStatus&&(n.splice(t,1),f&&console.log("Removed stuck lock."))})},5e3),se(),P.notifications.onClicked.addListener(function(e){e=m.notificationService.getNotification(e);"twitter"===e.type&&(v._gaq.push(["_trackEvent","Social Event","Link Click","https://twitter.com/june07t/status/"+e.id,void 0,!0]),P.tabs.create({url:"https://twitter.com/june07t/status/"+e.id}))}),P.notifications.onButtonClicked.addListener(function(e,t){var n=m.notificationService.getNotification(e);switch(n.type){case"nim":0===t?(m.settings.chromeNotifications=!1,m.save("chromeNotifications")):1===t&&P.tabs.create({url:"chrome://extensions/configureCommands"});break;case"twitter":if(0===t){"Like"===n.twitterButtonText.button1?(v._gaq.push(["_trackEvent","Social Event","Button Click","https://twitter.com/intent/like?tweet_id="+n.id,void 0,!0]),P.tabs.create({url:"https://twitter.com/intent/like?tweet_id="+n.id,active:!0})):(v._gaq.push(["_trackEvent","Social Event","Button Click","https://twitter.com/intent/follow?screen_name=june07t",void 0,!0]),P.tabs.create({url:"https://twitter.com/intent/follow?screen_name=june07t",active:!0}));break}if(1!==t)break;v._gaq.push(["_trackEvent","Social Event","Button Click","https://twitter.com/intent/retweet?tweet_id="+n.id,void 0,!0]),P.tabs.create({url:"https://twitter.com/intent/retweet?tweet_id="+n.id,active:!0})}}),P.runtime.onInstalled.addListener(m.notificationService.loadNotifications),P.runtime.onInstalled.addListener(function(e){var t,n,o;"install"===e.reason&&P.tabs.create({url:"https://blog.june07.com/nim-install/?utm_source=nim&utm_medium=chrome_extension&utm_campaign=extension_install&utm_content=1"}),t={event:"install",onInstalledReason:e.reason},n=new XMLHttpRequest,o=JSON.stringify({source:"nim",userInfo:m.userInfo,onInstalledReason:t.onInstalledReason}),t="install"===t.event?"/install":"/",n.responseType="json",n.open("POST",b+t),n.setRequestHeader("Content-Type","application/json"),n.onload=function(){var e=n.response;4==n.readyState&&"200"==n.status&&console.log("data returned:",e)},n.send(o),e.reason}),P.runtime.onConnect.addListener(function(t){function o(e){"init"==e.name?j[e.tabId+"_"+t.name]=t:"hidden"==e.name||e.name}t.onMessage.addListener(o),t.onDisconnect.addListener(function(e){e.onMessage.removeListener(o);for(var t=Object.keys(j),n=0;n<t.length;n++)if(j[t[n]]==e){delete j[t[n]];break}})}),P.storage.sync.get("host",function(e){m.settings.host=e.host||"localhost"}),P.storage.sync.get("port",function(e){m.settings.port=e.port||9229}),P.storage.onChanged.addListener(function(e,t){for(var n in m.changeObject=e){"autoClose"===n&&M.closeDefunctDevTools({host:m.settings.host,port:m.settings.port});var o=e[n];4<=m.settings.debugVerbosity&&console.log(P.i18n.getMessage("errMsg5",[n,t,o.oldValue,o.newValue]))}}),P.tabs.onRemoved.addListener(function(t){v._gaq.push(["_trackEvent","Program Event","onRemoved",void 0,void 0,!0]);var e=m.devToolsSessions.findIndex(function(e){if(e.id===t)return X(ee(t)),!0});0<=e&&m.devToolsSessions.splice(e,1)}),P.tabs.onActivated.addListener(function(e){var t;t=e,void 0!==(e=O.find(function(e){if(t&&e.tab&&t.id===e.tab.id)return!0}))&&e.promise.resolve()}),P.commands.onCommand.addListener(function(e){"open-devtools"===e&&(m.save("host"),m.save("port"),m.openTab(m.settings.host,m.settings.port,function(e){3<=m.settings.debugVerbosity&&console.log(e)}),m.settings.chromeNotifications&&P.commands.getAll(function(e){e=e[1];P.notifications.create("",{type:"basic",iconUrl:"icon/icon128.png",title:"NiM owns the ("+e.shortcut+") shortcut.",message:'"'+e.description+'"',buttons:[{title:"Disable this notice."},{title:"Change the shortcut."}]},function(e){m.notificationService.addNotification({chromiumNotificationId:e,type:"nim"}),4<=m.settings.debugVerbosity&&console.log(e)})}),v._gaq.push(["_trackEvent","User Event","OpenDevTools","Keyboard Shortcut Used",void 0,!0]))}),P.tabs.onCreated.addListener(function(n){n.url?ue(n):P.tabs.onUpdated.addListener(function(e,t){t.url&&(Object.assign(n,{url:t.url}),ue(n))})})}]);
//# sourceMappingURL=background.min.js.map