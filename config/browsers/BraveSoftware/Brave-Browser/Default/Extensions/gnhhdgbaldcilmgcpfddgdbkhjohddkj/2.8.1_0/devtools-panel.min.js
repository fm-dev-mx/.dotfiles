"use strict";var ngApp=angular.module("NimDevToolsPanelApp",[]);ngApp.directive("onError",function(){return{restrict:"A",link:function(e,t,n){t.on("error",function(){t.attr("src",n.onError)})}}}).controller("nimDevToolsPanelController",["$scope","$window",function(i,a){i.bg=a.chrome.extension.getBackgroundPage().angular.element("#nim").scope(),i.bg.localize(a,function(){});var c=a.$,e=a.chrome,t=e.runtime.connect({name:"devtools-panel"});function n(e){return{host:e.host,mapped:e.messages.map(function(e){return e.report}).filter(function(e){return e}).map(function(e){return{title:" ".concat(e.id.split(/ +/)[1]),icon:"icon-clipboard",children:function n(e,o,r){e=Object.entries(e).map(function(e){var t=e[0],e=e[1];return!e||"Object"!==e.constructor.name&&"Array"!==e.constructor.name?null===e?{title:' <span class="node_report_key">'.concat(t,"</span>")}:e.constructor.name&&"String"===t.constructor.name?{key:t,title:' <span class="node_report_key">'.concat(t,'</span> : <span class="node_report_value">').concat(e,"</span>")}:e.constructor.name?{title:" ".concat(t),children:[{title:" ".concat(e),icon:"icon-wrench"}]}:void 0:{title:' <span class="node_report_key">'.concat(t,"</span>"),expanded:!!r.match(/networkInterfaces|inspect/),children:n(e,++o,t)}});return e}(e,0,"root")}})}}function o(a){return new Promise(function(e){var t=a.host,n=a.mapped,t=c.ui.fancytree.getTree(c('[id="jstree-'.concat(t,'"]')));if(t){var o=t.getRootNode(),r=o?o.getChildren():[];if(r)for(n.filter(function(t){return!r.find(function(e){return e.title.match(t.title)})}).map(function(e){o.addChildren(e)});o.countChildren(!1)>=i.bg.settings.diagnosticReports.maxMessages;)o.getFirstChild().remove();e()}else n=(t=a).host,t=a.mapped,i.bg.fancytrees["jstree-".concat(n)]=c('[id="jstree-'.concat(n,'"]')).fancytree({checkbox:!0,checkboxAutoHide:!0,source:t}),e()})}function r(e){var n,o,r;e instanceof Array?e.map(function(t){t.selected.map(function(e){n=e.title.trim(),o=i.bg.nodeReportMessages.find(function(e){return e.report.id.endsWith(n)}),r=new Blob([JSON.stringify(o.report)],{type:"text/json"}),a.saveAs(r,"NodeJSDiagnosticReport-".concat(t.host,"-").concat(n,".json"))})}):(n=e.title.trim(),o=i.bg.nodeReportMessages.find(function(e){return e.report.id.endsWith(n)}),r=new Blob([JSON.stringify(o.report)],{type:"text/json"}),a.saveAs(r,"NodeJSDiagnosticReport-".concat(n,".json")))}t.postMessage({name:"init",tabId:e.devtools.inspectedWindow.tabId}),window.addEventListener("message",function(e){t.postMessage({name:e.data.name,tabId:e.data.tabId})}),t.onMessage.addListener(function(e){function t(){i.bg.nodeReportSortedMessages&&(i.$apply(),Promise.all(Object.entries(i.bg.nodeReportSortedMessages).map(function(e){return o(n({host:e[0],messages:e[1]}))})).then(function(){c(".collapsible").collapsible(),i.$apply()}))}switch(e.event){case"newNodeReportMessage":t();break;case"brakecode-logged-in":i.$apply(),c("ul.tabs").tabs(),c(".dropdown-chip").dropdown({inDuration:300,outDuration:225,constrainWidth:!1,hover:!0,coverTrigger:!1,alignment:"left"}),t();break;case"brakecode-login-cancelled":i.$apply();break;case"options-updated":i.$apply(),t()}}),c(a.document).ready(function(){c("ul.tabs").tabs(),c(".dropdown-chip").dropdown({inDuration:300,outDuration:225,constrainWidth:!1,hover:!0,coverTrigger:!1,alignment:"left"}),i.bg.nodeReportSortedMessages&&(i.$apply(),Promise.all(Object.entries(i.bg.nodeReportSortedMessages).map(function(e){return o(n({host:e[0],messages:e[1]}))})).then(function(){c(".collapsible").collapsible(),i.$apply()})),c.contextMenu({selector:"span.fancytree-title",items:{download:{name:"Download Diagnostic Report(s)",className:"icon-download",callback:function(e,t){var n=Object.keys(i.bg.nodeReportSortedMessages).map(function(e){var t=c.ui.fancytree.getTree(c('[id="jstree-'.concat(e,'"]'))).getSelectedNodes();return 0<t.length?{host:e,selected:t}:null}).filter(function(e){return e});0<n.length?r(n):r(c.ui.fancytree.getNode(t.$trigger))}}}})}),i.login=function(){i.bg.$emit("brakecode-login")},i.logout=function(){i.bg.$emit("brakecode-logout")},i.openOptionsPage=function(){e.runtime.openOptionsPage()}}]);
//# sourceMappingURL=devtools-panel.min.js.map